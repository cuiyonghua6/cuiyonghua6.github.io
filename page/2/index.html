<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">






<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0">






<meta name="description" content="No pain, no gain.">
<meta property="og:type" content="website">
<meta property="og:title" content="Think Different">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Think Different">
<meta property="og:description" content="No pain, no gain.">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Think Different">
<meta name="twitter:description" content="No pain, no gain.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/">





  <title> Think Different </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Think Different</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">享受编程和技术所带来的快乐</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/python/python基础/20190305_图形界面/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Think Different">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/python/python基础/20190305_图形界面/" itemprop="url">
                  python图形界面
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-05T15:24:20+08:00">
                2019-03-05
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h5 id="1-用python画出玫瑰图案"><a href="#1-用python画出玫瑰图案" class="headerlink" title="1. 用python画出玫瑰图案"></a>1. 用python画出玫瑰图案</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle <span class="keyword">as</span> t</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个曲线绘制函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DegreeCurve</span><span class="params">(n, r, d=<span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        t.left(d)</span><br><span class="line">        t.circle(r, abs(d))</span><br><span class="line"><span class="comment"># 初始位置设定</span></span><br><span class="line">s = <span class="number">0.2</span> <span class="comment"># size</span></span><br><span class="line">t.setup(<span class="number">450</span>*<span class="number">5</span>*s, <span class="number">750</span>*<span class="number">5</span>*s)</span><br><span class="line">t.pencolor(<span class="string">"black"</span>)</span><br><span class="line">t.fillcolor(<span class="string">"red"</span>)</span><br><span class="line">t.speed(<span class="number">100</span>)</span><br><span class="line">t.penup()</span><br><span class="line">t.goto(<span class="number">0</span>, <span class="number">900</span>*s)</span><br><span class="line">t.pendown()</span><br><span class="line"><span class="comment"># 绘制花朵形状</span></span><br><span class="line">t.begin_fill()</span><br><span class="line">t.circle(<span class="number">200</span>*s,<span class="number">30</span>)</span><br><span class="line">DegreeCurve(<span class="number">60</span>, <span class="number">50</span>*s)</span><br><span class="line">t.circle(<span class="number">200</span>*s,<span class="number">30</span>)</span><br><span class="line">DegreeCurve(<span class="number">4</span>, <span class="number">100</span>*s)</span><br><span class="line">t.circle(<span class="number">200</span>*s,<span class="number">50</span>)</span><br><span class="line">DegreeCurve(<span class="number">50</span>, <span class="number">50</span>*s)</span><br><span class="line">t.circle(<span class="number">350</span>*s,<span class="number">65</span>)</span><br><span class="line">DegreeCurve(<span class="number">40</span>, <span class="number">70</span>*s)</span><br><span class="line">t.circle(<span class="number">150</span>*s,<span class="number">50</span>)</span><br><span class="line">DegreeCurve(<span class="number">20</span>, <span class="number">50</span>*s, <span class="number">-1</span>)</span><br><span class="line">t.circle(<span class="number">400</span>*s,<span class="number">60</span>)</span><br><span class="line">DegreeCurve(<span class="number">18</span>, <span class="number">50</span>*s)</span><br><span class="line">t.fd(<span class="number">250</span>*s)</span><br><span class="line">t.right(<span class="number">150</span>)</span><br><span class="line">t.circle(<span class="number">-500</span>*s,<span class="number">12</span>)</span><br><span class="line">t.left(<span class="number">140</span>)</span><br><span class="line">t.circle(<span class="number">550</span>*s,<span class="number">110</span>)</span><br><span class="line">t.left(<span class="number">27</span>)</span><br><span class="line">t.circle(<span class="number">650</span>*s,<span class="number">100</span>)</span><br><span class="line">t.left(<span class="number">130</span>)</span><br><span class="line">t.circle(<span class="number">-300</span>*s,<span class="number">20</span>)</span><br><span class="line">t.right(<span class="number">123</span>)</span><br><span class="line">t.circle(<span class="number">220</span>*s,<span class="number">57</span>)</span><br><span class="line">t.end_fill()</span><br><span class="line"><span class="comment"># 绘制花枝形状</span></span><br><span class="line">t.left(<span class="number">120</span>)</span><br><span class="line">t.fd(<span class="number">280</span>*s)</span><br><span class="line">t.left(<span class="number">115</span>)</span><br><span class="line">t.circle(<span class="number">300</span>*s,<span class="number">33</span>)</span><br><span class="line">t.left(<span class="number">180</span>)</span><br><span class="line">t.circle(<span class="number">-300</span>*s,<span class="number">33</span>)</span><br><span class="line">DegreeCurve(<span class="number">70</span>, <span class="number">225</span>*s, <span class="number">-1</span>)</span><br><span class="line">t.circle(<span class="number">350</span>*s,<span class="number">104</span>)</span><br><span class="line">t.left(<span class="number">90</span>)</span><br><span class="line">t.circle(<span class="number">200</span>*s,<span class="number">105</span>)</span><br><span class="line">t.circle(<span class="number">-500</span>*s,<span class="number">63</span>)</span><br><span class="line">t.penup()</span><br><span class="line">t.goto(<span class="number">170</span>*s,<span class="number">-30</span>*s)</span><br><span class="line">t.pendown()</span><br><span class="line">t.left(<span class="number">160</span>)</span><br><span class="line">DegreeCurve(<span class="number">20</span>, <span class="number">2500</span>*s)</span><br><span class="line">DegreeCurve(<span class="number">220</span>, <span class="number">250</span>*s, <span class="number">-1</span>)</span><br><span class="line"><span class="comment"># 绘制一个绿色叶子</span></span><br><span class="line">t.fillcolor(<span class="string">'green'</span>)</span><br><span class="line">t.penup()</span><br><span class="line">t.goto(<span class="number">670</span>*s,<span class="number">-180</span>*s)</span><br><span class="line">t.pendown()</span><br><span class="line">t.right(<span class="number">140</span>)</span><br><span class="line">t.begin_fill()</span><br><span class="line">t.circle(<span class="number">300</span>*s,<span class="number">120</span>)</span><br><span class="line">t.left(<span class="number">60</span>)</span><br><span class="line">t.circle(<span class="number">300</span>*s,<span class="number">120</span>)</span><br><span class="line">t.end_fill()</span><br><span class="line">t.penup()</span><br><span class="line">t.goto(<span class="number">180</span>*s,<span class="number">-550</span>*s)</span><br><span class="line">t.pendown()</span><br><span class="line">t.right(<span class="number">85</span>)</span><br><span class="line">t.circle(<span class="number">600</span>*s,<span class="number">40</span>)</span><br><span class="line"><span class="comment"># 绘制另一个绿色叶子</span></span><br><span class="line">t.penup()</span><br><span class="line">t.goto(<span class="number">-150</span>*s,<span class="number">-1000</span>*s)</span><br><span class="line">t.pendown()</span><br><span class="line">t.begin_fill()</span><br><span class="line">t.rt(<span class="number">120</span>)</span><br><span class="line">t.circle(<span class="number">300</span>*s,<span class="number">115</span>)</span><br><span class="line">t.left(<span class="number">75</span>)</span><br><span class="line">t.circle(<span class="number">300</span>*s,<span class="number">100</span>)</span><br><span class="line">t.end_fill()</span><br><span class="line">t.penup()</span><br><span class="line">t.goto(<span class="number">430</span>*s,<span class="number">-1070</span>*s)</span><br><span class="line">t.pendown()</span><br><span class="line">t.right(<span class="number">30</span>)</span><br><span class="line">t.circle(<span class="number">-600</span>*s,<span class="number">35</span>)</span><br><span class="line">t.done()</span><br></pre></td></tr></table></figure>
<h5 id="2-用Python画出奥运五环图"><a href="#2-用Python画出奥运五环图" class="headerlink" title="2. 用Python画出奥运五环图"></a>2. 用Python画出奥运五环图</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle</span><br><span class="line">turtle.width(<span class="number">10</span>)</span><br><span class="line">turtle.color(<span class="string">"blue"</span>)</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">turtle.color(<span class="string">"black"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">120</span>, <span class="number">0</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">turtle.color(<span class="string">"red"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">240</span>, <span class="number">0</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">turtle.color(<span class="string">"yellow"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">60</span>, <span class="number">-50</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">turtle.color(<span class="string">"green"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">180</span>, <span class="number">-50</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br></pre></td></tr></table></figure>
<h5 id="3-绘制多个同心圆"><a href="#3-绘制多个同心圆" class="headerlink" title="3. 绘制多个同心圆"></a>3. 绘制多个同心圆</h5><p><strong>代码如下</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle</span><br><span class="line"></span><br><span class="line">t = turtle.Pen()</span><br><span class="line">my_colors = (<span class="string">"red"</span>, <span class="string">"green"</span>, <span class="string">"yellow"</span>, <span class="string">"black"</span>)</span><br><span class="line">t.width(<span class="number">4</span>)</span><br><span class="line">t.speed(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):  <span class="comment"># 0 1 2 3 4</span></span><br><span class="line">    t.penup()</span><br><span class="line">    t.goto(<span class="number">0</span>, -i*<span class="number">10</span>)  <span class="comment"># 0, -100,-200,-300,-400</span></span><br><span class="line">    t.pendown()</span><br><span class="line">    t.color(my_colors[i%len(my_colors)])</span><br><span class="line">    t.circle(<span class="number">15</span>+i*<span class="number">10</span>)  <span class="comment"># 100,200,300, 400,, 500</span></span><br><span class="line">turtle.done()  <span class="comment"># 程序执行完，窗口仍然在</span></span><br></pre></td></tr></table></figure>
<p>执行结果如下图：<br><img src="https://img-blog.csdnimg.cn/20190717134956991.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2N1aV95b25naHVh,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h5 id="4-用Python-绘制-18-18-棋盘"><a href="#4-用Python-绘制-18-18-棋盘" class="headerlink" title="4. 用Python 绘制 18*18 棋盘"></a>4. 用Python 绘制 18*18 棋盘</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle</span><br><span class="line">width = <span class="number">30</span></span><br><span class="line">num = <span class="number">18</span></span><br><span class="line">x1 = [(<span class="number">-400</span>, <span class="number">400</span>), (<span class="number">-400</span>+width*num, <span class="number">400</span>)]</span><br><span class="line">y1 = [(<span class="number">-400</span>, <span class="number">400</span>), (<span class="number">-400</span>, <span class="number">400</span>-width*num)]</span><br><span class="line">t = turtle.Pen()</span><br><span class="line">t.speed(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">19</span>):</span><br><span class="line">    t.penup()</span><br><span class="line">    t.goto(x1[<span class="number">0</span>][<span class="number">0</span>], x1[<span class="number">0</span>][<span class="number">1</span>]<span class="number">-30</span>*i)</span><br><span class="line">    t.pendown()</span><br><span class="line">    t.goto(x1[<span class="number">1</span>][<span class="number">0</span>], x1[<span class="number">1</span>][<span class="number">1</span>]<span class="number">-30</span>*i)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">19</span>):</span><br><span class="line">    t.penup()</span><br><span class="line">    t.goto(y1[<span class="number">0</span>][<span class="number">0</span>]+<span class="number">30</span>*i,y1[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line">    t.pendown()</span><br><span class="line">    t.goto(y1[<span class="number">1</span>][<span class="number">0</span>]+<span class="number">30</span>*i,y1[<span class="number">1</span>][<span class="number">1</span>])</span><br><span class="line">t.hideturtle()  <span class="comment"># 隐藏画笔</span></span><br><span class="line">turtle.done()  <span class="comment"># 保证运行窗口不被自动关闭</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/python/python基础/20190304_操作excel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Think Different">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/python/python基础/20190304_操作excel/" itemprop="url">
                  python操作excel
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-04T15:24:20+08:00">
                2019-03-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>excel格式:<a href="https://www.cnblogs.com/fkissx/p/5617630.html" target="_blank" rel="noopener">https://www.cnblogs.com/fkissx/p/5617630.html</a></p>
<h4 id="1-类库xlwt-xlrd"><a href="#1-类库xlwt-xlrd" class="headerlink" title="1. 类库xlwt/xlrd"></a>1. 类库xlwt/xlrd</h4><ul>
<li>用于生成和读取比较老的excel文件，比如xls格式，最大限制为65535行；</li>
<li>文档地址：<a href="https://xlwt.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener">https://xlwt.readthedocs.io/en/latest/index.html</a></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">columns = [<span class="string">'日期'</span>, <span class="string">'PV'</span>, <span class="string">'UV'</span>, <span class="string">'name'</span>]</span><br><span class="line">datas = [</span><br><span class="line">    [<span class="string">'2019-07-15'</span>, <span class="string">'16000'</span>, <span class="string">'150'</span>, <span class="string">'Andy'</span>],</span><br><span class="line">    [<span class="string">'2020-02-15'</span>, <span class="string">'9000'</span>, <span class="string">'70'</span>, <span class="string">'李'</span>],</span><br><span class="line">    [<span class="string">'2015-07-15'</span>, <span class="string">'6000'</span>, <span class="string">'50'</span>, <span class="string">'张'</span>],</span><br><span class="line">    [<span class="string">'2020-01-15'</span>, <span class="string">'12000'</span>, <span class="string">'80'</span>, <span class="string">'刘'</span>],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> xlwt</span><br><span class="line">workbook = xlwt.Workbook(encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">sheet = workbook.add_sheet(<span class="string">'puvn_sheet'</span>)</span><br><span class="line"><span class="comment"># 写入标题</span></span><br><span class="line"><span class="keyword">for</span> col, columns <span class="keyword">in</span> enumerate(columns):</span><br><span class="line">    sheet.write(<span class="number">0</span>, col, columns)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入每一行</span></span><br><span class="line"><span class="keyword">for</span> row, data <span class="keyword">in</span> enumerate(datas):</span><br><span class="line">    <span class="keyword">for</span> col, columns_data <span class="keyword">in</span> enumerate(data):</span><br><span class="line">        sheet.write(row + <span class="number">1</span>, col, columns_data)</span><br><span class="line"></span><br><span class="line">workbook.save(<span class="string">'puvn_sheet.xls'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="2-类库openpyxl"><a href="#2-类库openpyxl" class="headerlink" title="2. 类库openpyxl"></a>2. 类库openpyxl</h4><ul>
<li>用于生成2010之后新的excel文件，比如xlsx格式；</li>
<li>文档地址：<a href="https://openpyxl.readthedocs.io/en/stable/" target="_blank" rel="noopener">https://openpyxl.readthedocs.io/en/stable/</a></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">columns = [<span class="string">'日期'</span>, <span class="string">'PV'</span>, <span class="string">'UV'</span>, <span class="string">'name'</span>]</span><br><span class="line">datas = [</span><br><span class="line">    [<span class="string">'2019-07-15'</span>, <span class="string">'16000'</span>, <span class="string">'150'</span>, <span class="string">'Andy'</span>],</span><br><span class="line">    [<span class="string">'2020-02-15'</span>, <span class="string">'9000'</span>, <span class="string">'70'</span>, <span class="string">'李'</span>],</span><br><span class="line">    [<span class="string">'2015-07-15'</span>, <span class="string">'6000'</span>, <span class="string">'50'</span>, <span class="string">'张'</span>],</span><br><span class="line">    [<span class="string">'2020-01-15'</span>, <span class="string">'12000'</span>, <span class="string">'80'</span>, <span class="string">'刘'</span>],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook</span><br><span class="line">wk = Workbook()</span><br><span class="line"><span class="comment"># 默认sheet</span></span><br><span class="line">sheet = wk.active</span><br><span class="line">sheet.title = <span class="string">'默认sheet'</span></span><br><span class="line">sheet.append(columns)</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> datas:</span><br><span class="line">    sheet.append(data)</span><br><span class="line"></span><br><span class="line">wk.save(<span class="string">'openpyxl.xlsx'</span>)  <span class="comment"># xls和xlsx均可</span></span><br></pre></td></tr></table></figure>
<h4 id="3-类库pandas"><a href="#3-类库pandas" class="headerlink" title="3. 类库pandas"></a>3. 类库pandas</h4><ul>
<li>pandas是最强大的数据分析库，自带python读取和生成模块；</li>
<li>文档地址：<a href="https://pandas.pydata.org/" target="_blank" rel="noopener">https://pandas.pydata.org/</a></li>
</ul>
<p>使用的是：pandas.DataFrame.to_excel</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/python/python基础/20190303_sqlchemy的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Think Different">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/python/python基础/20190303_sqlchemy的使用/" itemprop="url">
                  sqlalchemy的使用
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-03T15:24:20+08:00">
                2019-03-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h4 id="1-连接数据库"><a href="#1-连接数据库" class="headerlink" title="1. 连接数据库"></a>1. 连接数据库</h4><p>使用create_engine()实现连接，需要了解create_engine()各个参数的作用<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 连接数据库</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line">engine = create_engine(</span><br><span class="line">    <span class="string">"mysql+pymysql://root:1990@localhost:3306/crawl_test?charset=utf8"</span>,</span><br><span class="line">    echo=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></p>
<h4 id="2-创建数据表"><a href="#2-创建数据表" class="headerlink" title="2. 创建数据表"></a>2. 创建数据表</h4><p>定义实体映射类数据表结构，通过操作类属性从而操作数据表字段</p>
<p>创建表结构的方式<br>创建一个自增的数字主键！！！：不需要特意的设定，SQLAlchemy will automatically set the first Integer PK column that’s not marked as a FK as autoincrement=True</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建数据表方法一</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, Integer, String, DateTime</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mytable</span><span class="params">(Base)</span>:</span></span><br><span class="line">    <span class="comment"># 表名</span></span><br><span class="line">    __tablename__ = <span class="string">'mytable'</span></span><br><span class="line">    <span class="comment"># 字段，属性</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">50</span>), unique=<span class="literal">True</span>)</span><br><span class="line">    age = Column(Integer)</span><br><span class="line">    birth = Column(DateTime)</span><br><span class="line">    class_name = Column(String(<span class="number">50</span>))</span><br><span class="line"></span><br><span class="line">Base.metadata.create_all(engine)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建数据表方法二</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, MetaData, ForeignKey, Table</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.dialects.mysql <span class="keyword">import</span> (INTEGER, CHAR)</span><br><span class="line">meta = MetaData()</span><br><span class="line">myclass = Table(<span class="string">'myclass'</span>, meta,</span><br><span class="line">                Column(<span class="string">'id'</span>, INTEGER, primary_key=<span class="literal">True</span>),</span><br><span class="line">                Column(<span class="string">'name'</span>, CHAR(<span class="number">50</span>), ForeignKey(mytable.name)),</span><br><span class="line">                Column(<span class="string">'class_name'</span>, CHAR(<span class="number">50</span>))</span><br><span class="line">                )</span><br><span class="line">myclass.create(bind=engine)</span><br></pre></td></tr></table></figure>
<p>删除数据表：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除数据表</span></span><br><span class="line">StudentItem.drop(bind=engine)</span><br><span class="line">Base.metadata.drop_all(engine)</span><br></pre></td></tr></table></figure></p>
<h4 id="3-创建持久化对象"><a href="#3-创建持久化对象" class="headerlink" title="3. 创建持久化对象"></a>3. 创建持久化对象</h4><p>引入sessionmaker模块，绑定已连接数据库的engin对象，生成会话对象session</p>
<h4 id="4-添加数据"><a href="#4-添加数据" class="headerlink" title="4. 添加数据"></a>4. 添加数据</h4><p>对实体类的属性赋值，通过session.add()方法添加数据，通过session.commit()方法提交数据。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">new_data = mytable(name=<span class="string">'Li Lei'</span>,age=<span class="number">10</span>,birth=<span class="string">'2017-10-01'</span>,class_name=<span class="string">'一年级一班'</span>)</span><br><span class="line">session.add(new_data)</span><br><span class="line">session.commit()</span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure></p>
<h4 id="5-更新数据"><a href="#5-更新数据" class="headerlink" title="5. 更新数据"></a>5. 更新数据</h4><p>先查询需要修改的数据对象再更新，更新方法有修改对象属性值 和 使用update()方法更新数据。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">session.query(mytable).filter_by(id=<span class="number">1</span>).update(&#123; mytable.age : <span class="number">12</span>&#125;)</span><br><span class="line">session.commit()</span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure></p>
<h4 id="6-删除数据"><a href="#6-删除数据" class="headerlink" title="6. 删除数据"></a>6. 删除数据</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">session.query(mytable).filter_by(id=<span class="number">1</span>).delete()</span><br><span class="line">session.commit()</span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure>
<h4 id="7-查询数据"><a href="#7-查询数据" class="headerlink" title="7. 查询数据"></a>7. 查询数据</h4><p>filter_by相当于SQL语句里面的where判断;<br>join相当于SQL语句中的inner join ;<br>outerjoin相当于full outer join ;</p>
<p>1、查询myclass全部数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询myclass全部数据，相当于select * from myclass;</span></span><br><span class="line"><span class="comment"># all()是将数据以列表的形式返回</span></span><br><span class="line">get_data = session.query(myclass).all()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> get_data:</span><br><span class="line">    print(<span class="string">'我的名字是：'</span> + i.name)</span><br><span class="line">    print(<span class="string">'我的班级是：'</span> + i.class_name)</span><br><span class="line">session.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询某些字段，相当于select name, class_name from myclass;</span></span><br><span class="line">get_data = session.query(myclass.name, myclass.class_name).all()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> get_data:</span><br><span class="line">    print(<span class="string">'我的名字是：'</span> + i.name)</span><br><span class="line">    print(<span class="string">'我的班级是：'</span> + i.class_name)</span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure></p>
<p>2、设置筛选条件<br>filter和filter_by</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据条件查询某条数据</span></span><br><span class="line"><span class="comment"># 筛选方法一：</span></span><br><span class="line"><span class="comment"># get_data = session.query(myclass).filter(myclass.id==1).all()</span></span><br><span class="line"><span class="comment"># 筛选方法二：</span></span><br><span class="line">get_data = session.query(myclass).filter_by(id=<span class="number">1</span>).all()</span><br><span class="line">print(<span class="string">'数据类型是：'</span> + str(type(get_data)))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> get_data:</span><br><span class="line">    print(<span class="string">'我的名字是：'</span> + i.name)</span><br><span class="line">    print(<span class="string">'我的班级是：'</span> + i.class_name)</span><br></pre></td></tr></table></figure>
<p>把all()换成first()可以查询1条数据：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询id为1的数据</span></span><br><span class="line">single_stu = session.query(StudentItem).filter_by(stu_id=stu_id).first()</span><br></pre></td></tr></table></figure></p>
<p>3、设置多筛选条件：</p>
<p>带and的查询，如：select * from mytable where id&gt;1 and class_name=’三年级二班’，代码如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">get_data = session.query(mytable).filter(mytable.id &gt;= <span class="number">2</span>, </span><br><span class="line">             mytable.class_name == <span class="string">'三年级二班'</span>).first()</span><br><span class="line">print(<span class="string">'数据类型是：'</span> + str(type(get_data)))</span><br><span class="line">print(<span class="string">'我的名字是：'</span> + get_data.name)</span><br><span class="line">print(<span class="string">'我的班级是：'</span> + get_data.class_name)</span><br></pre></td></tr></table></figure></p>
<p>带or的查询，如：select * from mytable where id&gt;1 and class_name=’三年级二班’，代码如下:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> or_</span><br><span class="line">get_data = session.query(mytable).filter(or_(mytable.id &gt;= <span class="number">2</span>,</span><br><span class="line">                                         mytable.class_name == <span class="string">'三年级二班'</span>)).all()</span><br><span class="line">print(<span class="string">'数据类型是：'</span> + str(type(get_data)))</span><br><span class="line">print(<span class="string">'我的名字是：'</span> + get_data.name)</span><br><span class="line">print(<span class="string">'我的班级是：'</span> + get_data.class_name)</span><br></pre></td></tr></table></figure></p>
<p>涉及多表查询的内连接查询和外连接查询：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 内连接</span></span><br><span class="line">get_data = session.query(mytable).join(myclass).filter(mytable.class_name == <span class="string">'三年级二班'</span>).all()</span><br><span class="line">print(<span class="string">'数据类型是：'</span> + str(type(get_data)))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> get_data:</span><br><span class="line">    print(<span class="string">'我的名字是：'</span> + i.name)</span><br><span class="line">    print(<span class="string">'我的班级是：'</span> + i.class_name)</span><br><span class="line"><span class="comment"># 外连接</span></span><br><span class="line">get_data = session.query(mytable).outerjoin(</span><br><span class="line">             myclass).filter(mytable.class_name == <span class="string">'三年级二班'</span>).all()</span><br></pre></td></tr></table></figure></p>
<p>4、涉及复杂的查询语句，特别涉及多表查询和复杂的查询条件时，可直接执行sql语句：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sql = <span class="string">'select * from mytable '</span></span><br><span class="line">session.execute(sql)</span><br><span class="line"><span class="comment"># 如果涉及更新，添加数据，需要session.commit()</span></span><br><span class="line">session.commit()</span><br></pre></td></tr></table></figure></p>
<h4 id="8-综合案例-1"><a href="#8-综合案例-1" class="headerlink" title="8. 综合案例(1)"></a>8. 综合案例(1)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接数据库</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, Integer, String, DateTime</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"></span><br><span class="line">engine = create_engine(<span class="string">"mysql+pymysql://root:12345678@localhost:3306/my_test?charset=utf8"</span>, echo=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentItem</span><span class="params">(Base)</span>:</span></span><br><span class="line">    <span class="string">"""创建数据表方法一"""</span></span><br><span class="line">    <span class="comment"># 表名</span></span><br><span class="line">    __tablename__ = <span class="string">'my_student'</span></span><br><span class="line">    <span class="comment"># 字段，属性</span></span><br><span class="line">    stu_id = Column(Integer, primary_key=<span class="literal">True</span>, autoincrement=<span class="literal">True</span>)</span><br><span class="line">    stu_name = Column(String(<span class="number">50</span>), unique=<span class="literal">True</span>)</span><br><span class="line">    stu_age = Column(Integer)</span><br><span class="line">    stu_birth = Column(DateTime)</span><br><span class="line">    stu_class_name = Column(String(<span class="number">50</span>))</span><br></pre></td></tr></table></figure>
<p>sqlalchemy_test.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line"><span class="keyword">from</span> crawl_test.orm <span class="keyword">import</span> Base, engine, StudentItem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">get_session = sessionmaker(bind=engine)  <span class="comment"># 可设置autocommit=True  对当前session进行设置</span></span><br><span class="line">session = get_session()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_table</span><span class="params">(engine)</span>:</span></span><br><span class="line">    <span class="string">"""创建表"""</span></span><br><span class="line">    Base.metadata.create_all(engine)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_one</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""向表中添加数据"""</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        new_data = StudentItem(stu_name=<span class="string">'王五'</span>, stu_age=<span class="number">30</span>, stu_birth=<span class="string">'2005-06-09'</span>, stu_class_name=<span class="string">'六年级4班'</span>)</span><br><span class="line">        session.add(new_data)</span><br><span class="line">        session.commit()</span><br><span class="line">        print(<span class="string">'向表中添加单条数据成功'</span>)</span><br><span class="line">        session.close()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        session.rollback()</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">f'向数据库添加数据失败 ：<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">query_one</span><span class="params">(stu_id=None, stu_name=None)</span>:</span></span><br><span class="line">    <span class="string">"""根据id或者名字查询,返回字典"""</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> stu_id:</span><br><span class="line">            single_stu = session.query(StudentItem).filter_by(stu_id=stu_id).first()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            single_stu = session.query(StudentItem).filter_by(stu_name=stu_name).first()</span><br><span class="line">        single_stu_dict = single_stu.__dict__</span><br><span class="line">        <span class="keyword">return</span> single_stu_dict</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        session.rollback()</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">f'数据库查询失败 ：<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        session.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">query_all</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""查询所有数据，返回一个列表"""</span></span><br><span class="line">    stu_data_list = []</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        stu_data = session.query(StudentItem).all()</span><br><span class="line">        <span class="comment"># 遍历对象的列表，并转换成字典</span></span><br><span class="line">        <span class="keyword">for</span> stu <span class="keyword">in</span> stu_data:</span><br><span class="line">            stu_dict = stu.__dict__</span><br><span class="line">            stu_data_list.append(stu_dict)</span><br><span class="line">        <span class="keyword">return</span> stu_data_list</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        session.rollback()</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">f'数据库查询失败 ：<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        session.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_stu_data</span><span class="params">(stu_id=None, stu_name=None, stu_data_dict=None)</span>:</span></span><br><span class="line">    <span class="string">"""根据id或者名字来修改数据"""</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> stu_id:</span><br><span class="line">            result = session.query(StudentItem).filter_by(stu_id=stu_id).update(stu_data_dict)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result = session.query(StudentItem).filter_by(stu_name=stu_name).update(stu_data_dict)</span><br><span class="line">        print(<span class="string">'修改成功'</span>, result)</span><br><span class="line">        session.commit()</span><br><span class="line">        session.close()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        session.rollback()</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">f'修改数据失败 ：<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_stu_data</span><span class="params">(stu_id=None, stu_name=None)</span>:</span></span><br><span class="line">    <span class="string">"""删除一个数据"""</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> stu_id:</span><br><span class="line">            ret = session.query(StudentItem).filter(StudentItem.stu_id == stu_id).delete()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ret = session.query(StudentItem).filter(StudentItem.stu_name == stu_name).delete()</span><br><span class="line">        print(<span class="string">'删除成功'</span>, ret)</span><br><span class="line">        session.commit()</span><br><span class="line">        session.close()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        session.rollback()</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">f'删除数据失败 ：<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># create_table(engine)</span></span><br><span class="line">    <span class="comment"># 增加一个数据</span></span><br><span class="line">    <span class="comment"># add_one()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询：根据id或者姓名查询单个数据</span></span><br><span class="line">    stu_data = query_one(stu_id=<span class="number">6</span>)</span><br><span class="line">    print(stu_data[<span class="string">'stu_name'</span>])</span><br><span class="line">    <span class="comment"># 查询：所有数据</span></span><br><span class="line">    <span class="comment"># stu_data_list = query_all()</span></span><br><span class="line">    <span class="comment"># for stu_data in stu_data_list:</span></span><br><span class="line">    <span class="comment">#     print(stu_data)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 更新数据</span></span><br><span class="line">    <span class="comment"># data_dict = &#123;</span></span><br><span class="line">    <span class="comment">#     StudentItem.stu_age: 42,</span></span><br><span class="line">    <span class="comment">#     StudentItem.stu_name: '张君宝'</span></span><br><span class="line">    <span class="comment"># &#125;</span></span><br><span class="line">    <span class="comment"># update_stu_data(stu_name='张无忌', stu_data_dict=data_dict)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 删除数据</span></span><br><span class="line">    <span class="comment"># delete_stu_data(stu_id=3)</span></span><br></pre></td></tr></table></figure></p>
<h4 id="9-综合案例（2）"><a href="#9-综合案例（2）" class="headerlink" title="9. 综合案例（2）"></a>9. 综合案例（2）</h4><p>1、创建一个schema:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Base = declarative_base() <span class="comment">#生成orm基类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AlchemyTest</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'tbSqlAlchemyTest'</span> <span class="comment">#这里不用加上dbo.前缀，默认已经有了</span></span><br><span class="line"></span><br><span class="line">    TestName = Column(String(<span class="number">256</span>), primary_key=<span class="literal">True</span>)</span><br><span class="line">    TestNumber = Column(INTEGER)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#the table object is a member of a larger collection known as MetaData</span></span><br><span class="line">Base.metadata.create_all(engine) <span class="comment">#通过基类与数据库进行交互创建表结构，此时表内还没有数据</span></span><br></pre></td></tr></table></figure></p>
<p>还可以在创建class的末尾加上类似于：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;User(name='%s', fullname='%s', password='%s')&gt;"</span> % (</span><br><span class="line">                                self.name, self.fullname, self.password)</span><br></pre></td></tr></table></figure></p>
<p>这个为可选项，只是增加对于表的描述，便于以后测试</p>
<p>向表内加入数据：<br>先创建一个实例：<code>test1 = AlchemyTest(TestName=&#39;user1&#39;, TestNumber=1995)</code></p>
<p>再创建一个会话：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line"></span><br><span class="line">Session_class = sessionmaker(bind=engine) <span class="comment">#建立与数据库的会话连接，这里建立的是一个class不是一个实例对象</span></span><br><span class="line">session = Session_class() <span class="comment">#这里创建一个会话实例</span></span><br><span class="line">test1 = AlchemyTest(TestName=<span class="string">'user1'</span>, TestNumber=<span class="number">1995</span>)</span><br><span class="line">session.add(test1) <span class="comment">#把要创建的数据对象加入到这个会话中，这个时候是pending状态，添加多个对象使用add_all()</span></span><br><span class="line">session.commit() <span class="comment">#统一提交会话中的操作</span></span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure></p>
<p>在提交这个会话之前就可以使用：<code>our_user = session.query(User).filter_by(name=&#39;ed&#39;).first()</code> 来查看刚刚创建的数据<br>在会话提交之前，还可以这样回滚这个会话，使之前flush的内容失效： <code>session.rollback()</code><br>每个session会话才是真正的与数据库的连接</p>
<p>2、建立表与表之间的关系（一对多，多对一）：</p>
<p>多对一：employee对于department是多对一的关系<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Department</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'department'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">30</span>))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'employee'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">30</span>))</span><br><span class="line">    dep_id = Column(Integer, ForeignKey(<span class="string">'department.id'</span>))</span><br><span class="line">    department = relationship(<span class="string">"Department"</span>)</span><br></pre></td></tr></table></figure></p>
<p>一对多：department对于employee是一对多的关系<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Department</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'department'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">30</span>))</span><br><span class="line">    employees = relationship(<span class="string">"Employee"</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'employee'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">30</span>))</span><br><span class="line">    dep_id = Column(Integer, ForeignKey(<span class="string">'department.id'</span>))</span><br></pre></td></tr></table></figure></p>
<p><strong>新建一个tbSqlAlchemyTestError的table</strong> 一个test可以有多个error<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AlchemyTestError</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'tbSqlAlchemyTestError'</span></span><br><span class="line"></span><br><span class="line">    errorID = Column(INTEGER, primary_key=<span class="literal">True</span>)</span><br><span class="line">    errorname = Column(String(<span class="number">256</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    TestName = Column(String(<span class="number">256</span>), ForeignKey(<span class="string">'tbSqlAlchemyTest.TestName'</span>))<span class="comment">#这里面关联外键使用表的名字而不是类的名字,表与表之间建立联系</span></span><br><span class="line"></span><br><span class="line">    test = relationship(<span class="string">"AlchemyTest"</span>, back_populates=<span class="string">"error"</span>)</span><br><span class="line">    <span class="comment">#告诉ORM,自己这个class与AlchemyTest这个class相关联，并且设定了一个“多对一”的关系</span></span><br><span class="line">    <span class="comment">#*在自己这个类中生成一个test属性，然后在AlchemyTest类中创建一个error属性，与之关联，可以反向查询*</span></span><br><span class="line"></span><br><span class="line">AlchemyTest.error = relationship(<span class="string">"AlchemyTestError"</span>, back_populates=<span class="string">"test"</span>)</span><br><span class="line"><span class="comment">#与上面一个relationship形成双向relationship，意思是在AlchemyTest类中生成一个error属性，然后与AlchemyTestError中的test属性相关联</span></span><br><span class="line"><span class="comment">#所以实际上与上面一个relationship是一样的意思</span></span><br></pre></td></tr></table></figure></p>
<p>给一对多的关系表插入数据：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">test1 = session.query(AlchemyTest).filter(AlchemyTest.TestName == <span class="string">'user1'</span>).first() <span class="comment">#首先提取需要加入error的test，这个已经存在</span></span><br><span class="line">test1.error = [AlchemyTestError(errorID=<span class="string">'553'</span>, errorname=<span class="string">'cuowu'</span>),</span><br><span class="line">               AlchemyTestError(errorID=<span class="string">'667'</span>, errorname=<span class="string">'afsf'</span>)] <span class="comment">#使用relationship()时建立的error属性来给AlchemyTestError插入数据</span></span><br><span class="line">session.add(test1)</span><br><span class="line">session.commit()stmt</span><br></pre></td></tr></table></figure></p>
<p>使用query.join()结合两张表来查询数据表数据：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">result = session.query(AlchemyTest).join(AlchemyTestError).filter(AlchemyTestError.errorname == <span class="string">'cuowu'</span>).first() <span class="comment">#查询AlchemyTest表内的数据，看哪些user有这个error</span></span><br><span class="line"><span class="keyword">if</span> result <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">    print(result.TestName)</span><br></pre></td></tr></table></figure></p>
<p>因为这两张表只有一个外键，所以query.join()知道怎么关联这两张表，但是如果没有或者不止一个外键的时候，使用其他的形式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = session.query(AlchemyTest).join((AlchemyTestError, AlchemyTest.TestName==AlchemyTestError.TestName)).first()</span><br></pre></td></tr></table></figure>
<p>这里有一个join的reminder：<br>join : 如果表中有至少一个匹配，则返回行<br>left join : 即使右表中没有匹配，也从左表返回所有的行<br>right join : 即使左表中没有匹配，也从右表返回所有的行<br>full join : 只要其中一个表中存在匹配，就返回行</p>
<p>outerjoin: <code>query.outerjoin(User.addresses) # LEFT OUTER JOIN</code></p>
<p>使用别名：<br>当一个table需要被call多次的时候，使用别名aliased()可以弄清：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name1 = aliased(AlchemyTest)</span><br><span class="line">name2 = aliased(AlchemyTest)</span><br></pre></td></tr></table></figure></p>
<p>使用subquery()来做子查询：<br>这个例子用于查询每个AlchemyTest的TestName对应了几个error：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">stmt = session.query(AlchemyTestError.TestName, func.count(<span class="string">'*'</span>).label(<span class="string">'errorcount'</span>)).group_by(AlchemyTestError.TestName).subquery() <span class="comment">#一定要使用subquery()才能使这个临时表生效</span></span><br><span class="line"><span class="comment">#相当于生成了一个临时表，stmt它具有表结构，这个表结构的数据我们通过"c"这个属性来获取</span></span><br><span class="line"><span class="keyword">for</span> user, count <span class="keyword">in</span> session.query(AlchemyTest, stmt.c.errorcount).outerjoin(stmt, AlchemyTest.TestName==stmt.c.TestName).order_by(AlchemyTest.TestName):</span><br><span class="line"><span class="comment">#这里相当于SELECT user FROM AlchemyTest, SELECT count FROM stmt.c.errorcount LEFT OUTER JOIN stmt ON (AlchemyTest.TestName==stmt.c.TestName)</span></span><br><span class="line">    print(user.TestName, count)</span><br></pre></td></tr></table></figure></p>
<p>使用exists()：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stmt = exists().where(Address.user_id==User.id)</span><br><span class="line"><span class="keyword">for</span> name, <span class="keyword">in</span> session.query(User.name).filter(stmt):</span><br><span class="line">     print(name)</span><br></pre></td></tr></table></figure></p>
<p>一些描述关系的方法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">query.filter(User.addresses.contains(someaddress))</span><br><span class="line">query.filter(User.addresses.any(Address.email_address == <span class="string">'bar'</span>))</span><br><span class="line">query.filter(Address.user.has(name=<span class="string">'ed'</span>))</span><br><span class="line">session.query(Address).with_parent(someuser, <span class="string">'addresses'</span>)</span><br></pre></td></tr></table></figure></p>
<p>删除数据：<br>删除可以直接使用<code>session.delete()</code><br>但是与之关联的table并没有删除数据，因为SQLAlchemy并没有设定级联删除！！！<br>解决方案：<br>在一对多关系的table里的relationship设定时增加cascade：<br><code>cascade=&quot;all, delete, delete-orphan”</code></p>
<p>建立多对多关系的表结构：<br>例子中有两个tables，分别是博客表和关键字表，一篇博客可以拥有多个关键字，一个关键字也可以对应多篇博客。<br>所以我们要建立一个未映射的关系表：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">post_keywords = Table(<span class="string">'post_keywords'</span>, Base.metadata,</span><br><span class="line"><span class="meta">... </span>    Column(<span class="string">'post_id'</span>, ForeignKey(<span class="string">'posts.id'</span>), primary_key=<span class="literal">True</span>),</span><br><span class="line"><span class="meta">... </span>    Column(<span class="string">'keyword_id'</span>, ForeignKey(<span class="string">'keywords.id'</span>), primary_key=<span class="literal">True</span>)</span><br><span class="line"><span class="meta">... </span>)</span><br></pre></td></tr></table></figure></p>
<p>这个表建立的方式与建立一个拥有映射关系的class不同。接下来创建博客表和关键字表分别与这个中间关系表用relationship()关联起来：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">BlogPost</span><span class="params">(Base)</span>:</span></span><br><span class="line"><span class="meta">... </span>    __tablename__ = <span class="string">'posts'</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    id = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line"><span class="meta">... </span>    user_id = Column(Integer, ForeignKey(<span class="string">'users.id'</span>))</span><br><span class="line"><span class="meta">... </span>    headline = Column(String(<span class="number">255</span>), nullable=<span class="literal">False</span>)</span><br><span class="line"><span class="meta">... </span>    body = Column(Text)</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    <span class="comment"># many to many BlogPost&lt;-&gt;Keyword</span></span><br><span class="line"><span class="meta">... </span>    keywords = relationship(<span class="string">'Keyword'</span>,</span><br><span class="line"><span class="meta">... </span>                            secondary=post_keywords,</span><br><span class="line"><span class="meta">... </span>                            back_populates=<span class="string">'posts'</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, headline, body, author)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.author = author</span><br><span class="line"><span class="meta">... </span>        self.headline = headline</span><br><span class="line"><span class="meta">... </span>        self.body = body</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> <span class="string">"BlogPost(%r, %r, %r)"</span> % (self.headline, self.body, self.author)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Keyword</span><span class="params">(Base)</span>:</span></span><br><span class="line"><span class="meta">... </span>    __tablename__ = <span class="string">'keywords'</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    id = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line"><span class="meta">... </span>    keyword = Column(String(<span class="number">50</span>), nullable=<span class="literal">False</span>, unique=<span class="literal">True</span>)</span><br><span class="line"><span class="meta">... </span>    posts = relationship(<span class="string">'BlogPost'</span>,</span><br><span class="line"><span class="meta">... </span>                         secondary=post_keywords,</span><br><span class="line"><span class="meta">... </span>                         back_populates=<span class="string">'keywords'</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, keyword)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.keyword = keyword</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/python/python基础/20190302_sqlalchemy的一些概念/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Think Different">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/python/python基础/20190302_sqlalchemy的一些概念/" itemprop="url">
                  sqlalchemy的一些概念
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-02T15:24:20+08:00">
                2019-03-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>官网：<a href="https://www.sqlalchemy.org/" target="_blank" rel="noopener">https://www.sqlalchemy.org/</a></p>
<p>Python SQLAlchemy Cheatsheet ： <a href="https://www.pythonsheets.com/notes/python-sqlalchemy.html" target="_blank" rel="noopener">https://www.pythonsheets.com/notes/python-sqlalchemy.html</a><br>官方文档：<a href="https://docs.sqlalchemy.org/en/latest/orm/tutorial.html" target="_blank" rel="noopener">https://docs.sqlalchemy.org/en/latest/orm/tutorial.html</a></p>
<p>首先 <code>import sqlalchemy</code><br>可以这样检查版本 <code>sqlalchemy.__version__</code></p>
<h4 id="1-sqlalchemy-简介"><a href="#1-sqlalchemy-简介" class="headerlink" title="1. sqlalchemy 简介"></a>1. sqlalchemy 简介</h4><p>开发人员常用的关系数据库有MySQL,Oracle, SQL Server, SQLite和PostgreSQL，操作数据库的方法大致有以下2种：</p>
<ul>
<li>直接使用数据库接口连接：在python的数据库连接模块中，分别有pymysql,cx_Oracle,pymssql,sqlite3,psycopg2。通常这类数据库的操作步骤是：连接数据库，执行SQL语句，提交事务，关闭数据库连接。每次操作都需要开启/关闭连接，这么频繁，对系统来说是一种浪费。</li>
<li>通过orm框架来操作数据库：ORM(Object/Relation Mapping)对象-关系映射，主要实现对象到关系数据库的映射（或者说就是在python中设定一个类，在mysql中定义一个表，把关系数据库的表结构映射到这个类上），在实际工作中，企业级开发都是使用orm框架来实现数据库持久化操作的。</li>
</ul>
<p>常用的ORM框架模块有：SQLObject,stom,Django的ORM,peewee和SQLAlchemy。</p>
<p><strong>SQLAlchemy</strong> 是 python 语言中一个比较有名的 ORM 框架。用于连接、操作数据库。提供SQL工具包以及对象-关系映射工具，使用MIT许可证发行。</p>
<ul>
<li>首次发行于2006年2月，是python社区广泛使用的orm工具之一，不亚于Django的orm框架。</li>
<li>和传统直接操作SQL相比, 使用SQLAlchemy的对象来操作数据库更为直观.SQLAlchemy 内建数据库连接池，解决了连接操作相关繁琐的处理，提供方便的强大的log功能。</li>
<li>类似java里的Hiernate的数据映射模型。</li>
</ul>
<h4 id="2-sqlalchemy-orm优缺点和适用范围"><a href="#2-sqlalchemy-orm优缺点和适用范围" class="headerlink" title="2. sqlalchemy orm优缺点和适用范围"></a>2. sqlalchemy orm优缺点和适用范围</h4><p>1、优点:  </p>
<ul>
<li>简单：ORM以最基本的形式建模数据。表的字段就是这个类的成员变量  </li>
<li>可读性：ORM使数据库结构文档化。比如MySQL数据库就被ORM转换为了class类，程序员可以只把注意力放在代码逻辑上（当然能够熟练掌握MySQL更好）  </li>
<li>可用性：ORM的避免了不规范、冗余、风格不统一的SQL语句，可以避免很多人为Bug，方便编码风格的统一和后期维护  </li>
<li>可维护性：在数据表结构甚至数据库发生改变时，减少了相应的代码修改;可以很方便地引入数据缓存之类的附加功能  </li>
</ul>
<p>2、缺点:  </p>
<ul>
<li>自动化进行关系数据库的映射需要消耗系统性能。一般来说都可以忽略之，特别是有cache存在的时候  </li>
<li>在处理多表联查、where条件复杂之类的查询时，ORM的语法会变得复杂  </li>
<li>越是功能强大的ORM越是消耗内存，因为一个ORM Object会带有很多成员变量和成员函数。</li>
</ul>
<p>3、适用范围：适用于快速开发和团队合作开发，不适用于有大数据量(千万/亿级别)、大运算量、复杂查询的系统。</p>
<h4 id="3-主流数据库的连接方式"><a href="#3-主流数据库的连接方式" class="headerlink" title="3. 主流数据库的连接方式"></a>3. 主流数据库的连接方式</h4><p>1、首先安装需要的模块：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install SQLAlchemy</span><br><span class="line"><span class="comment"># 如mysql数据库需要长pymysql模块</span></span><br><span class="line">pip install pymysql</span><br></pre></td></tr></table></figure></p>
<p>2、主流数据库的连接方式：</p>
<table>
<thead>
<tr>
<th>数据库</th>
<th>连接字符串</th>
</tr>
</thead>
<tbody>
<tr>
<td>Microsoft SQL Server</td>
<td>mssql+pymssql://username:password@ip:port/dbname</td>
</tr>
<tr>
<td>MySQL</td>
<td>mysql+pymysql://username:password@ip:port/dbname</td>
</tr>
<tr>
<td>Oracle</td>
<td>cx_Oracle://username:password@ip:port/dbname</td>
</tr>
<tr>
<td>PostgreSQL</td>
<td>postgressql://username:password@ip:port/dbname</td>
</tr>
<tr>
<td>SQLite</td>
<td>sqlite://file_path</td>
</tr>
</tbody>
</table>
<h4 id="4-连接实例-获取session"><a href="#4-连接实例-获取session" class="headerlink" title="4. 连接实例(获取session)"></a>4. 连接实例(获取session)</h4><blockquote>
<p>连接数据库实例3个步骤：  </p>
<pre><code>1. 创建engine  
2. sessionmaker绑定engine  
3. 创建session实例  
</code></pre></blockquote>
<p>create_engin的参数及session的创建如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 已连接mysql为例</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">engine = create_engine(</span><br><span class="line">    <span class="comment"># 'postgresql+psycopg2://&#123;&#125;:&#123;&#125;@&#123;&#125;:&#123;&#125;/&#123;&#125;'.format(   连接postgresql</span></span><br><span class="line">    <span class="string">'mysql+pymysql://&#123;&#125;:&#123;&#125;@&#123;&#125;:&#123;&#125;/&#123;&#125;'</span>.format(    <span class="comment"># 连接mysql</span></span><br><span class="line">    POSTGRESQL_USER_NAME, </span><br><span class="line">    POSTGRESQL_PASSWORD, </span><br><span class="line">    POSTGRESQL_HOST, </span><br><span class="line">    POSTGRESQL_PORT, </span><br><span class="line">    POSTGRESQL_DB_NAME</span><br><span class="line">    ),</span><br><span class="line">    echo=Fase,          <span class="comment"># -- 如果为真，引擎将记录所有语句   用于调试</span></span><br><span class="line">    echo_pool=<span class="literal">False</span>,    <span class="comment"># -- 如果为true，则连接池将记录信息输出，例如连接失效以及连接回收到默认日志处理程序，用于调试</span></span><br><span class="line">    encoding=<span class="string">'utf-8'</span>,   <span class="comment"># 默认为 utf-8 . 这是sqlAlchemy用于在sqlAlchemy中发生的字符串编码/解码操作的字符串编码</span></span><br><span class="line">    pool_size=<span class="number">5</span>,   <span class="comment">#-- 设置连接数，默认设置5个连接数，设置为0表示没有限制</span></span><br><span class="line">    max_overflow=<span class="number">10</span>,    <span class="comment"># -- 允许在连接池中“溢出”的连接数，即可以在池大小设置（默认为5）之上或之外打开的连接数，默认连接数为10。</span></span><br><span class="line">    pool_timeout=<span class="number">30</span>,    <span class="comment">#  -- 连接超时时间，默认为30秒，超过时间的连接都会连接失败。即在放弃从池中获取连接之前等待的秒数</span></span><br><span class="line">    isolation_level=<span class="string">"AUTOCOMMIT"</span>  <span class="comment"># 设置引擎范围内的事务隔离级别隔离</span></span><br><span class="line">    pool_recycle=<span class="number">-1</span>  <span class="comment"># 连接重置周期，默认为-1，推荐设置7200，即如果连接数已空闲7200秒，就自动重新获取，以防止连接被关闭。</span></span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Session = sessionmaker(bind=engine)</span><br><span class="line">session = Session()</span><br><span class="line"></span><br><span class="line"><span class="comment">#可以把 sessionmaker 想象成一个手机，engine 当做数据库的号码，拨通这个“号码”我们就创建了一个 Session 类。</span></span><br></pre></td></tr></table></figure></p>
<h4 id="5-设置事务级别-isolation-level"><a href="#5-设置事务级别-isolation-level" class="headerlink" title="5. 设置事务级别  isolation_level"></a>5. 设置事务级别  isolation_level</h4><p>置引擎范围内的事务隔离级别隔离:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create_engine(isolation_level=<span class="string">"READ_COMMITTED"</span>)  <span class="comment"># 事务隔离级别   对engine范围设置</span></span><br></pre></td></tr></table></figure></p>
<p>可选值如下:</p>
<table>
<thead>
<tr>
<th>值</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>SERIALIZABLE</td>
<td>串行读</td>
<td>完全串行化的读，每次读都需要获得表级共享锁，读写相互都会阻塞</td>
</tr>
<tr>
<td>REPEATABLE_READ</td>
<td>可重复读</td>
<td>确保同一事务的多个实例在并发读取数据时，会看到同样的数据行，InnoDB默认级别。在SQL标准中，该隔离级别消除了不可重复读，但是还存在幻读    MySQL默认隔离级别；</td>
</tr>
<tr>
<td>READ_COMMITTED</td>
<td>提交读</td>
<td>只能读取到已经提交的数据。大部分数据库系统的默认隔离级别都是READ-COMMITED，但MySQL不是；</td>
</tr>
<tr>
<td>READ_UNCOMMITTED</td>
<td>未提交读</td>
<td>事务中的修改，即使没有提交，对其他事务也是可见的，因此可能读到脏数据(脏读，dirty read)；</td>
</tr>
<tr>
<td>AUTOCOMMIT</td>
<td>自动提交</td>
<td>在命令行执行sql语句，每执行一次操作实质上就是一次事务</td>
</tr>
</tbody>
</table>
<h4 id="6-sessionmaker-参数"><a href="#6-sessionmaker-参数" class="headerlink" title="6. sessionmaker 参数"></a>6. sessionmaker 参数</h4><p>1、autocommit</p>
<blockquote>
<p>autocommit参数表示是否自动提交事务,默认关闭,即默认sqlalchemy为每个请求（包含select操作）开启事务,但不会自动提交这个事务，需要手动提交事务。 </p>
</blockquote>
<blockquote>
<p>如果autocommit=True，sqlalchemy会为每个请求（包含select操作）开启事务,并且自动提交这个事务。当你需要保证多条命令是原则性操作，则需使用<code>session.begin()</code>开启事务</p>
</blockquote>
<h5 id="isolation-level-”AUTOCOMMIT”-与-sessionmaker-autocommit-True-区别"><a href="#isolation-level-”AUTOCOMMIT”-与-sessionmaker-autocommit-True-区别" class="headerlink" title="isolation_level=”AUTOCOMMIT”  与 sessionmaker(autocommit=True)区别"></a>isolation_level=”AUTOCOMMIT”  与 sessionmaker(autocommit=True)区别</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlalchemy简单工作流程：</span><br><span class="line">代码（session.query） --&gt;  sqlalchemy  --&gt;  psycopg2  --&gt;  postgresql</span><br><span class="line"></span><br><span class="line">默认值时（autocommit不开启）：sqlalchemy在执行命令钱会通过psycopg2向数据库发送`begin`命令到数据库（之后所以命令都在事务中执行，不可在次执行session.begin命令）</span><br></pre></td></tr></table></figure>
<blockquote>
<p>相同点：最终效果相同（都会在执行select语句后自动提交）</p>
</blockquote>
<blockquote>
<p>不同点： sessionmaker(autocommit=True) 效果：会在执行命令完毕后断开连接，并将此连接roolback回滚放回连接池。（官方不建议使用）<br>isolation_level=”AUTOCOMMIT”效果：在执行命令之前不会向数据库发送begin命令。</p>
</blockquote>
<p>因此两者都可以达到自动提交的效果，但实现方法完全不同。</p>
<p>2、autoflush</p>
<p>autoflush 为 True 时（默认是 True），session 进行查询之前会自动把当前累计的修改发送到数据库（注意：autoflush 并不是说在 session.add 之后会自动 flush），举个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 创建了一个对象，这时，这个对象几乎没有任何意义，session 不知道它的存在</span><br><span class="line">&gt;&gt;&gt; user = User(name=&apos;cosven&apos;)</span><br><span class="line"></span><br><span class="line"># session.add 这个对象之后，它被 session 放到它的对象池里面去了，但这时不会发送任何 SQL 语句给数据库，数据库目前仍然不知道它的存在</span><br><span class="line">&gt;&gt;&gt;  session.add(user)</span><br><span class="line"> </span><br><span class="line"># session1.Query 执行之前，由于 autoflush 是 True，session 会先执行 session.flush()(session.flush 的意义：session将变积累的 SQL 语句发送给数据库。)，然后再发送查询语句</span><br><span class="line"># 所以，这个查询是能查到 user </span><br><span class="line">&gt;&gt;&gt; session1.query(User).filter_by(name=&apos;cosven&apos;).first()</span><br><span class="line">&lt;__main__.User object at 0x1108f04e0&gt;</span><br></pre></td></tr></table></figure></p>
<p>如果 session 的 autoflush 为 False 的话，session 进行查询之前不会把当前累计的修改发送到数据库，而直接发送查询语句，所以下面这个查询是查不到对象的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; session.add(User(name=&apos;haha&apos;))</span><br><span class="line">&gt;&gt;&gt; session.query(User).filter_by(name=&apos;haha&apos;).first()  # None</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>autoflush 的意义：session 在进行<strong>查询之前</strong>，<strong>自动</strong>的进行一次 flush 操作。</p>
</blockquote>
<p>3、expire_on_commit</p>
<p>如果为True，在commit之后所以实例将完全过期，以便在完成事务之后，获取属性/对象都将从最近的数据库状态加载。</p>
<h5 id="scoped-session-与-sessionmaker区别"><a href="#scoped-session-与-sessionmaker区别" class="headerlink" title="scoped_session 与 sessionmaker区别"></a>scoped_session 与 sessionmaker区别</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from sqlalchemy import create_engine</span><br><span class="line">from sqlalchemy.orm import sessionmaker, scoped_session</span><br><span class="line"></span><br><span class="line">engine = create_engine()</span><br><span class="line"></span><br><span class="line">Session = scoped_session(</span><br><span class="line">            sessionmaker(</span><br><span class="line">                autoflush = True,</span><br><span class="line">                bind = engine))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>sessionmaker，我们得到一个类，一个能产生session的工厂。(每次调用都会得倒不同的session)  </p>
</blockquote>
<blockquote>
<p>scoped_session类似单例模式，当我们调用使用的时候，会先在Registry里找找之前是否已经创建session了。要是有，就把这个session返回。要是没有，就创建新的session，注册到Registry中以便下次返回给调用者。这样就实现了这样一个目的：在同一个线程中，call scoped_session 的时候，返回的是同一个对象</p>
</blockquote>
<h4 id="7-创建orm类"><a href="#7-创建orm类" class="headerlink" title="7. 创建orm类"></a>7. 创建orm类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding =utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入需要的字段类型</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy.dialects.mysql <span class="keyword">import</span> LONGTEXT</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, VARCHAR, TEXT, DATE, DATETIME</span><br><span class="line"></span><br><span class="line"><span class="comment"># Model基类,创建了一个BaseModel类,这个类的子类可以自动与一个表关联</span></span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParseHtmlItem</span><span class="params">(Base)</span>:</span></span><br><span class="line">    <span class="comment"># 指定表名</span></span><br><span class="line">    __tablename__ = <span class="string">'huachuang_parse_html'</span></span><br><span class="line">    <span class="comment"># 对于表的描述</span></span><br><span class="line">    desc = <span class="string">'华创项目解析详情页信息数据存储'</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 表结构</span></span><br><span class="line">    ANCHOR_TITLE = Column(VARCHAR(<span class="number">200</span>), doc=&#123;<span class="string">'zh'</span>: <span class="string">'列表页获取详情页标题(外部标题)'</span>&#125;)</span><br><span class="line">    TAG_TITLE = Column(VARCHAR(<span class="number">200</span>), doc=&#123;<span class="string">'zh'</span>: <span class="string">'标签标题'</span>&#125;)</span><br><span class="line">    TITLE = Column(VARCHAR(<span class="number">200</span>), doc=&#123;<span class="string">'zh'</span>: <span class="string">'详情页标题'</span>&#125;)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">creat_table</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        创建数据表</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        cls.__table__.create(bind=engine_postgresql, checkfirst=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<h4 id="8-常用的SQLAlchemy字段类型"><a href="#8-常用的SQLAlchemy字段类型" class="headerlink" title="8. 常用的SQLAlchemy字段类型"></a>8. 常用的SQLAlchemy字段类型</h4><table>
<thead>
<tr>
<th>类型名</th>
<th>python中类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Integer</td>
<td>int</td>
<td>普通整数，一般是32位</td>
</tr>
<tr>
<td>SmallInteger</td>
<td>int</td>
<td>取值范围小的整数，一般是16位</td>
</tr>
<tr>
<td>BigInteger</td>
<td>int或long</td>
<td>不限制精度的整数</td>
</tr>
<tr>
<td>Float</td>
<td>float</td>
<td>浮点数</td>
</tr>
<tr>
<td>Numeric</td>
<td>decimal.Decimal</td>
<td>普通整数，一般是32位</td>
</tr>
<tr>
<td>Varchar</td>
<td>str</td>
<td>变长字符串</td>
</tr>
<tr>
<td>Text</td>
<td>str</td>
<td>变长字符串，对较长或不限长度的字符串做了优化</td>
</tr>
<tr>
<td>Unicode</td>
<td>unicode</td>
<td>变长Unicode字符串</td>
</tr>
<tr>
<td>UnicodeText</td>
<td>unicode</td>
<td>变长Unicode字符串，对较长或不限长度的字符串做了优化</td>
</tr>
<tr>
<td>Boolean</td>
<td>bool</td>
<td>布尔值</td>
</tr>
<tr>
<td>Date</td>
<td>datetime.date</td>
<td>时间</td>
</tr>
<tr>
<td>Time</td>
<td>datetime.datetime</td>
<td>日期和时间</td>
</tr>
<tr>
<td>LargeBinary</td>
<td>str</td>
<td>二进制文件</td>
</tr>
</tbody>
</table>
<p>** 常用的SQLAlchemy列选项</p>
<table>
<thead>
<tr>
<th>选项名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>primary_key</td>
<td>如果为True，代表表的主键</td>
</tr>
<tr>
<td>unique</td>
<td>如果为True，代表这列不允许出现重复的值</td>
</tr>
<tr>
<td>index</td>
<td>如果为True，为这列创建索引，提高查询效率</td>
</tr>
<tr>
<td>nullable</td>
<td>如果为True，允许有空值，如果为False，不允许有空值</td>
</tr>
<tr>
<td>default</td>
<td>为这列定义默认值</td>
</tr>
</tbody>
</table>
<p><strong>注意：</strong><br> orm结构中可以只写<strong>部分字段</strong>，未写出的列会将其忽略</p>
<h4 id="9-查询、过滤关键字"><a href="#9-查询、过滤关键字" class="headerlink" title="9. 查询、过滤关键字"></a>9. 查询、过滤关键字</h4><p>1、使用query查询表的内容：返回的结果是一个tuple<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">session = Session_class()</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> session.query(AlchemyTest).all():</span><br><span class="line">    print(row.TestName, row.TestNumber)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以使用label()对单独的一列进行命名,这样就对name这一列命名为name_label</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> session.query(User.name.label(<span class="string">'name_label'</span>)).all()</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以用python的方法限定哪几行：</span></span><br><span class="line"><span class="keyword">for</span> u <span class="keyword">in</span> session.query(User).order_by(User.id)[<span class="number">1</span>:<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></p>
<p>filter_by()可以直接使用关键字进行限制条件，但是filter()能处理更复杂的限制条件。<br>如果有两个限制条件是AND关系，可以直接使用两次filter()处理：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.query(User).filter(User.name==<span class="string">'ed'</span>).filter(User.fullname==<span class="string">'Ed Jones'</span>)</span><br></pre></td></tr></table></figure></p>
<p>2、下面列表也展示了其他方法：（filter operator :）</p>
<table>
<thead>
<tr>
<th>作用</th>
<th>符号</th>
</tr>
</thead>
<tbody>
<tr>
<td>相等</td>
<td>==</td>
</tr>
<tr>
<td>不相等</td>
<td>!=</td>
</tr>
<tr>
<td>通配符搜索</td>
<td>like(’%关键字%’)</td>
</tr>
<tr>
<td>通配符搜索(不敏感)</td>
<td>ilike()</td>
</tr>
<tr>
<td>存在于</td>
<td>.in_([‘ed’, ‘wendy’, ‘jack’])</td>
</tr>
<tr>
<td>不存在于</td>
<td>~User.name.in_([‘ed’, ‘wendy’, ‘jack’])</td>
</tr>
<tr>
<td>为空</td>
<td>== None</td>
</tr>
<tr>
<td>and</td>
<td>.filter(User.name == ‘ed’, User.fullname == ‘Ed Jones’)</td>
</tr>
<tr>
<td>or</td>
<td>or_(User.name == ‘ed’, User.name == ‘wendy’)</td>
</tr>
<tr>
<td>MATCH</td>
<td>.match(‘wendy’)</td>
</tr>
</tbody>
</table>
<p>3、检索返回的列表，以及列表的标量 ：</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>all()</td>
<td>返回所有</td>
</tr>
<tr>
<td>first()</td>
<td>返回第一行</td>
</tr>
<tr>
<td>one()</td>
<td>检查是不是只有一行结果</td>
</tr>
<tr>
<td>one_or_none()</td>
<td>检查是不是一行或者没有结果</td>
</tr>
<tr>
<td>scalar()</td>
<td>invokes the one() method, and upon success returns the first column of the row</td>
</tr>
</tbody>
</table>
<p>4、直接使用textual SQL语句 :<br>使用text()可以在query中使用literal strings：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.query(User).filter(text(<span class="string">"id&lt;224"</span>)).order_by(text(<span class="string">"id"</span>)).all()</span><br></pre></td></tr></table></figure></p>
<p>如果要直接使用完整的整条sql，可以使用text()传给from_statement()：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.query(User).from_statement(text(<span class="string">"SELECT * FROM users where name=:name"</span>)).params(name=<span class="string">'ed'</span>).all()</span><br></pre></td></tr></table></figure></p>
<p>5、计数：<br>可以直接使用 .count()计算有多少行：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.query(User).filter(User.name.like(<span class="string">'%ed'</span>)).count()</span><br></pre></td></tr></table></figure></p>
<p>当需要将指定的东西进行计数，就使用func.count()：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.query(func.count(User.id)).scalar()</span><br></pre></td></tr></table></figure></p>
<p>filter 与 filter_by 区别</p>
<ul>
<li>字段写法：filter筛选的字段是带类名（表名）的，而filter_by只需要筛选字段就可以；</li>
<li>判断条件：filter比filter_by多了一个等号；</li>
<li>作用范围：filter可用于单表或者多表查询，而filter_by只能用于单表查询。</li>
</ul>
<blockquote>
<p>filter 可以像 sql 的 where 语句一样使用 &gt; &lt; 等条件。引用列名时，需要通过 类名.属性名 的方式。<br>filter_by 使用 python 的正常参数传递方法，指定列名时，不需要额外指定类名。</p>
</blockquote>
<h4 id="9-数据库操作（CRUD）"><a href="#9-数据库操作（CRUD）" class="headerlink" title="9. 数据库操作（CRUD）"></a>9. 数据库操作（CRUD）</h4><p>1、查询</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询ParseHtmlItem.__tablename__ 表中全部数据</span></span><br><span class="line">session.query(ParseHtmlItem).all() </span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询id为1的值</span></span><br><span class="line">session.query(ParseHtmlItem).filter_by(ID=<span class="number">1</span>).first()  <span class="comment"># 得到单个对象</span></span><br><span class="line">session.query(ParseHtmlItem).filter_by(ID=<span class="number">1</span>).all()    <span class="comment"># 得到列表</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询id 小于5的数据</span></span><br><span class="line">session.query(ParseHtmlItem).filter(ParseHtmlItem.ID&lt;<span class="number">5</span>).all()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询巨大数据量来实现分页的情况，推荐使用通过id区间来读取数据库（提高读取速度）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取值</span></span><br><span class="line">data = session.query(ParseHtmlItem).filter_by(ID=<span class="number">1</span>).first()</span><br><span class="line">data.ID <span class="comment"># 取id的值</span></span><br></pre></td></tr></table></figure>
<p>2、增加</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">item = ParseHtmlItem(</span><br><span class="line">                CONTENT_URL_HASH=content_url_hash,</span><br><span class="line">                ...</span><br><span class="line">            )</span><br><span class="line">session.add(item)</span><br><span class="line">session.commit()  <span class="comment"># autocommit=True时，可以不写此命令（但推荐写）</span></span><br></pre></td></tr></table></figure>
<p>3、修改</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询要修改的数据</span></span><br><span class="line">item = session.query(User).first()</span><br><span class="line">item.CONTENT_URL_HASH = <span class="string">""</span></span><br><span class="line">session.add(usr)</span><br><span class="line">session.commit()</span><br></pre></td></tr></table></figure>
<p>4、删除</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询要删除的数据</span></span><br><span class="line">item = session.query(User).first()</span><br><span class="line">session.delete(item)</span><br><span class="line">session.commit()</span><br></pre></td></tr></table></figure>
<h4 id="10-flush与commit区别"><a href="#10-flush与commit区别" class="headerlink" title="10. flush与commit区别"></a>10. flush与commit区别</h4><p>在SQLAlchemy中每个事务对应一条或多条SQL语句，这些SQL语句需要经历如下步骤：  </p>
<ol>
<li>将sql语句发送到sql服务器。</li>
<li>在当前事务中执行sql，但不会将修改写入磁盘。</li>
<li><p>将修改写入磁盘</p>
<p>&emsp;&emsp;flush  操作会执行1，2步骤。<br>&emsp;&emsp; commit操作执行1，2，3步骤。<br>&emsp;&emsp;因此，flush之后你可以在当前Session中看到效果，而commit之后你才能从其它Session中看到效果。</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush 使用场景为：现在已经执行一些操作，但不想结束此事务。</span><br></pre></td></tr></table></figure>
<h4 id="11-数据库操作错误拦截"><a href="#11-数据库操作错误拦截" class="headerlink" title="11. 数据库操作错误拦截"></a>11. 数据库操作错误拦截</h4><p>数据库操作可能因为数据类型/长度，网络原因等问题导致写入数据出错,因此要做好错误拦截避免程序关闭</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># try 中存放sql操作代码</span></span><br><span class="line">    item = ParseHtmlItem(</span><br><span class="line">                CONTENT_URL_HASH=content_url_hash,</span><br><span class="line">                ...</span><br><span class="line">            )</span><br><span class="line">    session.add(item)</span><br><span class="line">    session.commit() </span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="comment"># 事务回滚，撤销此次事务修改</span></span><br><span class="line">    session.rollback()</span><br><span class="line">    logging.error(<span class="string">f"sql insert error: <span class="subst">&#123;e&#125;</span>"</span>)</span><br></pre></td></tr></table></figure>
<p><strong><em>注意：</em></strong><br>使用select语句推荐<strong>使用错误拦截</strong>，并使用session.rollback()回滚事务（select查询时可能数据库因为一些原因导致此次查询错误，在下次查询时可能持续报错无法正常查询）</p>
<h4 id="12-session-关闭-close"><a href="#12-session-关闭-close" class="headerlink" title="12. session 关闭  close"></a>12. session 关闭  close</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure>
<p>session创建和管理对数据库的连接，当调用close的时候，注意，sqlalchemy不会关闭与mysql的连接，而是把连接返回到连接池。</p>
<p><strong>推荐</strong><br>当前session commit之后就执行close操作（原因：1.每次使用session时都会从连接池中取出，因此可以将session关闭主动放回连接池 2. 可以确保 transaction 有非常清晰的开始和结束，保持 transaction 简短，也就意味着让 transaction 能在一系列操作之后终止，而不是一直开放着。（保留session的生命周期（通常是transaction）独立））</p>
<p><strong>注意</strong>：<br>未commit的transactions会被回滚</p>
<h4 id="13-整体代码"><a href="#13-整体代码" class="headerlink" title="13. 整体代码"></a>13. 整体代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span>  Column, Integer, String</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">engine = create_engine(</span><br><span class="line">    <span class="comment"># postgresql+psycopg2://&#123;&#125;:&#123;&#125;@&#123;&#125;:&#123;&#125;/&#123;&#125;'.format(   连接postgresql</span></span><br><span class="line">    <span class="string">'mysql+pymysql://&#123;&#125;:&#123;&#125;@&#123;&#125;:&#123;&#125;/&#123;&#125;'</span>.format(    <span class="comment"># 连接mysql</span></span><br><span class="line">    POSTGRESQL_USER_NAME, </span><br><span class="line">    POSTGRESQL_PASSWORD, </span><br><span class="line">    POSTGRESQL_HOST, </span><br><span class="line">    POSTGRESQL_PORT, </span><br><span class="line">    POSTGRESQL_DB_NAME</span><br><span class="line">    ),</span><br><span class="line">    echo=Fase,          <span class="comment"># -- 如果为真，引擎将记录所有语句   用于调试</span></span><br><span class="line">    echo_pool=<span class="literal">False</span>,    <span class="comment"># -- 如果为true，则连接池将记录信息输出，例如连接失效以及连接回收到默认日志处理程序     用于调试</span></span><br><span class="line">    encoding=<span class="string">'utf-8'</span>,   <span class="comment"># 默认为 utf-8 . 这是sqlAlchemy用于在sqlAlchemy中发生的字符串编码/解码操作的字符串编码</span></span><br><span class="line">    pool_size=<span class="number">5</span>,   <span class="comment">#-- 在连接池中保持打开的连接数   设置为0表示没有限制</span></span><br><span class="line">    max_overflow=<span class="number">10</span>,    <span class="comment"># -- 允许在连接池中“溢出”的连接数，即可以在池大小设置（默认为5）之上或之外打开的连接数</span></span><br><span class="line">    pool_timeout=<span class="number">30</span>,    <span class="comment">#  -- 在放弃从池中获取连接之前等待的秒数</span></span><br><span class="line">    isolation_level=<span class="string">"AUTOCOMMIT"</span>  <span class="comment"># 设置引擎范围内的事务隔离级别隔离</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Session = sessionmaker(bind=engine)</span><br><span class="line">session = Session()</span><br><span class="line"></span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'users'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">50</span>))</span><br><span class="line">    fullname = Column(String(<span class="number">50</span>))</span><br><span class="line">    password = Column(String(<span class="number">12</span>))</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">creat_table</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        创建数据表</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        cls.__table__.create(bind=engine_postgresql, checkfirst=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_all</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        返回所有数据</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span>  session_postgresql.query(cls).all()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            session_postgresql.rollback()</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">f'数据库查询失败 ：<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            session_postgresql.close()</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_item</span><span class="params">(self, id)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    查询指定数据</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> session.query(self).filter_by(id == id).first()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            session_postgresql.rollback()</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">f'数据库查询失败 ：<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            session_postgresql.close()</span><br></pre></td></tr></table></figure>
<h4 id="14-案例-FAQ：session-autocommit-使用中错误"><a href="#14-案例-FAQ：session-autocommit-使用中错误" class="headerlink" title="14. 案例 FAQ：session   autocommit 使用中错误"></a>14. 案例 FAQ：session   autocommit 使用中错误</h4><h5 id="错误描述"><a href="#错误描述" class="headerlink" title="错误描述"></a>错误描述</h5><blockquote>
<p>&emsp;&emsp;sqlalchemy 连接 数据库，select操作未commit提交（autocommit=False）这导致 pg 中产生大量的 “idle in transaction” 的长连接。导致需要 ACCESS EXCLUSIVE 锁的语句（如add column）阻塞，并阻塞所有后续需要 ACCESS SHARE 锁的读请求，导致程序异常。</p>
</blockquote>
<h5 id="错误例子-（还原）"><a href="#错误例子-（还原）" class="headerlink" title="错误例子 （还原）"></a>错误例子 （还原）</h5><p>session1 开启事务，并且查询test表：（autocommit=False时所有命令都会开启事务包括select语句）</p>
<p>mysql&gt; begin;<br>Query OK, 0 rows affected (0.00 sec)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 在此处开启事务模拟autocommit=False</span></span><br><span class="line">mysql&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test1;</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">| id | page | page1 |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">|  1 | NULL |  NULL |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>session2 , 修改表结构，增加字段，这时候会卡住</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table test1 add page2 int;</span><br></pre></td></tr></table></figure>
<p>session3 再开一个终端，session3模拟其他用户的请求 , 请求也会被卡住</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from test1 where id=1;</span><br></pre></td></tr></table></figure>
<p>查看processlist;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show processlist;</span><br><span class="line">+<span class="comment">----+------+--------------------+------+---------+-------+---------------------------------+---------------------------------+</span></span><br><span class="line">| Id | User | Host               | db   | Command | Time  | State                           | Info                            |</span><br><span class="line">+<span class="comment">----+------+--------------------+------+---------+-------+---------------------------------+---------------------------------+</span></span><br><span class="line">|  7 | root | 192.168.33.1:53303 | test | Sleep   | 43035 |                                 | NULL                            |</span><br><span class="line">|  8 | root | localhost          | test | Query   |     0 | starting                        | <span class="keyword">show</span> <span class="keyword">processlist</span>                |</span><br><span class="line">|  <span class="number">9</span> | root | localhost          | <span class="keyword">test</span> | <span class="keyword">Query</span>   |   <span class="number">969</span> | Waiting <span class="keyword">for</span> <span class="keyword">table</span> metadata <span class="keyword">lock</span> | <span class="keyword">alter</span> <span class="keyword">table</span> test1 <span class="keyword">add</span> page2 <span class="built_in">int</span> |</span><br><span class="line">| <span class="number">10</span> | root | localhost          | <span class="keyword">test</span> | <span class="keyword">Query</span>   |   <span class="number">134</span> | Waiting <span class="keyword">for</span> <span class="keyword">table</span> metadata <span class="keyword">lock</span> | <span class="keyword">select</span> * <span class="keyword">from</span> test1 <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>  |</span><br><span class="line">+<span class="comment">----+------+--------------------+------+---------+-------+---------------------------------+---------------------------------+</span></span><br></pre></td></tr></table></figure>
<p>id=9的线程，也就是alter表那个线程，在等待锁，此时已经锁住了test表，其他的线程也不能获取锁读取test表。</p>
<h5 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h5><ol>
<li>isolation_level=”AUTOCOMMIT”</li>
<li>执行每条命令后都执行commit</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/python/python基础/20190301_访问数据库/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Think Different">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/python/python基础/20190301_访问数据库/" itemprop="url">
                  python访问数据库
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-01T15:24:20+08:00">
                2019-03-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h5 id="1-python连接mysql并实现增删改查"><a href="#1-python连接mysql并实现增删改查" class="headerlink" title="1. python连接mysql并实现增删改查"></a>1. python连接mysql并实现增删改查</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Databse</span><span class="params">(object)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.conn = pymysql.connect(host=<span class="string">"数据库地址"</span>,</span><br><span class="line">                                    user=<span class="string">"用户名"</span>,</span><br><span class="line">                                    password=<span class="string">"密码"</span>,</span><br><span class="line">                                    port=<span class="number">3306</span>,  <span class="comment"># 端口  </span></span><br><span class="line">                                    database=<span class="string">"数据库名"</span>,</span><br><span class="line">                                    charset=<span class="string">'utf8'</span>)</span><br><span class="line">        self.cursor = self.conn.cursor()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getData</span><span class="params">(self)</span>:</span></span><br><span class="line">        data = []</span><br><span class="line">        self.cursor.execute(<span class="string">r"select url from worm_tb"</span>)</span><br><span class="line">        <span class="keyword">if</span> self.cursor.rowcount != <span class="number">0</span>:</span><br><span class="line">            result = self.cursor.fetchall()</span><br><span class="line">            <span class="keyword">for</span> d <span class="keyword">in</span> result:</span><br><span class="line">                data.append(d[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, url)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.cursor.execute(<span class="string">r"insert into worm_tb (url) values ('%s')"</span> % url)</span><br><span class="line">            self.conn.commit()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">            self.conn.rollback()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">die</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.cursor.close()</span><br><span class="line">        self.conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    db = Databse()</span><br><span class="line">    db.insert(<span class="string">'www.baidu.com'</span>)</span><br><span class="line">    print(db.getData())</span><br><span class="line">    db.die()</span><br></pre></td></tr></table></figure>
<p>案例：把控制台输入的数据,写入MySQL数据库<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    no = int(input(<span class="string">'编号: '</span>))</span><br><span class="line">    name = input(<span class="string">'名字: '</span>)</span><br><span class="line">    loc = input(<span class="string">'所在地: '</span>)</span><br><span class="line">    <span class="comment"># 1. 创建数据库连接对象</span></span><br><span class="line">    con = pymysql.connect(host=<span class="string">'localhost'</span>, port=<span class="number">3306</span>,</span><br><span class="line">                          database=<span class="string">'test'</span>, charset=<span class="string">'utf8'</span>,</span><br><span class="line">                          user=<span class="string">'root'</span>, password=<span class="string">'123456'</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 2. 通过连接对象获取游标</span></span><br><span class="line">        <span class="keyword">with</span> con.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">            <span class="comment"># 3. 通过游标执行SQL并获得执行结果</span></span><br><span class="line">            result = cursor.execute(</span><br><span class="line">                <span class="string">'insert into tb_dept values (%s, %s, %s)'</span>,</span><br><span class="line">                (no, name, loc)</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">if</span> result == <span class="number">1</span>:</span><br><span class="line">            print(<span class="string">'添加成功!'</span>)</span><br><span class="line">        <span class="comment"># 4. 操作成功提交事务</span></span><br><span class="line">        con.commit()</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="comment"># 5. 关闭连接释放资源</span></span><br><span class="line">        con.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p>
<h5 id="2-用python查询数据库中的数据并保存至文本"><a href="#2-用python查询数据库中的数据并保存至文本" class="headerlink" title="2. 用python查询数据库中的数据并保存至文本"></a>2. 用python查询数据库中的数据并保存至文本</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pymysql <span class="keyword">as</span> MySQLdb  <span class="comment">#这里是python3  如果你是python2.x的话，import MySQLdb</span></span><br><span class="line"></span><br><span class="line">host = xxxx</span><br><span class="line">user = xxxx</span><br><span class="line">passwd = xxxx</span><br><span class="line">port = xxxx</span><br><span class="line">db = xxxx</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SelectMySQL</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">select_data</span><span class="params">(self,sql)</span>:</span></span><br><span class="line">        result = []</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            conn = MySQLdb.connect(host=host,</span><br><span class="line">                               port=port,</span><br><span class="line">                               user=user,</span><br><span class="line">                               passwd=passwd,</span><br><span class="line">                               db=db,</span><br><span class="line">                               charset=<span class="string">'utf8'</span>, )</span><br><span class="line">            cur = conn.cursor()</span><br><span class="line">            cur.execute(sql)</span><br><span class="line">            alldata = cur.fetchall()</span><br><span class="line">            <span class="comment"># print(alldata)</span></span><br><span class="line">            <span class="keyword">for</span> rec <span class="keyword">in</span> alldata:</span><br><span class="line">                result.append(rec[<span class="number">0</span>]) <span class="comment">#注意，我这里只是把查询出来的第一列数据保存到结果中了,如果是多列的话，稍微修改下就ok了</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(<span class="string">'Error msg: '</span> + e)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            cur.close()</span><br><span class="line">            conn.close()</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_result</span><span class="params">(self, sql, filename)</span>:</span></span><br><span class="line">        print(sql)</span><br><span class="line">        results = self.select_data(sql)</span><br><span class="line">        print(<span class="string">'The amount of datas: %d'</span> % (len(results)))</span><br><span class="line">        <span class="keyword">with</span> open(filename, <span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">                f.write(str(result) + <span class="string">'\n'</span>)</span><br><span class="line">        print(<span class="string">'Data write is over!'</span>)</span><br><span class="line">        <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    sql = <span class="string">"select name from user"</span></span><br><span class="line">    select = SelectMySQL()</span><br><span class="line">    result1 = select.get_result(sql,<span class="string">'namemsg.txt'</span>)</span><br><span class="line">    print(result1)</span><br></pre></td></tr></table></figure>
<h5 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mysql</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.content = pymysql.Connect(</span><br><span class="line">            host=<span class="string">'localhost'</span>,  <span class="comment"># mysql的主机ip</span></span><br><span class="line">            port=<span class="number">3306</span>,  <span class="comment"># 端口</span></span><br><span class="line">            user=<span class="string">'root'</span>,  <span class="comment"># 用户名</span></span><br><span class="line">            passwd=<span class="string">'123456'</span>,  <span class="comment"># 数据库密码</span></span><br><span class="line">            db=<span class="string">'test'</span>,  <span class="comment"># 数据库名</span></span><br><span class="line">            charset=<span class="string">'utf8'</span>,  <span class="comment"># 字符集</span></span><br><span class="line">        )</span><br><span class="line">        self.cursor = self.content.cursor()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">query</span><span class="params">(self)</span>:</span></span><br><span class="line">        sql = <span class="string">"select * from chinamoney_ann_v1;"</span></span><br><span class="line">        self.cursor.execute(sql)</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> self.cursor.fetchall():</span><br><span class="line">            print(row)</span><br><span class="line">        print(<span class="string">f"一共查找到：<span class="subst">&#123;self.cursor.rowcount&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">end</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.cursor.close()</span><br><span class="line">        self.content.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    mysql = Mysql()</span><br><span class="line">    mysql.query()</span><br><span class="line">    mysql.end()</span><br></pre></td></tr></table></figure>
<h4 id="案例：一整套"><a href="#案例：一整套" class="headerlink" title="案例：一整套"></a>案例：一整套</h4><p>第一步：打开数据库连接</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host=<span class="string">"数据库地址"</span>, </span><br><span class="line">                     user=<span class="string">"用户名"</span>, </span><br><span class="line">                     password=<span class="string">"密码"</span>, </span><br><span class="line">                     port=<span class="number">3306</span>,<span class="comment"># 端口  </span></span><br><span class="line">                     database=<span class="string">"数据库名"</span>, </span><br><span class="line">                     charset=<span class="string">'utf8'</span>)</span><br></pre></td></tr></table></figure>
<p>第二步：创建游标</p>
<p>cursor = db.cursor()</p>
<p>第三步：操作数据库</p>
<p>1、创建表<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果数据表已经存在使用execute()方法删除表。</span></span><br><span class="line">cursor.execute(<span class="string">"DROP TABLE IF EXISTS EMPLOYEE"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建数据表SQL语句</span></span><br><span class="line">sql = <span class="string">"""CREATE TABLE EMPLOYEE (</span></span><br><span class="line"><span class="string">         FIRST_NAME  CHAR(20) NOT NULL,</span></span><br><span class="line"><span class="string">         LAST_NAME  CHAR(20),</span></span><br><span class="line"><span class="string">         AGE INT,  </span></span><br><span class="line"><span class="string">         SEX CHAR(1),</span></span><br><span class="line"><span class="string">         INCOME FLOAT )"""</span></span><br><span class="line"></span><br><span class="line">cursor.execute(sql)</span><br></pre></td></tr></table></figure></p>
<p>2、查询数据#<br>Python查询Mysql使用 fetchone() 方法获取单条数据, 使用fetchall() 方法获取多条数据。<br>fetchone(): 该收全部的返回结果行.<br>rowcount: 这是方法获取下一个查询结果集。结果集是一个对象<br>fetchall():接一个只读属性，并返回执行execute()方法后影响的行数。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQL 查询语句</span></span><br><span class="line">sql = <span class="string">"SELECT * FROM EMPLOYEE WHERE INCOME &gt; &#123;&#125;"</span>.format(<span class="number">1000</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 执行SQL语句</span></span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    <span class="comment"># 获取所有记录列表</span></span><br><span class="line">    results = cursor.fetchall()</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> results:</span><br><span class="line">        fname = row[<span class="number">0</span>]</span><br><span class="line">        lname = row[<span class="number">1</span>]</span><br><span class="line">        age = row[<span class="number">2</span>]</span><br><span class="line">        sex = row[<span class="number">3</span>]</span><br><span class="line">        income = row[<span class="number">4</span>]</span><br><span class="line">        <span class="comment"># 打印结果</span></span><br><span class="line">        print(<span class="string">"fname=&#123;&#125;,lname=&#123;&#125;,age=&#123;&#125;,sex=&#123;&#125;,income=&#123;&#125;"</span>.format(fname, lname, age, sex, income))</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">"Error: unable to fecth data"</span>)</span><br></pre></td></tr></table></figure></p>
<p>3、添加数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQL 插入语句</span></span><br><span class="line">sql = <span class="string">"""INSERT INTO EMPLOYEE(FIRST_NAME,</span></span><br><span class="line"><span class="string">         LAST_NAME, AGE, SEX, INCOME)</span></span><br><span class="line"><span class="string">         VALUES ('Mac', 'Mohan', 20, 'M', 2000)"""</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    <span class="comment"># 提交到数据库执行</span></span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="comment"># 发生错误时回滚</span></span><br><span class="line">    db.rollback()</span><br></pre></td></tr></table></figure></p>
<p>4、修改数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQL 更新语句</span></span><br><span class="line">sql = <span class="string">"UPDATE EMPLOYEE SET AGE = AGE + 1 WHERE SEX = '&#123;&#125;'"</span>.format(<span class="string">'M'</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    <span class="comment"># 提交到数据库执行</span></span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="comment"># 发生错误时回滚</span></span><br><span class="line">    db.rollback()</span><br></pre></td></tr></table></figure></p>
<p>5、删除数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQL 刪除语句</span></span><br><span class="line">sql = <span class="string">"DELETE FROM EMPLOYEE WHERE AGE &gt; &#123;&#125;"</span>.format(<span class="number">20</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    <span class="comment"># 提交到数据库执行</span></span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="comment"># 发生错误时回滚</span></span><br><span class="line">    db.rollback()</span><br></pre></td></tr></table></figure></p>
<p>第四步：关闭游标，数据库连接<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cursor.close()</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure></p>
<h4 id="通过控制台向数据库插入数据"><a href="#通过控制台向数据库插入数据" class="headerlink" title="通过控制台向数据库插入数据"></a>通过控制台向数据库插入数据</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">@Time    : 2020/5/11 14:24</span></span><br><span class="line"><span class="string">@Software: PyCharm</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">host = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">3306</span></span><br><span class="line">user = <span class="string">'root'</span></span><br><span class="line">password = <span class="string">'123456'</span></span><br><span class="line">print(<span class="string">'Starting the create database operation, please enter the information required for the database.'</span>)</span><br><span class="line"><span class="comment"># print('------------------------------------')</span></span><br><span class="line"><span class="comment"># host = input('please input database host:')</span></span><br><span class="line"><span class="comment"># port = input('please input database port:')</span></span><br><span class="line"><span class="comment"># user = input('please input database user:')</span></span><br><span class="line"><span class="comment"># password = input('please input database password:')</span></span><br><span class="line"><span class="comment"># print('------------------------------------')</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = pymysql.connect(host=host, port=int(port), user=user, password=password)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'create database...'</span>)</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    cur.execute(<span class="string">'create database if not exists book'</span>)</span><br><span class="line">    print(<span class="string">'database created done.'</span>)</span><br><span class="line">    print(<span class="string">'------------------------------------'</span>)</span><br><span class="line">    conn.select_db(<span class="string">'book'</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'create user table...'</span>)</span><br><span class="line">    cur.execute(<span class="string">"CREATE TABLE IF NOT EXISTS user ("</span></span><br><span class="line">                <span class="string">"id varchar(50) PRIMARY KEY,"</span></span><br><span class="line">                <span class="string">"username varchar(255),"</span></span><br><span class="line">                <span class="string">"password varchar(255),"</span></span><br><span class="line">                <span class="string">"role int(11),"</span></span><br><span class="line">                <span class="string">"create_time datetime,"</span></span><br><span class="line">                <span class="string">"delete_flag int(11),"</span></span><br><span class="line">                <span class="string">"current_login_time datetime)"</span>)</span><br><span class="line">    print(<span class="string">'user table created done.'</span>)</span><br><span class="line">    print(<span class="string">'------------------------------------'</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'create book table...'</span>)</span><br><span class="line">    cur.execute(<span class="string">"CREATE TABLE IF NOT EXISTS book("</span></span><br><span class="line">                <span class="string">"id varchar(50) PRIMARY KEY,"</span></span><br><span class="line">                <span class="string">"book_name varchar(255),"</span></span><br><span class="line">                <span class="string">"author varchar(255),"</span></span><br><span class="line">                <span class="string">"publish_company varchar(255),"</span></span><br><span class="line">                <span class="string">"store_number int(11),"</span></span><br><span class="line">                <span class="string">"borrow_number int(11),"</span></span><br><span class="line">                <span class="string">"create_time datetime,"</span></span><br><span class="line">                <span class="string">"publish_date datetime)"</span>)</span><br><span class="line">    print(<span class="string">'book table created done.'</span>)</span><br><span class="line">    print(<span class="string">'------------------------------------'</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'create borrow_info table...'</span>)</span><br><span class="line">    cur.execute(<span class="string">"CREATE TABLE IF NOT EXISTS borrow_info ("</span></span><br><span class="line">                <span class="string">"id varchar(50) PRIMARY KEY,"</span></span><br><span class="line">                <span class="string">"book_id varchar(50),"</span></span><br><span class="line">                <span class="string">"book_name varchar(255),"</span></span><br><span class="line">                <span class="string">"borrow_user varchar(255),"</span></span><br><span class="line">                <span class="string">"borrow_num int(11),"</span></span><br><span class="line">                <span class="string">"borrow_days int(11),"</span></span><br><span class="line">                <span class="string">"borrow_time datetime,"</span></span><br><span class="line">                <span class="string">"return_time datetime,"</span></span><br><span class="line">                <span class="string">"return_flag int(11))"</span>)</span><br><span class="line">    print(<span class="string">'borrow_info table created done.'</span>)</span><br><span class="line">    print(<span class="string">'------------------------------------'</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'create ask_return table...'</span>)</span><br><span class="line">    cur.execute(<span class="string">"create table if not exists ask_return ("</span></span><br><span class="line">                <span class="string">"id int(11) PRIMARY KEY AUTO_INCREMENT NOT NULL,"</span></span><br><span class="line">                <span class="string">"user_name varchar(50) NOT NULL,"</span></span><br><span class="line">                <span class="string">"borrow_id varchar(50) NOT NULL,"</span></span><br><span class="line">                <span class="string">"is_read int(11) NOT NULL,"</span></span><br><span class="line">                <span class="string">"time datetime)"</span>)</span><br><span class="line">    print(<span class="string">'ask_return table created done.'</span>)</span><br><span class="line">    print(<span class="string">'-'</span>*<span class="number">30</span>)</span><br><span class="line">    print(<span class="string">'operate done.'</span>)</span><br><span class="line">    print(<span class="string">'create database successful.'</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">'the require information of database is correct, please check it and retry.'</span>)</span><br><span class="line">    print(e.args)</span><br><span class="line">    <span class="keyword">import</span> traceback</span><br><span class="line">    traceback.print_exc()</span><br><span class="line">    print(<span class="string">'create database failed.'</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Is insert some sample data into the database?'</span>)</span><br><span class="line">print(<span class="string">'1. insert'</span>)</span><br><span class="line">print(<span class="string">'2. exit'</span>)</span><br><span class="line">insert_tag = input(<span class="string">'please select the option:'</span>)</span><br><span class="line"><span class="keyword">if</span> insert_tag == <span class="string">'1'</span>:</span><br><span class="line">    print(<span class="string">'------------------------------------'</span>)</span><br><span class="line">    print(<span class="string">'starting the insert data operation...'</span>)</span><br><span class="line">    admin_data = [<span class="string">'12644064935811ea9063d8c497639e37'</span>, <span class="string">'admin'</span>, <span class="string">'21232f297a57a5a743894a0e4a801fc3'</span>, <span class="number">0</span>,</span><br><span class="line">                  <span class="string">'2020-05-11 15:23:12'</span>, <span class="number">0</span>, <span class="string">'2020-05-11 15:24:23'</span>]</span><br><span class="line">    user_data = [<span class="string">'99477a9e935811ea8171d8c497639e37'</span>, <span class="string">'zhangsan'</span>, <span class="string">'e10adc3949ba59abbe56e057f20f883e'</span>, <span class="number">1</span>,</span><br><span class="line">                 <span class="string">'2020-05-11 15:23:12'</span>, <span class="number">0</span>, <span class="string">'2020-05-11 15:24:23'</span>]</span><br><span class="line">    sql = <span class="string">'insert into user (id, username, password, role, create_time, delete_flag, current_login_time) values(%s,%s,'</span>\</span><br><span class="line">          <span class="string">'%s,%s,%s,%s,%s)'</span></span><br><span class="line">    cur.execute(sql, admin_data)</span><br><span class="line">    cur.execute(sql, user_data)</span><br><span class="line">    conn.commit()</span><br><span class="line">    cur.close()</span><br><span class="line">    conn.close()</span><br><span class="line">    print(<span class="string">'insert operation done.'</span>)</span><br><span class="line">    print(<span class="string">'------------------------------------'</span>)</span><br><span class="line">    print(<span class="string">'Now you can use admin account login with username="admin" password="admin" or use the normal account login'</span></span><br><span class="line">          <span class="string">'with username="zhangsan" password="123456".'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'system exit.'</span>)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/python/python基础/20190228_网络编程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Think Different">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/02/python/python基础/20190228_网络编程/" itemprop="url">
                  python网络编程
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-28T15:24:20+08:00">
                2019-02-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>UDP 协议（User Datagram Protocol 用户数据报协议）</p>
<pre><code>面向无连接，传输数据之前源端和目的端不需要建立连接

发送出去的数据不一定会接收得到

传输速率快、效率高
</code></pre><p>TCP 协议（Transmission Control Protocol传输控制协议）</p>
<pre><code>面向连接，传输数据之前需要建立连接

在连接过程中进行大量的数据传输

安全可靠的传输协议

传输速度慢、效率低
</code></pre><p>TCP 与 UDP 的主要区别</p>
<pre><code>1.TCP是面向连接的；UDP是无连接的

2.TCP的每个连接都是点对点的，即一对一进行；UDP的连接支持一对一，一对多，多对一以及多对多

3.TCP的传输比较安全可靠；UDP的传输则不那么可靠

4.TCP的传输比较较慢，但可以保证数据的顺序；UDP的传输速度较快，但不可保证数据的顺序

5.在对系统资源的要求上：TCP占用较多的系统资源；UDP只需少量的系统资源
</code></pre><h5 id="1-udp网络程序-发送数据"><a href="#1-udp网络程序-发送数据" class="headerlink" title="1. udp网络程序-发送数据"></a>1. udp网络程序-发送数据</h5><p>创建一个基于udp的网络程序，具体步骤如下：</p>
<ol>
<li>创建客户端套接字</li>
<li>发送/接收数据</li>
<li>关闭套接字</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20190724183726453.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2N1aV95b25naHVh,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>方式1：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 创建udp套接字</span></span><br><span class="line">udp_socket = socket(AF_INET, SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 准备接收方的地址</span></span><br><span class="line"><span class="comment"># '192.168.1.103'表示目的ip地址</span></span><br><span class="line"><span class="comment"># 8080表示目的端口</span></span><br><span class="line">dest_addr = (<span class="string">'127.0.0.1'</span>, <span class="number">6666</span>)  <span class="comment"># 注意 是元组，ip是字符串，端口是数字</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 从键盘获取数据</span></span><br><span class="line">send_data = input(<span class="string">"请输入要发送的数据:"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 发送数据到指定的电脑上的指定程序中</span></span><br><span class="line">udp_socket.sendto(send_data.encode(<span class="string">'gbk'</span>), dest_addr)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 关闭套接字</span></span><br><span class="line">udp_socket.close()</span><br></pre></td></tr></table></figure></p>
<p>方式2：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 1. 创建udp套接字</span></span><br><span class="line">    udp_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 准备接收方的地址</span></span><br><span class="line">    dest_addr = (<span class="string">'127.0.0.1'</span>, <span class="number">6666</span>)  <span class="comment"># 注意 是元组，ip是字符串，端口是数字</span></span><br><span class="line">    <span class="comment"># 3. 从键盘获取数据</span></span><br><span class="line">    send_data = input(<span class="string">"请输入要发送的数据:"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4. 发送数据到指定的电脑上的指定程序中</span></span><br><span class="line">    udp_socket.sendto(send_data.encode(<span class="string">'gbk'</span>), dest_addr)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5. 关闭套接字</span></span><br><span class="line">    udp_socket.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>方式3：可连续发送数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 1. 创建udp套接字</span></span><br><span class="line">    udp_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 2.从键盘获取数据</span></span><br><span class="line">        send_data = input(<span class="string">"请输入要发送的数据:"</span>)</span><br><span class="line">        <span class="comment"># 3. 如果用户输入exit，就退出程序</span></span><br><span class="line">        <span class="keyword">if</span> send_data == <span class="string">"exit"</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># 4. 发送数据到指定的电脑上的指定程序中</span></span><br><span class="line">        udp_socket.sendto(send_data.encode(<span class="string">'gbk'</span>), (<span class="string">'127.0.0.1'</span>, <span class="number">6666</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5. 关闭套接字</span></span><br><span class="line">    udp_socket.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h5 id="2-udp网络程序-发送、接收数据"><a href="#2-udp网络程序-发送、接收数据" class="headerlink" title="2. udp网络程序-发送、接收数据"></a>2. udp网络程序-发送、接收数据</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 创建udp套接字</span></span><br><span class="line">udp_socket = socket(AF_INET, SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 准备接收方的地址</span></span><br><span class="line">dest_addr = (<span class="string">'10.17.16.153'</span>, <span class="number">8888</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 从键盘获取数据</span></span><br><span class="line">send_data = input(<span class="string">"请输入要发送的数据:"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 发送数据到指定的电脑上</span></span><br><span class="line">udp_socket.sendto(send_data.encode(<span class="string">'utf-8'</span>), dest_addr)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 等待接收对方发送的数据</span></span><br><span class="line">recv_data = udp_socket.recvfrom(<span class="number">1024</span>)  <span class="comment"># 1024表示本次接收的最大字节数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 显示对方发送的数据</span></span><br><span class="line"><span class="comment"># 接收到的数据recv_data是一个元组</span></span><br><span class="line"><span class="comment"># 第1个元素是对方发送的数据</span></span><br><span class="line"><span class="comment"># 第2个元素是对方的ip和端口</span></span><br><span class="line">print(recv_data[<span class="number">0</span>].decode(<span class="string">'gbk'</span>))</span><br><span class="line">print(recv_data[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. 关闭套接字</span></span><br><span class="line">udp_socket.close()</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/python/python基础/20190226_文件操作/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Think Different">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/02/python/python基础/20190226_文件操作/" itemprop="url">
                  python文件操作
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-26T15:24:20+08:00">
                2019-02-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>常用文件：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">IGNORED_EXTENSIONS = [</span><br><span class="line">    <span class="comment"># 图片</span></span><br><span class="line">    <span class="string">'mng'</span>, <span class="string">'pct'</span>, <span class="string">'bmp'</span>, <span class="string">'gif'</span>, <span class="string">'jpg'</span>, <span class="string">'jpeg'</span>, <span class="string">'png'</span>, <span class="string">'pst'</span>, <span class="string">'psp'</span>, <span class="string">'tif'</span>,</span><br><span class="line">    <span class="string">'tiff'</span>, <span class="string">'ai'</span>, <span class="string">'drw'</span>, <span class="string">'dxf'</span>, <span class="string">'eps'</span>, <span class="string">'ps'</span>, <span class="string">'svg'</span>,</span><br><span class="line">    <span class="comment"># 音频</span></span><br><span class="line">    <span class="string">'mp3'</span>, <span class="string">'wma'</span>, <span class="string">'ogg'</span>, <span class="string">'wav'</span>, <span class="string">'ra'</span>, <span class="string">'aac'</span>, <span class="string">'mid'</span>, <span class="string">'au'</span>, <span class="string">'aiff'</span>,</span><br><span class="line">    <span class="comment"># 视频</span></span><br><span class="line">    <span class="string">'3gp'</span>, <span class="string">'asf'</span>, <span class="string">'asx'</span>, <span class="string">'avi'</span>, <span class="string">'mov'</span>, <span class="string">'mp4'</span>, <span class="string">'mpg'</span>, <span class="string">'qt'</span>, <span class="string">'rm'</span>, <span class="string">'swf'</span>, <span class="string">'wmv'</span>,</span><br><span class="line">    <span class="string">'m4a'</span>, <span class="string">'m4v'</span>, <span class="string">'flv'</span>,</span><br><span class="line">    <span class="comment"># 办公软件</span></span><br><span class="line">    <span class="string">'xls'</span>, <span class="string">'xlsx'</span>, <span class="string">'ppt'</span>, <span class="string">'pptx'</span>, <span class="string">'pps'</span>, <span class="string">'doc'</span>, <span class="string">'docx'</span>, <span class="string">'odt'</span>, <span class="string">'ods'</span>, <span class="string">'odg'</span>,</span><br><span class="line">    <span class="string">'odp'</span>,</span><br><span class="line">    <span class="comment"># 其它</span></span><br><span class="line">    <span class="string">'css'</span>, <span class="string">'pdf'</span>, <span class="string">'exe'</span>, <span class="string">'bin'</span>, <span class="string">'rss'</span>, <span class="string">'zip'</span>, <span class="string">'rar'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<h4 id="文件的打开与关闭"><a href="#文件的打开与关闭" class="headerlink" title="文件的打开与关闭"></a>文件的打开与关闭</h4><p>在python，使用: open(文件名，访问模式) 函数，可以打开一个已经存在的文件，或者创建一个新文件</p>
<table>
<thead>
<tr>
<th>访问模式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>r</td>
<td>以只读方式打开文件。文件的指针将会放在文件的开头。这是默认模式。</td>
</tr>
<tr>
<td>w</td>
<td>打开一个文件只用于写入。如果该文件已存在则将其覆盖。如果该文件不存在，创建新文件。</td>
</tr>
<tr>
<td>a</td>
<td>打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</td>
</tr>
<tr>
<td>rb</td>
<td>以二进制格式打开一个文件用于只读。文件指针将会放在文件的开头。这是默认模式。</td>
</tr>
<tr>
<td>wb</td>
<td>以二进制格式打开一个文件只用于写入。如果该文件已存在则将其覆盖。如果该文件不存在，创建新文件。</td>
</tr>
<tr>
<td>ab</td>
<td>以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</td>
</tr>
<tr>
<td>r+</td>
<td>打开一个文件用于读写。文件指针将会放在文件的开头。</td>
</tr>
<tr>
<td>w+</td>
<td>打开一个文件用于读写。如果该文件已存在则将其覆盖。如果该文件不存在，创建新文件。</td>
</tr>
<tr>
<td>a+</td>
<td>打开一个文件用于读写。如果该文件已存在，文件指针将会放在文件的结尾。文件打开时会是追加模式。如果该文件不存在，创建新文件用于读写。</td>
</tr>
<tr>
<td>rb+</td>
<td>以二进制格式打开一个文件用于读写。文件指针将会放在文件的开头。</td>
</tr>
<tr>
<td>wb+</td>
<td>以二进制格式打开一个文件用于读写。如果该文件已存在则将其覆盖。如果该文件不存在，创建新文件。</td>
</tr>
<tr>
<td>ab+</td>
<td>以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。如果该文件不存在，创建新文件用于读写。</td>
</tr>
</tbody>
</table>
<h4 id="文件的重命名和删除"><a href="#文件的重命名和删除" class="headerlink" title="文件的重命名和删除"></a>文件的重命名和删除</h4><p>os模块中的rename()可以完成对文件的重命名操作：rename(需要修改的文件名, 新的文件名)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.rename(<span class="string">"test.py"</span>, <span class="string">"test1.py"</span>)</span><br></pre></td></tr></table></figure></p>
<p>os模块中的remove()可以完成对文件的删除操作:  remove(待删除的文件名)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.remove(<span class="string">"毕业论文.txt"</span>)</span><br></pre></td></tr></table></figure></p>
<h4 id="文件夹的相关操作"><a href="#文件夹的相关操作" class="headerlink" title="文件夹的相关操作"></a>文件夹的相关操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 创建文件夹</span></span><br><span class="line">os.mkdir(<span class="string">"张三"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 获取当前目录</span></span><br><span class="line">os.getcwd()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 改变默认目录</span></span><br><span class="line">os.chdir(<span class="string">"../"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 获取目录列表</span></span><br><span class="line">os.listdir(<span class="string">"./"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 删除文件夹</span></span><br><span class="line">os.rmdir(<span class="string">"张三"</span>)</span><br></pre></td></tr></table></figure>
<p>Python3 OS 文件/目录方法：<br>os 模块提供了非常丰富的方法用来处理文件和目录。常用的方法如下表所示：</p>
<p>os.access(path, mode) ：检验权限模式<br>os.chdir(path)：改变当前工作目录<br>os.chflags(path, flags)：设置路径的标记为数字标记。<br>os.chmod(path, mode)：更改权限<br>os.chown(path, uid, gid)：更改文件所有者<br>os.chroot(path)：改变当前进程的根目录<br>os.close(fd)：关闭文件描述符 fd<br>os.closerange(fd_low, fd_high)：关闭所有文件描述符，从 fd_low (包含) 到 fd_high (不包含), 错误会忽略<br>os.dup(fd)：复制文件描述符 fd<br>os.dup2(fd, fd2)：将一个文件描述符 fd 复制到另一个 fd2<br>os.fchdir(fd)：通过文件描述符改变当前工作目录<br>os.fchmod(fd, mode)：改变一个文件的访问权限，该文件由参数fd指定，参数mode是Unix下的文件访问权限。<br>os.fchown(fd, uid, gid)：修改一个文件的所有权，这个函数修改一个文件的用户ID和用户组ID，该文件由文件描述符fd指定。<br>os.fdatasync(fd)：强制将文件写入磁盘，该文件由文件描述符fd指定，但是不强制更新文件的状态信息。<br>os.fdopen(fd[, mode[, bufsize]])：通过文件描述符 fd 创建一个文件对象，并返回这个文件对象<br>os.fpathconf(fd, name)：返回一个打开的文件的系统配置信息。name为检索的系统配置的值，它也许是一个定义系统值的字符串，这些名字在很多标准中指定（POSIX.1, Unix 95, Unix 98, 和其它）。<br>os.fstat(fd)：返回文件描述符fd的状态，像stat()。<br>os.fstatvfs(fd)：返回包含文件描述符fd的文件的文件系统的信息，像 statvfs()<br>os.fsync(fd)：强制将文件描述符为fd的文件写入硬盘。<br>os.ftruncate(fd, length)：裁剪文件描述符fd对应的文件, 所以它最大不能超过文件大小。<br>os.getcwd()：返回当前工作目录<br>os.getcwdu()：返回一个当前工作目录的Unicode对象<br>os.isatty(fd)：如果文件描述符fd是打开的，同时与tty(-like)设备相连，则返回true, 否则False。<br>os.lchflags(path, flags)：设置路径的标记为数字标记，类似 chflags()，但是没有软链接<br>os.lchmod(path, mode)：修改连接文件权限<br>os.lchown(path, uid, gid)：更改文件所有者，类似 chown，但是不追踪链接。<br>os.link(src, dst)：创建硬链接，名为参数 dst，指向参数 src<br>os.listdir(path)：返回path指定的文件夹包含的文件或文件夹的名字的列表。<br>os.lseek(fd, pos, how)：设置文件描述符 fd当前位置为pos, how方式修改: SEEK_SET 或者 0 设置从文件开始的计算的pos; SEEK_CUR或者 1 则从当前位置计算; os.SEEK_END或者2则从文件尾部开始. 在unix，Windows中有效<br>os.lstat(path)：像stat(),但是没有软链接<br>os.major(device)：从原始的设备号中提取设备major号码 (使用stat中的st_dev或者st_rdev field)。<br>os.makedev(major, minor)：以major和minor设备号组成一个原始设备号<br>os.makedirs(path[, mode])：递归文件夹创建函数。像mkdir(), 但创建的所有intermediate-level文件夹需要包含子文件夹。<br>os.minor(device)：从原始的设备号中提取设备minor号码 (使用stat中的st_dev或者st_rdev field )。<br>os.mkdir(path[, mode])：以数字mode的mode创建一个名为path的文件夹.默认的 mode 是 0777 (八进制)。<br>os.mkfifo(path[, mode])：创建命名管道，mode 为数字，默认为 0666 (八进制)<br>os.mknod(filename[, mode=0600, device])：创建一个名为filename文件系统节点（文件，设备特别文件或者命名pipe）。<br>os.open(file, flags[, mode])：打开一个文件，并且设置需要的打开选项，mode参数是可选的<br>os.openpty()：打开一个新的伪终端对。返回 pty 和 tty的文件描述符。<br>os.pathconf(path, name)：返回相关文件的系统配置信息。<br>os.pipe()：创建一个管道. 返回一对文件描述符(r, w) 分别为读和写<br>os.popen(command[, mode[, bufsize]])：从一个 command 打开一个管道<br>os.read(fd, n)：从文件描述符 fd 中读取最多 n 个字节，返回包含读取字节的字符串，文件描述符 fd对应文件已达到结尾, 返回一个空字符串。<br>os.readlink(path)：返回软链接所指向的文件<br>os.remove(path)：删除路径为path的文件。如果path 是一个文件夹，将抛出OSError; 查看下面的rmdir()：删除一个 directory。<br>os.removedirs(path)：递归删除目录。<br>os.rename(src, dst)：重命名文件或目录，从 src 到 dst<br>os.renames(old, new)：递归地对目录进行更名，也可以对文件进行更名。<br>os.rmdir(path)：删除path指定的空目录，如果目录非空，则抛出一个OSError异常。<br>os.stat(path)：获取path指定的路径的信息，功能等同于C API中的stat()系统调用。<br>os.stat_float_times([newvalue])：决定stat_result是否以float对象显示时间戳<br>os.statvfs(path)：获取指定路径的文件系统统计信息<br>os.symlink(src, dst)：创建一个软链接<br>os.tcgetpgrp(fd)：返回与终端fd（一个由os.open()返回的打开的文件描述符）关联的进程组<br>os.tcsetpgrp(fd, pg)：设置与终端fd（一个由os.open()返回的打开的文件描述符）关联的进程组为pg。<br>os.tempnam([dir[, prefix]])：返回唯一的路径名用于创建临时文件。<br>os.tmpfile()：返回一个打开的模式为(w+b)的文件对象 .这文件对象没有文件夹入口，没有文件描述符，将会自动删除。<br>os.tmpnam()：为创建一个临时文件返回一个唯一的路径<br>os.ttyname(fd)：返回一个字符串，它表示与文件描述符fd 关联的终端设备。如果fd 没有与终端设备关联，则引发一个异常。<br>os.unlink(path)：删除文件路径<br>os.utime(path, times)：返回指定的path文件的访问和修改的时间。<br>os.walk(top[, topdown=True[, onerror=None[, followlinks=False]]])：输出在文件夹中的文件名通过在树中游走，向上或者向下。<br>os.write(fd, str)：写入字符串到文件描述符 fd中. 返回实际写入的字符串长度</p>
<h4 id="3-案例"><a href="#3-案例" class="headerlink" title="3. 案例"></a>3. 案例</h4><p>1、用python处理文本数据，并删除处理之后的数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 根据条件把一个文本分成两个文本</span></span><br><span class="line"><span class="comment"># with open(r'list_object.txt', 'r') as file:</span></span><br><span class="line"><span class="comment">#     lines = file.readlines()</span></span><br><span class="line"><span class="comment">#     for key_word in lines:</span></span><br><span class="line"><span class="comment">#         if key_word.startswith('files/cninfo_category_daily_update/'):</span></span><br><span class="line"><span class="comment">#             with open(r'zs_stock.txt', 'a', encoding='utf-8') as file:</span></span><br><span class="line"><span class="comment">#                 file.write(key_word)</span></span><br><span class="line"><span class="comment">#         else:</span></span><br><span class="line"><span class="comment">#             with open(r'zs_bond.txt', 'a', encoding='utf-8') as file:</span></span><br><span class="line"><span class="comment">#                 file.write(key_word)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理文本数据，并删除处理之后的数据</span></span><br><span class="line">kafka_list = []</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">r'files/zs_stock.txt'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">    lines = file.readlines()</span><br><span class="line">    print(<span class="string">'读取文本行数：'</span>, len(lines))</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> lines[<span class="number">0</span>:<span class="number">5</span>]:</span><br><span class="line">        kafka_list.append(num)</span><br><span class="line">        lines.remove(num)</span><br><span class="line">    print(<span class="string">'kafka_list:'</span>, kafka_list)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">r'files/zs_stock.txt'</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        print(<span class="string">'删除已传送jds路径之后文本行数：'</span>, len(lines))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> lines:</span><br><span class="line">            f.write(i)</span><br></pre></td></tr></table></figure></p>
<p>2、输入文件的名字，然后程序自动完成对文件进行备份<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line">oldFileName = input(<span class="string">"请输入要拷贝的文件名字:"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(oldFileName, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> oldFile:</span><br><span class="line">    <span class="comment"># 如果打开文件</span></span><br><span class="line">    <span class="keyword">if</span> oldFile:</span><br><span class="line">        <span class="comment"># 提取文件的后缀</span></span><br><span class="line">        fileFlagNum = oldFileName.rfind(<span class="string">'.'</span>)</span><br><span class="line">        <span class="keyword">if</span> fileFlagNum &gt; <span class="number">0</span>:</span><br><span class="line">            fileFlag = oldFileName[fileFlagNum:]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 组织新的文件名字</span></span><br><span class="line">        newFileName = oldFileName[:fileFlagNum] + <span class="string">'[复件]'</span> + fileFlag</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 创建新文件</span></span><br><span class="line">        <span class="keyword">with</span> open(newFileName, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> newFile:</span><br><span class="line">            <span class="comment"># 把旧文件中的数据，一行一行的进行复制到新文件中</span></span><br><span class="line">            <span class="keyword">for</span> lineContent <span class="keyword">in</span> oldFile.readlines():</span><br><span class="line">                newFile.write(lineContent)</span><br></pre></td></tr></table></figure></p>
<p>3、批量在文件名前加前缀</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">funFlag = <span class="number">1</span>  <span class="comment"># 1表示添加标志  2表示删除标志</span></span><br><span class="line">folderName = <span class="string">'./test_fo/'</span></span><br><span class="line"><span class="comment"># 获取指定路径的所有文件名字</span></span><br><span class="line">dirList = os.listdir(folderName)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历输出所有文件名字</span></span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> dirList:</span><br><span class="line">    print(name)</span><br><span class="line">    <span class="keyword">if</span> funFlag == <span class="number">1</span>:  <span class="comment"># 增加前缀</span></span><br><span class="line">        newName = <span class="string">'[东哥出品]-'</span> + name</span><br><span class="line">    <span class="keyword">elif</span> funFlag == <span class="number">2</span>:  <span class="comment"># 去除前缀</span></span><br><span class="line">        num = len(<span class="string">'[东哥出品]-'</span>)</span><br><span class="line">        newName = name[num:]</span><br><span class="line">    print(newName)</span><br><span class="line"></span><br><span class="line">    os.rename(folderName + name, folderName + newName)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/python/python基础/20190311_打包/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Think Different">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/02/python/python基础/20190311_打包/" itemprop="url">
                  python文件操作
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-26T15:24:20+08:00">
                2019-02-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h2 id="PyInstaller使用（简单）"><a href="#PyInstaller使用（简单）" class="headerlink" title="PyInstaller使用（简单）"></a>PyInstaller使用（简单）</h2><hr>
<ol>
<li><p>安装 :</p>
<p><code>pip install pyinstaller==3.4</code></p>
<p>安装即可</p>
</li>
<li><p>PyInstaller 命令基本语法：</p>
<p><code>pyinstaller [options] script[script ...]|specfile</code></p>
<p><code>pyinstaller test.py</code></p>
<ul>
<li>参数及定义<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">常规</span><br><span class="line">-h 帮助</span><br><span class="line">-v 版本</span><br><span class="line">--distpath DIR 可执行文件生成目录 默认生成于脚本文件同级的dist目录下</span><br><span class="line">--workpath WORKPATH 临时文件目录，包括 .log,.pyz，默认有./build</span><br><span class="line">--y 无需确认备选输出目录</span><br><span class="line">--clean 构建结束后清除pyinstaller生成的缓存并删除临时文件</span><br><span class="line">--log-level LEVEL 构建时控制台输出日志级别，可选项：TRACE,DEBUG,INFO,WARN,ERROR,CRITICAL 默认为INFO</span><br><span class="line"></span><br><span class="line">用于构造的参数</span><br><span class="line">-D 构造为包含可执行文件的文件夹（所有依赖及数据均存在于文件夹中）</span><br><span class="line">-F 构造为单个可执行文件</span><br><span class="line">--specpath DIR 存储构造sepc文件的目录</span><br><span class="line">-n NAME 定义生成的应用和spec文件的名字 默认为第一个py文件的文件名</span><br><span class="line"></span><br><span class="line">寻找依赖及搜索的路径</span><br><span class="line">--add-data&lt;SRC;DEST or SRC:DEST&gt; 附加的需要添加进可执行文件的非二进制文件或文件夹，可多次使用（可以用于包含需要使用的数据文件）</span><br><span class="line">--add-binary&lt;SRC;DEST or SRC:DEST&gt; 附加的需要添加进可执行文件的二进制文件，可多次使用</span><br><span class="line">-p DIR 搜索导入模块的路径，可使用多个路径以搜索引入的模块，以&apos;;&apos;分隔或多次使用该参数。</span><br><span class="line">--hidden-import MODULENAME 标明并未显式于脚本中标识的引入模块</span><br><span class="line">--exclude-module EXCLUDES 可选的，需要忽略的模块或包（即使没有找到）</span><br><span class="line">--key KEY 加密二进制的密钥</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>基本用法</p>
<p>假定Python项目的主函数入口为<strong>main</strong>.py,则打包命令如下</p>
<p><code>pyinstaller -F main.py</code></p>
<p><em>-F参数大小写敏感</em></p>
<p>指定搜索路径，若有多个模块搜索路径需要指明</p>
<p><code>pyinstaller -F main.py -p /usr/local/python3/bin/python3 -p ./package</code></p>
<p>文档链接</p>
<p><a href="https://media.readthedocs.org/pdf/pyinstaller/stable/pyinstaller.pdf" target="_blank" rel="noopener">https://media.readthedocs.org/pdf/pyinstaller/stable/pyinstaller.pdf</a></p>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/python/python基础/20190225_进程和线程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Think Different">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/02/python/python基础/20190225_进程和线程/" itemprop="url">
                  python进程和线程
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-25T15:24:20+08:00">
                2019-02-25
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>操作系统会为每一个进程分配独立的内存空间，的那这样会占用独立的资源，对系统的开销较大。一般情况下我们可以使用多线程来完成多任务的开发，一个进程中包含了多个线程，对系统的开销较小一个进程中至少有一个线程，默认的这个线程我们叫做主线程。</p>
<p>单线程模拟人脑：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 敲键盘ing</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keyboard</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        print(<span class="string">"敲键盘ing..."</span>)</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 点鼠标ing</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mouse</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        print(<span class="string">"点鼠标ing..."</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    keyboard()</span><br><span class="line">    mouse()</span><br></pre></td></tr></table></figure>
<p>多线程：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 敲键盘ing</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keyboard</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        print(<span class="string">"敲键盘ing..."</span>)</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 点鼠标ing</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mouse</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        print(<span class="string">"点鼠标ing..."</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 为了方便，我们使用两个线程分别执行 keyboard和 mouse任务</span></span><br><span class="line">    print(<span class="string">"开辟前，当前有%s个线程在活动,他们是%s"</span> %</span><br><span class="line">          (threading.active_count(), threading.enumerate()))</span><br><span class="line"></span><br><span class="line">    keyboard_thread = threading.Thread(target=keyboard)</span><br><span class="line">    mouse_thread = threading.Thread(target=mouse)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"开辟后，当前有%s个线程在活动,他们是%s"</span> %</span><br><span class="line">          (threading.active_count(), threading.enumerate()))</span><br><span class="line"></span><br><span class="line">    keyboard_thread.start()</span><br><span class="line">    mouse_thread.start()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"start后，当前有%s个线程在活动,他们是%s"</span> %</span><br><span class="line">          (threading.active_count(), threading.enumerate()))</span><br><span class="line"></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="comment"># 使用完毕</span></span><br><span class="line">    print(<span class="string">"play over"</span>)</span><br></pre></td></tr></table></figure>
<p>========================================<br>（wiki陶喵）</p>
<h4 id="坑no-1-类成员变量加锁保护"><a href="#坑no-1-类成员变量加锁保护" class="headerlink" title="坑no. 1 类成员变量加锁保护"></a>坑no. 1 类成员变量加锁保护</h4><p>在并发程序中，一个重要的需要注意的点是程序的可重入性 <a href="https://blog.csdn.net/vincent040/article/details/50978979" target="_blank" rel="noopener">https://blog.csdn.net/vincent040/article/details/50978979</a><br>以下以一个例子来介绍。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding : utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">lock = threading.Lock()</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">my_model</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">                self.weights = <span class="number">1</span></span><br><span class="line">                self.mid_data = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(self,input_data)</span>:</span></span><br><span class="line">                self.mid_data = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">                        i+<span class="number">1</span></span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000000</span>):</span><br><span class="line">                        self.mid_data += (self.weights + input_data)</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">                        i+<span class="number">1</span></span><br><span class="line">                result = self.mid_data</span><br><span class="line">                <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">m = my_model()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/zero",methods=["GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">zero</span><span class="params">()</span>:</span></span><br><span class="line">        res = m.predict(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> str(res)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/one",methods=["GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">one</span><span class="params">()</span>:</span></span><br><span class="line">        res = m.predict(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> str(res)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">        app.run( host = <span class="string">"0.0.0.0"</span>, port = <span class="number">9865</span> )</span><br></pre></td></tr></table></figure></p>
<p>如上，这个程序看似没有什么问题。在连续访问下，能得到正确结果，但是当出现高并发的访问的时候，程序的结果就不可预知了。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(torch36) zhujinyi@gpuserver010:/data/nfs/wrk<span class="number">-4.1</span><span class="number">.0</span>$ wrk -t <span class="number">4</span> -c <span class="number">128</span> -d <span class="number">60</span>s -s test_m2.lua http://localhost:<span class="number">9865</span>/one</span><br><span class="line">Running <span class="number">1</span>m test @ http://localhost:<span class="number">9865</span>/one</span><br><span class="line">  <span class="number">4</span> threads <span class="keyword">and</span> <span class="number">128</span> connections</span><br><span class="line"><span class="number">953822</span></span><br><span class="line"><span class="number">3185088</span></span><br><span class="line"><span class="number">2847474</span></span><br><span class="line"><span class="number">2940568</span></span><br><span class="line"><span class="number">713724</span></span><br><span class="line"><span class="number">3103776</span></span><br><span class="line"><span class="number">2987122</span></span><br><span class="line"><span class="number">3380356</span></span><br><span class="line"><span class="number">105864</span></span><br><span class="line"><span class="number">3818912</span></span><br><span class="line"><span class="number">148244</span></span><br><span class="line"><span class="number">1301280</span></span><br><span class="line"><span class="number">1555600</span></span><br><span class="line"><span class="number">1495616</span></span><br><span class="line"><span class="number">4196668</span></span><br><span class="line"><span class="number">686306</span></span><br><span class="line"><span class="number">4317080</span></span><br><span class="line"><span class="number">729890</span></span><br><span class="line"><span class="number">909054</span></span><br></pre></td></tr></table></figure></p>
<p>这种情况下，常用的解决办法是加锁保护共享数据，界定临界区。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"># encoding : utf-8</span><br><span class="line"></span><br><span class="line">from flask import Flask</span><br><span class="line">import threading</span><br><span class="line"></span><br><span class="line">lock = threading.Lock()</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">class my_model():</span><br><span class="line">        def __init__(self):</span><br><span class="line">                self.weights = 1</span><br><span class="line">                self.mid_data = 0</span><br><span class="line"></span><br><span class="line">        def predict(self,input_data):</span><br><span class="line">                lock.acquire()</span><br><span class="line">                self.mid_data = 0</span><br><span class="line">                for i in range(1000):</span><br><span class="line">                        i+1</span><br><span class="line">                for i in range(1000000):</span><br><span class="line">                        self.mid_data += (self.weights + input_data)</span><br><span class="line">                for i in range(1000):</span><br><span class="line">                        i+1</span><br><span class="line">                result = self.mid_data</span><br><span class="line">                lock.release()</span><br><span class="line">                return result</span><br><span class="line"></span><br><span class="line">m = my_model()</span><br><span class="line"></span><br><span class="line">@app.route(&quot;/zero&quot;,methods=[&quot;GET&quot;])</span><br><span class="line">def zero():</span><br><span class="line">        res = m.predict(0)</span><br><span class="line">        return str(res)</span><br><span class="line"></span><br><span class="line">@app.route(&quot;/one&quot;,methods=[&quot;GET&quot;])</span><br><span class="line">def one():</span><br><span class="line">        res = m.predict(1)</span><br><span class="line">        return str(res)</span><br><span class="line"></span><br><span class="line">if __name__==&quot;__main__&quot;:</span><br><span class="line">        app.run( host = &quot;0.0.0.0&quot;, port = 9865 )</span><br></pre></td></tr></table></figure></p>
<p>这样可以得到正确的结果。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(torch36) zhujinyi@gpuserver010:/data/nfs/wrk-4.1.0$ wrk -t 4 -c 128 -d 60s -s test_m2.lua http://localhost:9865/one</span><br><span class="line">Running 1m test @ http://localhost:9865/one</span><br><span class="line">  4 threads and 128 connections</span><br><span class="line">2000000</span><br><span class="line">2000000</span><br><span class="line">2000000</span><br><span class="line">2000000</span><br><span class="line">2000000</span><br><span class="line">2000000</span><br><span class="line">2000000</span><br><span class="line">2000000</span><br><span class="line">2000000</span><br><span class="line">2000000</span><br><span class="line">2000000</span><br><span class="line">2000000</span><br><span class="line">2000000</span><br><span class="line">2000000</span><br><span class="line">2000000</span><br><span class="line">2000000</span><br></pre></td></tr></table></figure></p>
<p>当然，大粒度的锁会严重影响程序的性能，不推荐把锁加到函数级别，另一种可以得到正确结果的方案是用更多的空间。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class my_model():</span><br><span class="line">        def __init__(self):</span><br><span class="line">                self.weights = 1</span><br><span class="line">                self.mid_data = 0</span><br><span class="line"></span><br><span class="line">        def predict(self,input_data):</span><br><span class="line">                tmp_data = 0</span><br><span class="line">                for i in range(1000):</span><br><span class="line">                        i+1</span><br><span class="line">                for i in range(1000000):</span><br><span class="line">                        tmp_data += (self.weights + input_data)</span><br><span class="line">                for i in range(1000):</span><br><span class="line">                        i+1</span><br><span class="line">                result = tmp_data</span><br><span class="line">                return result</span><br></pre></td></tr></table></figure></p>
<p>这样写也可以得到正确结果。</p>
<h4 id="同时起5个进程"><a href="#同时起5个进程" class="headerlink" title="同时起5个进程"></a>同时起5个进程</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span><span class="params">(num)</span>:</span></span><br><span class="line">    print(<span class="string">f'hello: <span class="subst">&#123;num&#125;</span>'</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">works</span><span class="params">(func, tasknum)</span>:</span></span><br><span class="line">    proc_record = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(tasknum):</span><br><span class="line">        p = Process(target=func, args=(i,))</span><br><span class="line">        p.start()</span><br><span class="line">        proc_record.append(p)</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> proc_record:</span><br><span class="line">        p.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">        tasknum = <span class="number">5</span></span><br><span class="line">        works(task, tasknum)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/python/python基础/20190223_python正则表达式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Think Different">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/02/python/python基础/20190223_python正则表达式/" itemprop="url">
                  python正则表达式
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-23T15:24:20+08:00">
                2019-02-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">mystr=<span class="string">"""&lt;span class=\"search_yx_tj\"&gt;</span></span><br><span class="line"><span class="string">        共&lt;em&gt;5830&lt;/em&gt;个职位满足条件</span></span><br><span class="line"><span class="string">    &lt;/span&gt;"""</span></span><br><span class="line">restr = <span class="string">"&lt;em&gt;(\\d+)&lt;/em&gt;"</span>  <span class="comment"># 正则表达式，（）只要括号内的数据</span></span><br><span class="line">regex = re.compile(restr, re.IGNORECASE)</span><br><span class="line">mylist = regex.findall(mystr)</span><br><span class="line">print(mylist)  <span class="comment"># ['5830']</span></span><br><span class="line">print(mylist[<span class="number">0</span>])  <span class="comment"># 5830</span></span><br></pre></td></tr></table></figure>
<h4 id="python正则案例"><a href="#python正则案例" class="headerlink" title="python正则案例"></a>python正则案例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">m = re.match(<span class="string">r'(\w+) (\w+)(?P&lt;sign&gt;.*)'</span>, <span class="string">'hello world!'</span>)</span><br><span class="line">print(m)</span><br><span class="line">print(<span class="string">"@@@@@@@@m.string:"</span>, m.string)</span><br><span class="line">print(<span class="string">"m.re:"</span>, m.re)</span><br><span class="line">print(<span class="string">"m.pos:"</span>, m.pos)</span><br><span class="line">print(<span class="string">"m.endpos:"</span>, m.endpos)</span><br><span class="line">print(<span class="string">"m.lastindex:"</span>, m.lastindex)</span><br><span class="line">print(<span class="string">"m.lastgroup:"</span>, m.lastgroup)</span><br><span class="line">print(<span class="string">"m.group(1,2):"</span>, m.group(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">print(<span class="string">"m.groups():"</span>, m.groups())</span><br><span class="line">print(<span class="string">"m.groupdict():"</span>, m.groupdict())</span><br><span class="line">print(<span class="string">"m.start(2):"</span>, m.start(<span class="number">2</span>))</span><br><span class="line">print(<span class="string">"m.end(2):"</span>, m.end(<span class="number">2</span>))</span><br><span class="line">print(<span class="string">"m.span(2):"</span>, m.span(<span class="number">2</span>))</span><br><span class="line">print(<span class="string">r"m.expand(r'\2 \1\3'):"</span>, m.expand(<span class="string">r'\2 \1\3'</span>))</span><br><span class="line"></span><br><span class="line">p = re.compile(<span class="string">r'(\w+) (\w+)(?P&lt;sign&gt;.*)'</span>, re.DOTALL)</span><br><span class="line">print(<span class="string">"--------p.pattern:"</span>, p.pattern)</span><br><span class="line">print(<span class="string">"p.flags:"</span>, p.flags)</span><br><span class="line">print(<span class="string">"p.groups:"</span>, p.groups)</span><br><span class="line">print(<span class="string">"p.groupindex:"</span>, p.groupindex)</span><br><span class="line"></span><br><span class="line">line = <span class="string">"Cats are smarter than dogs"</span></span><br><span class="line">matchObj = re.match(<span class="string">r'(.*) are (.*?) .*'</span>, line, re.M | re.I).group(<span class="number">2</span>)</span><br><span class="line">print(matchObj)</span><br><span class="line"></span><br><span class="line">inputStr = <span class="string">"hello crifan, nihao crifan"</span>;</span><br><span class="line">replacedStr = re.sub(<span class="string">r"hello (\w+), nihao \1"</span>, <span class="string">"crifanli"</span>, inputStr)</span><br><span class="line">print(<span class="string">"%%%%%%%%%%replacedStr="</span>, replacedStr)  <span class="comment"># crifanli</span></span><br></pre></td></tr></table></figure>
<p>执行结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;_sre.SRE_Match object; span=(0, 12), match=&apos;hello world!&apos;&gt;</span><br><span class="line">@@@@@@@@m.string: hello world!</span><br><span class="line">m.re: re.compile(&apos;(\\w+) (\\w+)(?P&lt;sign&gt;.*)&apos;)</span><br><span class="line">m.pos: 0</span><br><span class="line">m.endpos: 12</span><br><span class="line">m.lastindex: 3</span><br><span class="line">m.lastgroup: sign</span><br><span class="line">m.group(1,2): (&apos;hello&apos;, &apos;world&apos;)</span><br><span class="line">m.groups(): (&apos;hello&apos;, &apos;world&apos;, &apos;!&apos;)</span><br><span class="line">m.groupdict(): &#123;&apos;sign&apos;: &apos;!&apos;&#125;</span><br><span class="line">m.start(2): 6</span><br><span class="line">m.end(2): 11</span><br><span class="line">m.span(2): (6, 11)</span><br><span class="line">m.expand(r&apos;\2 \1\3&apos;): world hello!</span><br><span class="line">--------p.pattern: (\w+) (\w+)(?P&lt;sign&gt;.*)</span><br><span class="line">p.flags: 48</span><br><span class="line">p.groups: 3</span><br><span class="line">p.groupindex: &#123;&apos;sign&apos;: 3&#125;</span><br><span class="line">smarter</span><br><span class="line">%%%%%%%%%%replacedStr= crifanli</span><br></pre></td></tr></table></figure></p>
<p>正则表达式之数字：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">数字：^[<span class="number">0</span><span class="number">-9</span>]*$</span><br><span class="line">n位的数字：^\d&#123;n&#125;$</span><br><span class="line">至少n位的数字：^\d&#123;n,&#125;$</span><br><span class="line">m-n位的数字：^\d&#123;m,n&#125;$</span><br><span class="line">零和非零开头的数字：^(<span class="number">0</span>|[<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>]*)$</span><br><span class="line">非零开头的最多带两位小数的数字：^([1-9][0-9]*)+(.[0-9]&#123;1,2&#125;)?$</span><br><span class="line">带1-2位小数的正数或负数：^(\-)?\d+(\.\d&#123;1,2&#125;)?$</span><br><span class="line">正数、负数、和小数：^(\-|\+)?\d+(\.\d+)?$</span><br><span class="line">有两位小数的正实数：^[0-9]+(.[0-9]&#123;2&#125;)?$</span><br><span class="line">有1~3位小数的正实数：^[0-9]+(.[0-9]&#123;1,3&#125;)?$</span><br><span class="line">非零的正整数：^[1-9]\d*$ 或 ^([1-9][0-9]*)&#123;1,3&#125;$ 或 ^\+?[1-9][0-9]*$</span><br><span class="line">非零的负整数：^\-[<span class="number">1</span><span class="number">-9</span>][]<span class="number">0</span><span class="number">-9</span><span class="string">"*$ 或 ^-[1-9]\d*$</span></span><br><span class="line"><span class="string">非负整数：^\d+$ 或 ^[1-9]\d*|0$</span></span><br><span class="line"><span class="string">非正整数：^-[1-9]\d*|0$ 或 ^((-\d+)|(0+))$</span></span><br><span class="line"><span class="string">非负浮点数：^\d+(\.\d+)?$ 或 ^[1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0$</span></span><br><span class="line"><span class="string">非正浮点数：^((-\d+(\.\d+)?)|(0+(\.0+)?))$ 或 ^(-([1-9]\d*\.\d*|0\.\d*[1-9]\d*))|0?\.0+|0$</span></span><br><span class="line"><span class="string">正浮点数：^[1-9]\d*\.\d*|0\.\d*[1-9]\d*$ 或 ^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$</span></span><br><span class="line"><span class="string">负浮点数：^-([1-9]\d*\.\d*|0\.\d*[1-9]\d*)$ 或 ^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$</span></span><br><span class="line"><span class="string">浮点数：^(-?\d+)(\.\d+)?$ 或 ^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$</span></span><br></pre></td></tr></table></figure></p>
<p>正则表达式在线生成工具: <a href="https://www.w3cschool.cn/tools/index?name=create_reg" target="_blank" rel="noopener">https://www.w3cschool.cn/tools/index?name=create_reg</a></p>
<h4 id="常见正则表达式"><a href="#常见正则表达式" class="headerlink" title="常见正则表达式"></a>常见正则表达式</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">一、校验数字的表达式</span><br><span class="line"></span><br><span class="line">数字：^[<span class="number">0</span><span class="number">-9</span>]*$</span><br><span class="line"></span><br><span class="line">n位的数字：^\d&#123;n&#125;$</span><br><span class="line"></span><br><span class="line">至少n位的数字：^\d&#123;n,&#125;$</span><br><span class="line"></span><br><span class="line">m-n位的数字：^\d&#123;m,n&#125;$</span><br><span class="line"></span><br><span class="line">零和非零开头的数字：^(<span class="number">0</span>|[<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>]*)$</span><br><span class="line"></span><br><span class="line">非零开头的最多带两位小数的数字：^([1-9][0-9]*)+(.[0-9]&#123;1,2&#125;)?$</span><br><span class="line"></span><br><span class="line">带1-2位小数的正数或负数：^(-)?\d+(.\d&#123;1,2&#125;)?$</span><br><span class="line"></span><br><span class="line">正数、负数、和小数：^(-|+)?\d+(.\d+)?$</span><br><span class="line"></span><br><span class="line">有两位小数的正实数：^[0-9]+(.[0-9]&#123;2&#125;)?$</span><br><span class="line"></span><br><span class="line">有1~3位小数的正实数：^[0-9]+(.[0-9]&#123;1,3&#125;)?$</span><br><span class="line"></span><br><span class="line">非零的正整数：^[1-9]\d$ 或 ^([1-9][0-9])&#123;1,3&#125;$ 或 ^+?[1-9][0-9]*$</span><br><span class="line"></span><br><span class="line">非零的负整数：^-[<span class="number">1</span><span class="number">-9</span>][]<span class="number">0</span><span class="number">-9</span>″$ 或 ^-[<span class="number">1</span><span class="number">-9</span>]\d$</span><br><span class="line"></span><br><span class="line">非负整数：^\d+$ 或 ^[<span class="number">1</span><span class="number">-9</span>]\d*|<span class="number">0</span>$</span><br><span class="line"></span><br><span class="line">非正整数：^-[<span class="number">1</span><span class="number">-9</span>]\d*|<span class="number">0</span>$ 或 ^((-\d+)|(<span class="number">0</span>+))$</span><br><span class="line"></span><br><span class="line">非负浮点数：^\d+(.\d+)?$ 或 ^[1-9]\d.\d|0.\d[1-9]\d|0?.0+|0$</span><br><span class="line"></span><br><span class="line">非正浮点数：^((-\d+(.\d+)?)|(0+(.0+)?))$ 或 ^(-([1-9]\d.\d|0.\d[1-9]\d))|0?.0+|0$</span><br><span class="line"></span><br><span class="line">正浮点数：^[<span class="number">1</span><span class="number">-9</span>]\d.\d|<span class="number">0.</span>\d[<span class="number">1</span><span class="number">-9</span>]\d$ 或 ^(([<span class="number">0</span><span class="number">-9</span>]+.[<span class="number">0</span><span class="number">-9</span>][<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>])|([<span class="number">0</span><span class="number">-9</span>][<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>].[<span class="number">0</span><span class="number">-9</span>]+)|([<span class="number">0</span><span class="number">-9</span>][<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>]))$</span><br><span class="line"></span><br><span class="line">负浮点数：^-([<span class="number">1</span><span class="number">-9</span>]\d.\d|<span class="number">0.</span>\d[<span class="number">1</span><span class="number">-9</span>]\d)$ 或 ^(-(([<span class="number">0</span><span class="number">-9</span>]+.[<span class="number">0</span><span class="number">-9</span>][<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>])|([<span class="number">0</span><span class="number">-9</span>][<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>].[<span class="number">0</span><span class="number">-9</span>]+)|([<span class="number">0</span><span class="number">-9</span>][<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>])))$</span><br><span class="line"></span><br><span class="line">浮点数：^(-?\d+)(.\d+)?$ 或 ^-?([1-9]\d.\d|0.\d[1-9]\d|0?.0+|0)$</span><br><span class="line"></span><br><span class="line">二、校验字符的表达式</span><br><span class="line"></span><br><span class="line">汉字：^[\u4e00-\u9fa5]&#123;<span class="number">0</span>,&#125;$</span><br><span class="line"></span><br><span class="line">英文和数字：^[A-Za-z0<span class="number">-9</span>]+$ 或 ^[A-Za-z0<span class="number">-9</span>]&#123;<span class="number">4</span>,<span class="number">40</span>&#125;$</span><br><span class="line"></span><br><span class="line">长度为<span class="number">3</span><span class="number">-20</span>的所有字符：^.&#123;<span class="number">3</span>,<span class="number">20</span>&#125;$</span><br><span class="line"></span><br><span class="line">由<span class="number">26</span>个英文字母组成的字符串：^[A-Za-z]+$</span><br><span class="line"></span><br><span class="line">由<span class="number">26</span>个大写英文字母组成的字符串：^[A-Z]+$</span><br><span class="line"></span><br><span class="line">由<span class="number">26</span>个小写英文字母组成的字符串：^[a-z]+$</span><br><span class="line"></span><br><span class="line">由数字和<span class="number">26</span>个英文字母组成的字符串：^[A-Za-z0<span class="number">-9</span>]+$</span><br><span class="line"></span><br><span class="line">由数字、<span class="number">26</span>个英文字母或者下划线组成的字符串：^\w+$ 或 ^\w&#123;<span class="number">3</span>,<span class="number">20</span>&#125;$</span><br><span class="line"></span><br><span class="line">中文、英文、数字包括下划线：^[\u4E00-\u9FA5A-Za-z0<span class="number">-9</span>_]+$</span><br><span class="line"></span><br><span class="line">中文、英文、数字但不包括下划线等符号：^[\u4E00-\u9FA5A-Za-z0<span class="number">-9</span>]+$ 或 ^[\u4E00-\u9FA5A-Za-z0<span class="number">-9</span>]&#123;<span class="number">2</span>,<span class="number">20</span>&#125;$</span><br><span class="line"></span><br><span class="line">可以输入含有^%&amp;’,;=?$\”等字符：[^%&amp;',;=?$\x22]+</span><br><span class="line"></span><br><span class="line">禁止输入含有~的字符：[^~\x22]+</span><br><span class="line"></span><br><span class="line">三、特殊需求表达式</span><br><span class="line"></span><br><span class="line">Email地址：^\w+([-+.]\w+)@\w+([-.]\w+).\w+([-.]\w+)*$</span><br><span class="line"></span><br><span class="line">域名：[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;(/.[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;)+/.?</span><br><span class="line"></span><br><span class="line">InternetURL：[a-zA-z]+://[^\s] 或 ^http://([\w-]+.)+[\w-]+(/[\w-./?%&amp;=])?$</span><br><span class="line"></span><br><span class="line">手机号码：^(<span class="number">13</span>[<span class="number">0</span><span class="number">-9</span>]|<span class="number">14</span>[<span class="number">5</span>|<span class="number">7</span>]|<span class="number">15</span>[<span class="number">0</span>|<span class="number">1</span>|<span class="number">2</span>|<span class="number">3</span>|<span class="number">5</span>|<span class="number">6</span>|<span class="number">7</span>|<span class="number">8</span>|<span class="number">9</span>]|<span class="number">18</span>[<span class="number">0</span>|<span class="number">1</span>|<span class="number">2</span>|<span class="number">3</span>|<span class="number">5</span>|<span class="number">6</span>|<span class="number">7</span>|<span class="number">8</span>|<span class="number">9</span>])\d&#123;<span class="number">8</span>&#125;$</span><br><span class="line"></span><br><span class="line">电话号码(“XXX-XXXXXXX”、”XXXX-XXXXXXXX”、”XXX-XXXXXXX”、”XXX-XXXXXXXX”、”XXXXXXX”和”XXXXXXXX)：^($$\d&#123;3,4&#125;-)|\d&#123;3.4&#125;-)?\d&#123;7,8&#125;$</span><br><span class="line"></span><br><span class="line">国内电话号码(<span class="number">0511</span><span class="number">-4405222</span>、<span class="number">021</span><span class="number">-87888822</span>)：\d&#123;<span class="number">3</span>&#125;-\d&#123;<span class="number">8</span>&#125;|\d&#123;<span class="number">4</span>&#125;-\d&#123;<span class="number">7</span>&#125;</span><br><span class="line"></span><br><span class="line">身份证号(<span class="number">15</span>位、<span class="number">18</span>位数字)：^\d&#123;<span class="number">15</span>&#125;|\d&#123;<span class="number">18</span>&#125;$</span><br><span class="line"></span><br><span class="line">短身份证号码(数字、字母x结尾)：^([0-9])&#123;7,18&#125;(x|X)?$ 或 ^\d&#123;8,18&#125;|[0-9x]&#123;8,18&#125;|[0-9X]&#123;8,18&#125;?$</span><br><span class="line"></span><br><span class="line">帐号是否合法(字母开头，允许<span class="number">5</span><span class="number">-16</span>字节，允许字母数字下划线)：^[a-zA-Z][a-zA-Z0<span class="number">-9</span>_]&#123;<span class="number">4</span>,<span class="number">15</span>&#125;$</span><br><span class="line"></span><br><span class="line">密码(以字母开头，长度在<span class="number">6</span>~<span class="number">18</span>之间，只能包含字母、数字和下划线)：^[a-zA-Z]\w&#123;<span class="number">5</span>,<span class="number">17</span>&#125;$</span><br><span class="line"></span><br><span class="line">强密码(必须包含大小写字母和数字的组合，不能使用特殊字符，长度在8-10之间)：^(?=.\d)(?=.[a-z])(?=.*[A-Z]).&#123;8,10&#125;$</span><br><span class="line"></span><br><span class="line">日期格式：^\d&#123;<span class="number">4</span>&#125;-\d&#123;<span class="number">1</span>,<span class="number">2</span>&#125;-\d&#123;<span class="number">1</span>,<span class="number">2</span>&#125;</span><br><span class="line"></span><br><span class="line">一年的12个月(01～09和1～12)：^(0?[1-9]|1[0-2])$</span><br><span class="line"></span><br><span class="line">一个月的31天(01～09和1～31)：^((0?[1-9])|((1|2)[0-9])|30|31)$</span><br><span class="line"></span><br><span class="line">钱的输入格式：</span><br><span class="line"></span><br><span class="line">有四种钱的表示形式我们可以接受:”<span class="number">10000.00</span>″ 和 “<span class="number">10</span>,<span class="number">000.00</span>″, 和没有 “分” 的 “<span class="number">10000</span>″ 和 “<span class="number">10</span>,<span class="number">000</span>″：^[<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>]*$</span><br><span class="line"></span><br><span class="line">这表示任意一个不以<span class="number">0</span>开头的数字，但是，这也意味着一个字符”<span class="number">0</span>″不通过，所以我们采用下面的形式：^(<span class="number">0</span>|[<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>]*)$</span><br><span class="line"></span><br><span class="line">一个0或者一个不以0开头的数字.我们还可以允许开头有一个负号：^(0|-?[1-9][0-9]*)$</span><br><span class="line"></span><br><span class="line">这表示一个0或者一个可能为负的开头不为0的数字.让用户以0开头好了.把负号的也去掉，因为钱总不能是负的吧.下面我们要加的是说明可能的小数部分：^[0-9]+(.[0-9]+)?$</span><br><span class="line"></span><br><span class="line">必须说明的是，小数点后面至少应该有1位数，所以”10.”是不通过的，但是 “10″ 和 “10.2″ 是通过的：^[0-9]+(.[0-9]&#123;2&#125;)?$</span><br><span class="line"></span><br><span class="line">这样我们规定小数点后面必须有两位，如果你认为太苛刻了，可以这样：^[0-9]+(.[0-9]&#123;1,2&#125;)?$</span><br><span class="line"></span><br><span class="line">这样就允许用户只写一位小数。下面我们该考虑数字中的逗号了，我们可以这样：^[0-9]&#123;1,3&#125;(,[0-9]&#123;3&#125;)*(.[0-9]&#123;1,2&#125;)?$</span><br><span class="line"></span><br><span class="line">1到3个数字，后面跟着任意个 逗号+3个数字，逗号成为可选，而不是必须：^([0-9]+|[0-9]&#123;1,3&#125;(,[0-9]&#123;3&#125;)*)(.[0-9]&#123;1,2&#125;)?$</span><br><span class="line"></span><br><span class="line">备注：这就是最终结果了，别忘了”+”可以用”*”替代。如果你觉得空字符串也可以接受的话(奇怪，为什么?)最后，别忘了在用函数时去掉去掉那个反斜杠，一般的错误都在这里</span><br><span class="line"></span><br><span class="line">xml文件：^([a-zA-Z]+-?)+[a-zA-Z0-9]+\.[x|X][m|M][l|L]$</span><br><span class="line"></span><br><span class="line">中文字符的正则表达式：[\u4e00-\u9fa5]</span><br><span class="line"></span><br><span class="line">双字节字符：[^\x00-\xff] (包括汉字在内，可以用来计算字符串的长度(一个双字节字符长度计<span class="number">2</span>，ASCII字符计<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">空白行的正则表达式：\n\s*\r (可以用来删除空白行)</span><br><span class="line"></span><br><span class="line">HTML标记的正则表达式：&lt;(\S?)[^&gt;]&gt;.?|&lt;.? /&gt; (网上流传的版本太糟糕，上面这个也仅仅能部分，对于复杂的嵌套标记依旧无能为力)</span><br><span class="line"></span><br><span class="line">首尾空白字符的正则表达式：^\s|\s$或(^\s)|(\s$) (可以用来删除行首行尾的空白字符(包括空格、制表符、换页符等等)，非常有用的表达式)</span><br><span class="line"></span><br><span class="line">腾讯QQ号：[<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>]&#123;<span class="number">4</span>,&#125; (腾讯QQ号从<span class="number">10000</span>开始)</span><br><span class="line"></span><br><span class="line">中国邮政编码：[1-9]\d&#123;5&#125;(?!\d) (中国邮政编码为6位数字)</span><br><span class="line"></span><br><span class="line">IP地址：\d+.\d+.\d+.\d+ (提取IP地址时有用)</span><br><span class="line"></span><br><span class="line">IP地址：((?:(?:25[0-5]|2[0-4]\d|[01]?\d?\d)\.)&#123;3&#125;(?:25[0-5]|2[0-4]\d|[01]?\d?\d))</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/uploads/avatar.png" alt="崔永华（Andy）">
          <p class="site-author-name" itemprop="name">崔永华（Andy）</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">38</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/cuiyonghua6" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://blog.csdn.net/cui_yonghua" target="_blank" title="CSDN">
                  
                    <i class="fa fa-fw fa-bandcamp"></i>
                  
                  CSDN
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/cuiyonghua" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://weibo.com/cuiyonghua" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">崔永华（Andy）</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
    <span class="site-pv">
      本站总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  

  

  

  

</body>
</html>
