<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">






<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0">






<meta name="description" content="No pain, no gain.">
<meta property="og:type" content="website">
<meta property="og:title" content="崔永华的个人网站">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="崔永华的个人网站">
<meta property="og:description" content="No pain, no gain.">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="崔永华的个人网站">
<meta name="twitter:description" content="No pain, no gain.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/5/">





  <title> 崔永华的个人网站 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">崔永华的个人网站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/java/java设计模式/20190524_java设计模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="崔永华的个人网站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/05/java/java设计模式/20190524_java设计模式/" itemprop="url">
                  java设计模式汇总
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-24T01:30:00+08:00">
                2019-05-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/java设计模式汇总/" itemprop="url" rel="index">
                    <span itemprop="name">java设计模式汇总</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h2 id="设计模式概述（Design-pattern）："><a href="#设计模式概述（Design-pattern）：" class="headerlink" title="设计模式概述（Design pattern）："></a>设计模式概述（Design pattern）：</h2><p><strong>设计模式</strong>：代表了最佳的实践，通常被有经验的面向对象的软件开发人员所采用。设计模式是软件开发人员在软件开发过程中面临的一般问题的解决方案。这些解决方案是众多软件开发人员经过相当长的一段时间的试验和错误总结出来的。</p>
<p><strong>设计模式是一套被反复使用的、多数人知晓的、经过分类编目的、代码设计经验的总结</strong>。使用设计模式是为了重用代码、让代码更容易被他人理解、保证代码可靠性。 毫无疑问，设计模式于己于他人于系统都是多赢的，设计模式使代码编制真正工程化，设计模式是软件工程的基石，如同大厦的一块块砖石一样。项目中合理地运用设计模式可以完美地解决很多问题，每种模式在现实中都有相应的原理来与之对应，每种模式都描述了一个在我们周围不断重复发生的问题，以及该问题的核心解决方案，这也是设计模式能被广泛应用的原因。</p>
<p><strong>GOF介绍</strong>:在 1994 年，由 Erich Gamma、Richard Helm、Ralph Johnson 和 John Vlissides 四人合著出版了一本名为 Design Patterns - Elements of Reusable Object-Oriented Software（中文译名：设计模式 - 可复用的面向对象软件元素） 的书，该书首次提到了软件开发中设计模式的概念。<br>四位作者合称 GOF（四人帮，全拼 Gang of Four）。他们所提出的设计模式主要是基于以下的面向对象设计原则。</p>
<ul>
<li>对接口编程而不是对实现编程。 </li>
<li>优先使用对象组合而不是继承。</li>
</ul>
<p><em>总的来说设计模式分为3大类：</em></p>
<p>• <strong>创建型模式（Creational Patterns）</strong>：（都是用来帮助我们创建对象的）这些设计模式提供了一种在创建对象的同时隐藏创建逻辑的方式，而不是使用 new 运算符直接实例化对象。这使得程序在判断针对某个给定实例需要创建哪些对象时更加灵活。主要包括：</p>
<ol>
<li><p>单例模式（Singleton Pattern）:<code>保证一个类仅有一个对象，并提供一个访问它的全局访问点。(Ensure a class only has one instance,and provide a globe point of access to it.)</code></p>
<p> 详细单例模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/90513546" target="_blank" rel="noopener">单例模式详解（附常见的7种单例模式源码）</a></p>
<p>用Python实现单例模式：<a href="https://blog.csdn.net/cui_yonghua/article/details/96433301" target="_blank" rel="noopener">用Python 实现单例模式 （Python经典编程案例）</a></p>
</li>
<li><p>工厂模式（Factory Pattern）：<code>定义一个用于创建对象的接口，让子类决定将哪一个类实例化，FactoryMethod使一个类的实例化延迟到其子类。（Define an interface for creating anobject, but let subclasses decide which class to instantiate. Factory methodlets a class defer instantiation to subclasses.）</code></p>
<p> 详细工厂模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/90718052" target="_blank" rel="noopener">工厂模式详解 (附java语言源码)</a></p>
<p>Python实现工厂模式：<a href="https://blog.csdn.net/cui_yonghua/article/details/96473836" target="_blank" rel="noopener">用python实现工厂设计模式（Python经典编程案例）</a></p>
</li>
<li><p>抽象工厂模式（Abstract Factory Pattern）：<code>提供一个创建一系列相关或相互依赖对象的接口，而无需指定它们的具体类。（Provide an interface for creating families of related or dependent object without specifying their concrete classes.）</code></p>
<p>详细抽象工厂模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/90722176" target="_blank" rel="noopener">抽象工厂模式详解 (附java语言源码)</a></p>
</li>
<li><p>建造者模式（Builder Pattern）：<code>将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。（Separate the construction of a complex object from its representation so that the same construction process can create different representations.）</code></p>
<p>详细建造者模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/90667226" target="_blank" rel="noopener">建造者模式详解 (附java语言源码)</a></p>
</li>
<li><p>原型模式（Prototype Pattern）:<code>用原型实例指定创建对象的种类，并且通过拷贝这个原型来创建新的对象。(Specify the kinds of objects to create using a prototypical instance, and create new objects by copying the prototype.)</code></p>
<p>详细原型模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/90789695" target="_blank" rel="noopener">原型模式详解 (附java语言源码)</a></p>
</li>
</ol>
<p>•<strong>结构型模式（Structural Patterns）</strong>：这些设计模式关注类和对象的组合。继承的概念被用来组合接口和定义组合对象获得新功能的方式。主要包括：</p>
<ol>
<li><p>适配器模式（Adapter Pattern）：<code>将一个类的接口转换成客户希望的另一个接口。Adapter模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。（Convert the interface of a class into another interface clients except. Adapter lets classes work together that couldn’t otherwise because of incompatible interfaces.）</code></p>
<p>详细适配器模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/90910093" target="_blank" rel="noopener">适配器模式详解 (附java语言源码)</a></p>
</li>
<li><p>桥接模式（Bridge Pattern）：<code>将抽象部分与它的实现部分分离，使他们都可以独立地变化。（Decouple an abstraction from its implementation so that the two can vary independently.）</code></p>
<p>详细桥接模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/91411166" target="_blank" rel="noopener">桥接模式详解 (附java语言源码)</a></p>
</li>
<li><p>装饰模式（Decorator Pattern）：<code>动态地给一个对象添加一些额外的职责。就扩展功能而言，Decorator模式比生成子类的方式更为灵活。（Attach additional responsibilities to an object dynamically. Decorators provides a flexible alternative to subclasses for extending functionality.）</code></p>
<p>详细装饰模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/90694213" target="_blank" rel="noopener">装饰模式详解 (附java语言源码)</a></p>
</li>
<li><p>组合模式（Composite Pattern）：<code>将对象组合成树形结构以表示“部分-整体”的层次结构。Composite 使得客户对单个对象和复合对象的使用具有一致性。（Compose object into tree structures torepresent part-whole hierarchy. Composite lets clients treat individual objectsand compositions of objects uniformly.）</code></p>
<p>详细组合模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/91438522" target="_blank" rel="noopener">组合模式详解 (附java语言源码)</a></p>
</li>
<li><p>外观模式（Facade Pattern）：<code>为子系统中的一组接口提供一个一致的接口。Façade模式定义了一个高层接口，这个接口使得这一子系统更加容易使用。（Provide a unified interface to a set of interfaces in a subsystem. Façade defines a higher-level interface that makes the subsystem easier to use.）</code></p>
<p>详细外观模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/91794310" target="_blank" rel="noopener">外观模式详解 (附java语言源码)</a></p>
</li>
<li><p>享元模式（Flyweight Pattern）：<code>运用共享技术有效地支持大量细粒度的对象。（Use sharing to support large numbers offine-grained objects efficiently.）</code></p>
<p>详细享元模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/91886352" target="_blank" rel="noopener">享元模式详解 (附java语言源码)</a></p>
</li>
<li><p>代理模式（Proxy Pattern）:<code>为其他对象提供一个代理以控制对这个对象的访问。(Provide a surrogate or placeholder foranther object to control access to it.)</code></p>
<p>详细代理模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/90751548" target="_blank" rel="noopener">代理模式详解 (附java语言源码)</a></p>
</li>
</ol>
<p>• <strong>行为型模式（Behavioral Patterns）</strong>：这些设计模式特别关注对象之间的通信。主要包括：</p>
<ol>
<li><p>模版方法模式（Template Pattern）:<code>定义一个操作中的算法的骨架，而将一些步骤延迟到子类。TemplateMethod 使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。(Define the skeleton of an algorithm inan operation, deferring some steps to subclasses. Template Method lets subclasses redefine certain steps of an algorithm without changing thealgorithm’s structure.)</code></p>
<p>详细模版方法模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/91972353" target="_blank" rel="noopener">模板方法模式详解 (附java语言源码)</a></p>
</li>
<li><p>命令模式（Command Pattern）：<code>将一个请求封装为一个对象，从而使你可用不同的请求对客户进行参数化，对请求排队或记录请求日志，以及支持可取消的操作。（Encapsulate a request as an object,thereby letting you parameterize clients with different requests, queue or log requests, and support undoable operations.）</code></p>
<p>详细命令模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/92670278" target="_blank" rel="noopener">命令模式详解 (附java语言源码)</a></p>
</li>
<li><p>迭代器模式（Iterator Pattern）：<code>提供一种方法顺序访问一个聚合对象中各个元素，而又不需暴露该对象的内部表示。（Provide a way to access the elements of an aggregate object sequentially without exposing its underlying representation.）</code></p>
<p>详细迭代器模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/92798405" target="_blank" rel="noopener">迭代器模式详解 (附java语言源码)</a></p>
</li>
<li><p>观察者模式（Observer Pattern）：<code>定义对象间的一种一对多的依赖关系，以便当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并自动刷新。（Define a one-to-many dependency between objects so that when one object changes state all its dependents are notified and updated automatically.）</code></p>
<p>详细观察者模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/90644632" target="_blank" rel="noopener">观察者模式详解 (附java语言源码)</a></p>
</li>
<li><p>中介者模式（Mediator Pattern）：<code>用一个中介对象来封装一系列的对象交互。中介者使各对象不需要显示地相互引用，从而使其耦合松散，而且可以独立地改变它们之间的交互。（Define an object that encapsulates how a set of objects interact. Mediator promotes loose coupling by keeping objects from referring to each other explicitly and it lets you vary their interaction independently.）</code></p>
<p>详细中介者模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/92839932" target="_blank" rel="noopener">中介者模式详解 (附java语言源码)</a></p>
</li>
<li><p>备忘录模式（Memento Pattern）：<code>在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保持该状态，这样以后就可以将该对象恢复到保存的状态。（Without violating encapsulates, captureand externalize an object’s internal state so that the object can be restored to this state later.）</code></p>
<p>详细备忘录模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/93111923" target="_blank" rel="noopener">备忘录模式详解 (附java语言源码)</a></p>
</li>
<li><p>解释器模式（Interpreter Pattern）：<code>定义一个语言，定义它的文法的一种表示，并定义一个解释器，该解释器使用该表示来解释语言中的句子。（Given a language, define are presentation for its grammar along with an interpreter that uses there presentation to interpret sentences in the language.）</code></p>
<p>详细解释器模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/93460141" target="_blank" rel="noopener">解释器模式详解 (没有附java语言源码)</a></p>
</li>
<li><p>状态模式（State Pattern）:<code>允许一个对象在其内部状态改变时改变它的行为。对象看起来似乎修改了它所属的类。(Allow an object to alter its behavior when its internal state changes. The object will appear to change its class.)</code></p>
<p>详细状态模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/93460491" target="_blank" rel="noopener">状态模式详解 (附java语言源码)</a></p>
</li>
<li><p>策略模式（Strategy Pattern）:<code>定义一系列的算法，把它们一个个封装起来，并且使他们可相互替换。本模式使得算法的变化可以独立于使用它的客户。(Define a family of algorithms,encapsulate each one and make them interchangeable. Strategy lets the algorithmvary independently from clients that use it.)</code></p>
<p>详细策略模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/90601469" target="_blank" rel="noopener">策略模式详解（用java语言实现策略模式）</a></p>
</li>
</ol>
<ol start="10">
<li><p>责任链模式（Chain of Responsibility Pattern）：<code>为解除请求的发送者和接收者之间的耦合，而使多个对象都有机会处理这个请求。将这些对象连成一条链，并沿着这条链传递该请求，直到有对象处理它。（Avoid coupling the sender of a requestits receiver by giving more than one object a chance to handle the request.Chain the receiving objects and pass the request along the chain until anobject handles it.）</code></p>
<p>   详细责任链模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/93462893" target="_blank" rel="noopener">责任链模式详解 (附java语言源码)</a></p>
</li>
<li><p>访问者模式（Visitor Pattern）:<code>表示一个作用于某对象结构中的各元素的操作。它使你可以在不改变各元素类别的前提下定义作用于这些元素的新操作。(Represent an operation to be performedon the elements of an object structure. Visitor lets you define a new operation without changing the classes of the elements on which it operates.)</code></p>
<p>   详细访问者模式介绍可点此链接：<a href="https://blog.csdn.net/cui_yonghua/article/details/93462782" target="_blank" rel="noopener">访问者模式详解 (没有附java语言源码)</a></p>
</li>
</ol>
<p>此外还有一些<strong>J2EE模式</strong>：这些设计模式特别关注表示层。这些模式是由 Sun Java Center 鉴定的。</p>
<ol>
<li>MVC 模式（MVC Pattern） </li>
<li>业务代表模式（Business Delegate Pattern）   </li>
<li>组合实体模式（Composite Entity Pattern） </li>
<li>数据访问对象模式（Data Access Object Pattern）    </li>
<li>前端控制器模式（Front Controller Pattern） </li>
<li>拦截过滤器模式（Intercepting Filter Pattern） </li>
<li>服务定位器模式（Service Locator Pattern） </li>
<li>传输对象模式（Transfer Object  Pattern）</li>
</ol>
<p>下面用一个图片来整体描述一下设计模式之间的关系：<br><img src="https://img-blog.csdnimg.cn/20190524102733886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2N1aV95b25naHVh,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><del>谢谢</del></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/python/python基础/20190311_打包/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="崔永华的个人网站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/python/python基础/20190311_打包/" itemprop="url">
                  python打包
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-11T15:24:20+08:00">
                2019-03-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h2 id="PyInstaller使用（简单）"><a href="#PyInstaller使用（简单）" class="headerlink" title="PyInstaller使用（简单）"></a>PyInstaller使用（简单）</h2><hr>
<ol>
<li><p>安装 :</p>
<p><code>pip install pyinstaller==3.4</code></p>
<p>安装即可</p>
</li>
<li><p>PyInstaller 命令基本语法：</p>
<p><code>pyinstaller [options] script[script ...]|specfile</code></p>
<p><code>pyinstaller test.py</code></p>
<ul>
<li>参数及定义<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">常规</span><br><span class="line">-h 帮助</span><br><span class="line">-v 版本</span><br><span class="line">--distpath DIR 可执行文件生成目录 默认生成于脚本文件同级的dist目录下</span><br><span class="line">--workpath WORKPATH 临时文件目录，包括 .log,.pyz，默认有./build</span><br><span class="line">--y 无需确认备选输出目录</span><br><span class="line">--clean 构建结束后清除pyinstaller生成的缓存并删除临时文件</span><br><span class="line">--log-level LEVEL 构建时控制台输出日志级别，可选项：TRACE,DEBUG,INFO,WARN,ERROR,CRITICAL 默认为INFO</span><br><span class="line"></span><br><span class="line">用于构造的参数</span><br><span class="line">-D 构造为包含可执行文件的文件夹（所有依赖及数据均存在于文件夹中）</span><br><span class="line">-F 构造为单个可执行文件</span><br><span class="line">--specpath DIR 存储构造sepc文件的目录</span><br><span class="line">-n NAME 定义生成的应用和spec文件的名字 默认为第一个py文件的文件名</span><br><span class="line"></span><br><span class="line">寻找依赖及搜索的路径</span><br><span class="line">--add-data&lt;SRC;DEST or SRC:DEST&gt; 附加的需要添加进可执行文件的非二进制文件或文件夹，可多次使用（可以用于包含需要使用的数据文件）</span><br><span class="line">--add-binary&lt;SRC;DEST or SRC:DEST&gt; 附加的需要添加进可执行文件的二进制文件，可多次使用</span><br><span class="line">-p DIR 搜索导入模块的路径，可使用多个路径以搜索引入的模块，以&apos;;&apos;分隔或多次使用该参数。</span><br><span class="line">--hidden-import MODULENAME 标明并未显式于脚本中标识的引入模块</span><br><span class="line">--exclude-module EXCLUDES 可选的，需要忽略的模块或包（即使没有找到）</span><br><span class="line">--key KEY 加密二进制的密钥</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>基本用法</p>
<p>假定Python项目的主函数入口为<strong>main</strong>.py,则打包命令如下</p>
<p><code>pyinstaller -F main.py</code></p>
<p><em>-F参数大小写敏感</em></p>
<p>指定搜索路径，若有多个模块搜索路径需要指明</p>
<p><code>pyinstaller -F main.py -p /usr/local/python3/bin/python3 -p ./package</code></p>
<p>文档链接</p>
<p><a href="https://media.readthedocs.org/pdf/pyinstaller/stable/pyinstaller.pdf" target="_blank" rel="noopener">https://media.readthedocs.org/pdf/pyinstaller/stable/pyinstaller.pdf</a></p>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/python/python基础/20190310_发布模块/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="崔永华的个人网站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/python/python基础/20190310_发布模块/" itemprop="url">
                  python发布模块
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-10T15:24:20+08:00">
                2019-03-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>升级模块：pip install –upgrade 库名</p>
<h4 id="一-让别人pip-install"><a href="#一-让别人pip-install" class="headerlink" title="一. 让别人pip install"></a>一. 让别人pip install</h4><p>官方参考：<a href="https://packaging.python.org/tutorials/packaging-projects/" target="_blank" rel="noopener">https://packaging.python.org/tutorials/packaging-projects/</a></p>
<p>参考文章：<a href="https://mp.weixin.qq.com/s/IZJfkfgDWSGNhuUJn6wRoQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/IZJfkfgDWSGNhuUJn6wRoQ</a></p>
<p>我的：<a href="https://pypi.org/" target="_blank" rel="noopener">https://pypi.org/</a>   cuiyonghua  cui1-A!</p>
<p><a href="https://github.com/wistbean/learn_python3_spider" target="_blank" rel="noopener">https://github.com/wistbean/learn_python3_spider</a></p>
<p>/Users/cuiyonghua/Desktop/my_work_files/softwares/mongodb/mongodata/etc/mongo.conf</p>
<p>init<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from __future__ import absolute_import</span><br><span class="line">from .xiaocui import *</span><br><span class="line"></span><br><span class="line">name = &quot;xiaocui&quot;</span><br></pre></td></tr></table></figure></p>
<p>xiaocui.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">output</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'hello,这是'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">output1</span><span class="params">(data)</span>:</span></span><br><span class="line">    print(<span class="string">'hello,这是：&#123;&#125;'</span>.format(data))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">susu</span><span class="params">(susu)</span>:</span></span><br><span class="line">    print(<span class="string">'susu:&#123;&#125;'</span>.format(susu))</span><br></pre></td></tr></table></figure></p>
<p>setup.py:</p>
<p>这个文件主要是要告诉 setuptools ，我们的包里面的一些信息，比如名称啊，版本号啊，作者，邮箱等等<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> setuptools</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"README.md"</span>, <span class="string">"r"</span>) <span class="keyword">as</span> fh:</span><br><span class="line">    long_description = fh.read()</span><br><span class="line"></span><br><span class="line">setuptools.setup(</span><br><span class="line">    name=<span class="string">"xiaocui"</span>,</span><br><span class="line">    version=<span class="string">"0.0.1"</span>,</span><br><span class="line">    author=<span class="string">"xiaocui"</span>,</span><br><span class="line">    author_email=<span class="string">"cui_yonghua6@163.com"</span>,</span><br><span class="line">    description=<span class="string">"This is an cui package, fa li wu bian"</span>,</span><br><span class="line">    long_description=long_description,</span><br><span class="line">    long_description_content_type=<span class="string">"text/markdown"</span>,</span><br><span class="line">    keywords=<span class="string">"hello world example examples"</span>,</span><br><span class="line">    url=<span class="string">"https://github.com/cuiyonghua6/cui_package"</span>,</span><br><span class="line">    packages=setuptools.find_packages(),</span><br><span class="line">    classifiers=[</span><br><span class="line">        <span class="string">'Programming Language :: Python :: 3'</span>,</span><br><span class="line">        <span class="string">'License :: OSI Approved :: MIT License'</span>,</span><br><span class="line">        <span class="string">'Operating System :: OS Independent'</span>,</span><br><span class="line">    ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>LICENCE<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">MIT License</span><br><span class="line"></span><br><span class="line">Copyright (c) 2020 cuiyonghua6</span><br><span class="line"></span><br><span class="line">Permission is hereby granted, free of charge, to any person obtaining a copy</span><br><span class="line">of this software and associated documentation files (the &quot;Software&quot;), to deal</span><br><span class="line">in the Software without restriction, including without limitation the rights</span><br><span class="line">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span><br><span class="line">copies of the Software, and to permit persons to whom the Software is</span><br><span class="line">furnished to do so, subject to the following conditions:</span><br><span class="line"></span><br><span class="line">The above copyright notice and this permission notice shall be included in all</span><br><span class="line">copies or substantial portions of the Software.</span><br><span class="line"></span><br><span class="line">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span><br><span class="line">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span><br><span class="line">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span><br><span class="line">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span><br><span class="line">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span><br><span class="line">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span><br><span class="line">SOFTWARE.</span><br></pre></td></tr></table></figure></p>
<p>python3 -m pip install –user –upgrade setuptools wheel</p>
<p>python3 setup.py sdist bdist_wheel<br><img src="evernotecid://B1CD39FE-B044-413D-A086-0649DB3F0070/appyinxiangcom/26430792/ENResource/p807" alt="fb57214c777f0e2c57560323dba75a01.png"></p>
<p><a href="https://pypi.org/account/register/" target="_blank" rel="noopener">https://pypi.org/account/register/</a></p>
<p><a href="https://test.pypi.org/account/register/" target="_blank" rel="noopener">https://test.pypi.org/account/register/</a></p>
<p>python3 -m pip install –user –upgrade twine</p>
<p>(apt install twine)<br>python3 -m twine upload dist/*</p>
<h4 id="二-setup-py-参数解释"><a href="#二-setup-py-参数解释" class="headerlink" title="二. setup.py 参数解释"></a>二. setup.py 参数解释</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">--name 包名称</span><br><span class="line">--version (-V) 包版本</span><br><span class="line">--author 程序的作者</span><br><span class="line">--author_email 程序的作者的邮箱地址</span><br><span class="line">--maintainer 维护者</span><br><span class="line">--maintainer_email 维护者的邮箱地址</span><br><span class="line">--url 程序的官网地址</span><br><span class="line">--license 程序的授权信息</span><br><span class="line">--description 程序的简单描述</span><br><span class="line">--long_description 程序的详细描述</span><br><span class="line">--platforms 程序适用的软件平台列表</span><br><span class="line">--classifiers 程序的所属分类列表</span><br><span class="line">--keywords 程序的关键字列表</span><br><span class="line">--packages 需要处理的包目录（包含__init__.py的文件夹） </span><br><span class="line">--py_modules 需要打包的python文件列表</span><br><span class="line">--download_url 程序的下载地址</span><br><span class="line">--cmdclass </span><br><span class="line">--data_files 打包时需要打包的数据文件，如图片，配置文件等</span><br><span class="line">--scripts 安装时需要执行的脚步列表</span><br><span class="line">--package_dir 告诉setuptools哪些目录下的文件被映射到哪个源码包。一个例子：package_dir = &#123;&apos;&apos;: &apos;lib&apos;&#125;，表示“root package”中的模块都在lib 目录中。</span><br><span class="line">--requires 定义依赖哪些模块 </span><br><span class="line">--provides定义可以为哪些模块提供依赖 </span><br><span class="line">--find_packages() 对于简单工程来说，手动增加packages参数很容易，刚刚我们用到了这个函数，它默认在和setup.py同一目录下搜索各个含有 __init__.py的包。                          其实我们可以将包统一放在一个src目录中，另外，这个包内可能还有aaa.txt文件和data数据文件夹。另外，也可以排除一些特定的包                          find_packages(exclude=[&quot;*.tests&quot;, &quot;*.tests.*&quot;, &quot;tests.*&quot;, &quot;tests&quot;])--install_requires = [&quot;requests&quot;] 需要安装的依赖包</span><br><span class="line">--entry_points 动态发现服务和插件，下面详细讲</span><br></pre></td></tr></table></figure>
<p>下列entry_points中： console_scripts 指明了命令行工具的名称；在“redis_run = RedisRun.redis_run:main”中，等号前面指明了工具包的名称，等号后面的内容指明了程序的入口地址。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">entry_points=&#123;&apos;console_scripts&apos;: [</span><br><span class="line">       &apos;redis_run = RedisRun.redis_run:main&apos;,</span><br><span class="line">]&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="三-示例代码："><a href="#三-示例代码：" class="headerlink" title="三. 示例代码："></a>三. 示例代码：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path <span class="keyword">as</span> os_path</span><br><span class="line"><span class="keyword">from</span> setuptools <span class="keyword">import</span> setup</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> haipproxy</span><br><span class="line"></span><br><span class="line">this_directory = os_path.abspath(os_path.dirname(__file__))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取文件内容</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(os_path.join(this_directory, filename), encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        long_description = f.read()</span><br><span class="line">    <span class="keyword">return</span> long_description</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取依赖</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_requirements</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [line.strip() <span class="keyword">for</span> line <span class="keyword">in</span> read_file(filename).splitlines()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> line.startswith(<span class="string">'#'</span>)]</span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    name=<span class="string">'haipproxy'</span>,  <span class="comment"># 包名</span></span><br><span class="line">    python_requires=<span class="string">'&gt;=3.4.0'</span>, <span class="comment"># python环境</span></span><br><span class="line">    version=haipproxy.__version__, <span class="comment"># 包的版本</span></span><br><span class="line">    description=<span class="string">"High aviariable proxy pool client for crawlers."</span>,  <span class="comment"># 包简介，显示在PyPI上</span></span><br><span class="line">    long_description=read_file(<span class="string">'README.md'</span>), <span class="comment"># 读取的Readme文档内容</span></span><br><span class="line">    long_description_content_type=<span class="string">"text/markdown"</span>,  <span class="comment"># 指定包文档格式为markdown</span></span><br><span class="line">    author=<span class="string">"Resolvewang"</span>, <span class="comment"># 作者相关信息</span></span><br><span class="line">    author_email=<span class="string">'resolvewang@foxmail.com'</span>,</span><br><span class="line">    url=<span class="string">'https://github.com/SpiderClub/haipproxy'</span>,</span><br><span class="line">    <span class="comment"># 指定包信息，还可以用find_packages()函数</span></span><br><span class="line">    packages=[</span><br><span class="line">        <span class="string">'haipproxy'</span>,</span><br><span class="line">        <span class="string">'haipproxy.client'</span>,</span><br><span class="line">        <span class="string">'haipproxy.utils'</span></span><br><span class="line">    ],</span><br><span class="line">    install_requires=read_requirements(<span class="string">'requirements.txt'</span>),  <span class="comment"># 指定需要安装的依赖</span></span><br><span class="line">    include_package_data=<span class="literal">True</span>,</span><br><span class="line">    license=<span class="string">"MIT"</span>,</span><br><span class="line">    keywords=[<span class="string">'proxy'</span>, <span class="string">'client'</span>, <span class="string">'haipproxy'</span>],</span><br><span class="line">    classifiers=[</span><br><span class="line">        <span class="string">'Intended Audience :: Developers'</span>,</span><br><span class="line">        <span class="string">'License :: OSI Approved :: MIT License'</span>,</span><br><span class="line">        <span class="string">'Natural Language :: English'</span>,</span><br><span class="line">        <span class="string">'Programming Language :: Python :: 3.4'</span>,</span><br><span class="line">        <span class="string">'Programming Language :: Python :: 3.5'</span>,</span><br><span class="line">        <span class="string">'Programming Language :: Python :: 3.6'</span>,</span><br><span class="line">    ],)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/python/python基础/20190307_python编码规范/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="崔永华的个人网站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/python/python基础/20190307_python编码规范/" itemprop="url">
                  python编码规范
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-08T15:24:20+08:00">
                2019-03-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>标签（空格分隔）： python PEP8 代码 规范 </p>
<hr>
<p>在日常工作中，编写python代码时，大家有可能因为IDE的不同或者是没有遵循python的pep8规范而导致每个人的格式都不尽相同，导致其他人阅读起来比较吃力。但是有时候代码规范也并不是建议使用的，最主要的是<strong>风格一致性</strong>，每个组内的代码风格统一起来才是最重要的，根据自己的判断选择是否遵循PEP8。</p>
<p><strong>ps: 许多项目有自己的编码规范，在出现规范冲突时，项目自身的规范优先。</strong></p>
<p>接下来我们只挑一些在工作中频繁遇到规范进行示例，为减少大家阅读时间，以 <strong><font color="#50ca14">推荐</font></strong> 和 <strong><font color="#ea4335">糟糕</font></strong> 来说明。</p>
<h2 id="Code-lay-out-代码布局"><a href="#Code-lay-out-代码布局" class="headerlink" title="Code lay-out 代码布局"></a><strong>Code lay-out 代码布局</strong></h2><h4 id="Indentation-缩进"><a href="#Indentation-缩进" class="headerlink" title="Indentation 缩进"></a><strong>Indentation 缩进</strong></h4><p>每一级缩进使用4个空格。</p>
<p>推荐:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 与左括号对齐</span></span><br><span class="line">foo = long_function_name(var_one, var_two,</span><br><span class="line">                         var_three, var_four)</span><br><span class="line">                         </span><br><span class="line"><span class="comment"># 用更多的缩进来与其他行区分</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">long_function_name</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        var_one, var_two, var_three,</span></span></span><br><span class="line"><span class="function"><span class="params">        var_four)</span>:</span></span><br><span class="line">    print(var_one)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 挂行缩进应该再换一行</span></span><br><span class="line">foo = long_function_name(</span><br><span class="line">    var_one, var_two,</span><br><span class="line">    var_three, var_four)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 与内容对齐</span></span><br><span class="line">my_list = [</span><br><span class="line">    <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,</span><br><span class="line">    <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 与第一行第一个字符对齐</span></span><br><span class="line">my_list = [</span><br><span class="line">    <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,</span><br><span class="line">    <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p><strong><font color="#ea4335">糟糕:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 没有使用垂直对齐时，禁止把参数放在第一行</span></span><br><span class="line">foo = long_function_name(var_one, var_two,</span><br><span class="line">    var_three, var_four)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当缩进没有与其他行区分时，要增加缩进</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">long_function_name</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    var_one, var_two, var_three,</span></span></span><br><span class="line"><span class="function"><span class="params">    var_four)</span>:</span></span><br><span class="line">    print(var_one)</span><br><span class="line"></span><br><span class="line">my_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br></pre></td></tr></table></figure></p>
<h4 id="Maximum-Line-Length-行的最大长度"><a href="#Maximum-Line-Length-行的最大长度" class="headerlink" title="Maximum Line Length 行的最大长度"></a><strong>Maximum Line Length 行的最大长度</strong></h4><p><strong>所有行限制的最大字符数为79。</strong></p>
<h4 id="Blank-Lines-空行"><a href="#Blank-Lines-空行" class="headerlink" title="Blank Lines 空行"></a><strong>Blank Lines 空行</strong></h4><p><strong><font color="#50ca14">推荐:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 类与类之间前后用两个空行隔开</span></span><br><span class="line">Class A:...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Class B:...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 类中函数与函数之间前后用一个空行隔开</span></span><br><span class="line">Class C:</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">c_a</span><span class="params">(self)</span>:</span>...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">c_b</span><span class="params">(self)</span>:</span>...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数与函数之间前后用两个空行隔开</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_run</span><span class="params">()</span>:</span>...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">b_run</span><span class="params">()</span>:</span>...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在函数中使用空行来区分逻辑段（谨慎使用）。</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">c_run</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 逻辑A</span></span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 逻辑B</span></span><br><span class="line">    ...</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure></p>
<h4 id="Imports-导入"><a href="#Imports-导入" class="headerlink" title="Imports 导入"></a><strong>Imports 导入</strong></h4><p><strong><font color="#50ca14">推荐:</font></strong></p>
<ul>
<li>导入应该按照以下顺序分组：<ul>
<li>标准库导入</li>
<li>相关第三方库导入</li>
<li>本地应用/库特定导入</li>
</ul>
</li>
</ul>
<p>同时在每一组导入之间加入空行。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 官方标准库导入</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第三方库</span></span><br><span class="line"><span class="keyword">import</span> arrow</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入本地库</span></span><br><span class="line"><span class="keyword">import</span> app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以from导入标准库</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以from导入第三方库</span></span><br><span class="line"><span class="keyword">from</span> ldap3 <span class="keyword">import</span> Server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以from导入本地库</span></span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> DB</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> create_app  <span class="comment"># 处理绝对路径过长时可以以相对路径进行替换</span></span><br></pre></td></tr></table></figure></p>
<p><strong><font color="#ea4335">糟糕:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在import中导入多个库</span></span><br><span class="line"><span class="keyword">import</span> sys, os</span><br></pre></td></tr></table></figure></p>
<h2 id="Whitespace-in-Expressions-and-Statements-表达式和语句中的空格"><a href="#Whitespace-in-Expressions-and-Statements-表达式和语句中的空格" class="headerlink" title="Whitespace in Expressions and Statements 表达式和语句中的空格"></a><strong>Whitespace in Expressions and Statements 表达式和语句中的空格</strong></h2><p><strong>二元运算符中的空格：</strong></p>
<p><strong><font color="#50ca14">推荐:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">i = i + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">submitted += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">x = x*<span class="number">2</span> - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">hypot2 = x*x + y*y</span><br><span class="line"></span><br><span class="line">c = (a+b) * (a-b)</span><br></pre></td></tr></table></figure></p>
<p><strong><font color="#ea4335">糟糕:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">i=i+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">submitted +=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">x = x * <span class="number">2</span> - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">hypot2 = x * x + y * y</span><br><span class="line"></span><br><span class="line">c = (a + b) * (a - b)</span><br></pre></td></tr></table></figure></p>
<p><strong>关键字参数或者默认参数值：</strong></p>
<p><strong><font color="#50ca14">推荐:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">complex</span><span class="params">(real, imag=<span class="number">0.0</span>)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> magic(r=real, i=imag)</span><br></pre></td></tr></table></figure></p>
<p><strong><font color="#ea4335">糟糕:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">complex</span><span class="params">(real, imag = <span class="number">0.0</span>)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> magic(r = real, i = imag)</span><br></pre></td></tr></table></figure></p>
<h2 id="Comments-注释"><a href="#Comments-注释" class="headerlink" title="Comments 注释"></a><strong>Comments 注释</strong></h2><p>当更新代码时，一定要记得同步更新注释，否则使阅读的人会陷入更糟糕的近况。</p>
<h4 id="Documentation-Strings-文档字符串"><a href="#Documentation-Strings-文档字符串" class="headerlink" title="Documentation Strings 文档字符串"></a><strong>Documentation Strings 文档字符串</strong></h4><p><strong><font color="#50ca14">推荐:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""Return a foobang</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Optional plotz says to frobnicate the bizbaz first.</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure></p>
<h4 id="Function-Annotation-函数或方法注释"><a href="#Function-Annotation-函数或方法注释" class="headerlink" title="Function Annotation 函数或方法注释"></a><strong>Function Annotation 函数或方法注释</strong></h4><p>大家在写函数或者方法时，往往会漏掉当前方法或函数的作用，其实这个还是很重要的，这样往往不需要阅读你的逻辑就可以知道你准备干什么</p>
<p><strong><font color="#50ca14">推荐:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">def oa_notice_template(project, api, account, cpu, mem):</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    压测申请模板</span><br><span class="line">    :param project: 项目名称</span><br><span class="line">    :param api: 接口名称</span><br><span class="line">    :param account: 申请人</span><br><span class="line">    :param cpu: cpu核数</span><br><span class="line">    :param mem: 内存大小</span><br><span class="line">    :<span class="keyword">return</span>:</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure></p>
<h4 id="Other-Recommendations-其他建议"><a href="#Other-Recommendations-其他建议" class="headerlink" title="Other Recommendations 其他建议"></a><strong>Other Recommendations 其他建议</strong></h4><p>在编写代码时，阅读者追寻编写人时往往很困难，或者此文件具体是做什么的。这个时候我们稍微添加一些个人信息注释就很好做到追源了。</p>
<p><strong><font color="#50ca14">推荐:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">@Description: 接口测试上传</span></span><br><span class="line"><span class="string">@Author  : duanfei</span></span><br><span class="line"><span class="string">@Time    : 2020/5/9 11:51 下午</span></span><br><span class="line"><span class="string">@Site    :</span></span><br><span class="line"><span class="string">@File    : http_test.py</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<h2 id="Naming-Conventions-命名规范"><a href="#Naming-Conventions-命名规范" class="headerlink" title="Naming Conventions 命名规范"></a><strong>Naming Conventions 命名规范</strong></h2><p>命名规范很重要，很多时候你的命名能够大致的解释了变量、函数、类是用来做什么的。所以在命名的时候一定要选择贴近的词义，让阅读者可以理解</p>
<h4 id="Package-and-Module-Names-包名和模块名"><a href="#Package-and-Module-Names-包名和模块名" class="headerlink" title="Package and Module Names 包名和模块名"></a><strong>Package and Module Names 包名和模块名</strong></h4><p>模块应该用简短全小写的名字，如果为了提升可读性，下划线也是可以用的。Python包名也应该使用简短全小写的名字，但不建议用下划线。</p>
<h4 id="Class-Names-类名"><a href="#Class-Names-类名" class="headerlink" title="Class Names 类名"></a><strong>Class Names 类名</strong></h4><p>类名一般使用单词首字母大写的约定</p>
<p><strong><font color="#50ca14">推荐:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CheckFunc</span>:</span>...</span><br></pre></td></tr></table></figure></p>
<p><strong><font color="#ea4335">糟糕:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首字符需大写，同时类名中无需带下划线</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">check_func</span>:</span>...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 全部大写，同时类名中无需带下划线</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CHECK_FUNC</span>:</span>...</span><br></pre></td></tr></table></figure></p>
<h4 id="Function-Names-函数名"><a href="#Function-Names-函数名" class="headerlink" title="Function Names 函数名"></a><strong>Function Names 函数名</strong></h4><p>函数名应该小写，如果想提高可读性可以用下划线分隔。</p>
<p><strong><font color="#50ca14">推荐:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_func</span><span class="params">()</span>:</span>...</span><br></pre></td></tr></table></figure></p>
<h4 id="Variable-Names-变量名"><a href="#Variable-Names-变量名" class="headerlink" title="Variable Names 变量名"></a><strong>Variable Names 变量名</strong></h4><p>一定要靠近变量的意思，不要使用一些意义不明的参数，如：i，j，k，特别注意永远不要使用字母‘l’（小写的L），‘O’（大写的O），或者‘I’（大写的I）作为单字符变量名。</p>
<p><strong><font color="#ea4335">糟糕:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">l = []</span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">xxx = [<span class="keyword">for</span> i <span class="keyword">in</span> xx]</span><br></pre></td></tr></table></figure></p>
<h4 id="Constants-常量"><a href="#Constants-常量" class="headerlink" title="Constants 常量"></a><strong>Constants 常量</strong></h4><p>常量一般默认全部为大写, 同时一定要表明好注释</p>
<p><strong><font color="#50ca14">推荐:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TOTAL = <span class="number">10</span>  <span class="comment"># 订单总页数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最大溢出量</span></span><br><span class="line">MAX_OVERFLOW = <span class="number">1000</span></span><br></pre></td></tr></table></figure></p>
<h4 id="Exception-Names-异常名"><a href="#Exception-Names-异常名" class="headerlink" title="Exception Names 异常名"></a><strong>Exception Names 异常名</strong></h4><p>因为异常一般都是类，所有类的命名方法在这里也适用。</p>
<p><strong><font color="#50ca14">推荐:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ErrorInvalidArgument</span><span class="params">(ApiError)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    参数缺失或错误</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    code = <span class="number">401001</span></span><br><span class="line">    code_name = <span class="string">'Invalid_Argument'</span></span><br><span class="line">    message = <span class="string">'invalid argument.'</span></span><br><span class="line">    zh_message = <span class="string">'参数缺失或错误'</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Programming-Recommendations-编程建议"><a href="#Programming-Recommendations-编程建议" class="headerlink" title="Programming Recommendations 编程建议"></a><strong>Programming Recommendations 编程建议</strong></h2><p><strong>关于异常处理：</strong></p>
<p><strong><font color="#50ca14">推荐:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    value = collection[key]</span><br><span class="line"><span class="keyword">except</span> KeyError:</span><br><span class="line">    <span class="keyword">return</span> key_not_found(key)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">return</span> handle_value(value)</span><br></pre></td></tr></table></figure></p>
<p><strong><font color="#ea4335">糟糕:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">return</span> handle_value(collection[key])</span><br><span class="line"><span class="keyword">except</span> KeyError:</span><br><span class="line">    <span class="keyword">return</span> key_not_found(key)</span><br></pre></td></tr></table></figure></p>
<p><strong>关于返回结果处理：</strong></p>
<p>不管在任何时候返回结果都需要保持一致。</p>
<p><strong><font color="#50ca14">推荐:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> x &gt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> math.sqrt(x)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> x &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> math.sqrt(x)</span><br></pre></td></tr></table></figure></p>
<p><strong><font color="#ea4335">糟糕:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> x &gt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> math.sqrt(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> x &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">return</span> math.sqrt(x)</span><br></pre></td></tr></table></figure></p>
<p><strong>关于True、Fakse的判断：</strong></p>
<p>不要用 == 去和True或者False比较</p>
<p><strong><font color="#50ca14">推荐:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> greeting:</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p><strong><font color="#ea4335">糟糕:</font></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> greeting == <span class="literal">True</span>:</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> greeting <span class="keyword">is</span> <span class="literal">True</span>:</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h4><ul>
<li>PEP8 规范链接： <a href="https://pep8.org/" target="_blank" rel="noopener">官方链接</a>、<a href="https://www.cnblogs.com/bymo/p/9567140.html" target="_blank" rel="noopener">中文翻译</a></li>
</ul>
<p>==================================================<br>规范—新手村（孙晓飞）</p>
<h3 id="一-基本常识"><a href="#一-基本常识" class="headerlink" title="一. 基本常识"></a>一. 基本常识</h3><ol>
<li><p>相信现代编译器的bug是很难遇到的<br>也就是说，当你的程序出现bug的时候，最后去怀疑编译器和系统（windows除外）</p>
</li>
<li><p>mr要有意义<br>最大也是最重要的原因是——在采用squash合入master的时候，mr的title会作为这次merge的commit信息，没有意义的mr==没有意义的commit。那么，为什么commit要有意义呢……去面壁吧，不说这个问题了……</p>
</li>
<li><p>不明白的代码，不要乱用！<br>不明白的代码，不要乱用！ 不明白的代码，不要乱用！ OK我说了三遍了</p>
</li>
<li><p>不要有过多输出<br>尤其是你开发的是一个包会被别人调用的情况下，因为别人连关都关不掉</p>
</li>
<li><p>没有经过profile过的程序做瓶颈优化都是耍流氓<br>profile的方法参见：（假装有东西，等写完放过来）</p>
</li>
<li><p>万恶之源</p>
</li>
</ol>
<p>有的人说重复代码是万恶之源，有的人说过早的重构（或优化）是万恶之源 这两种说法虽然是矛盾的，但是都说出了部分的真相——我个人的偏好是：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 存在重复代码 &#123;</span><br><span class="line">    <span class="keyword">if</span> 不需要使用interface(go和java里的interface，python里的抽象类，c++里的模板)就可以解决&#123;</span><br><span class="line">        do 干他！</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> 处于项目早期 &#123;</span><br><span class="line">            项目优先</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            do 干他！</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    print(“大侠再见”)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol start="7">
<li><p>尊重IDE<br>最重要的是尊重编译器的warning</p>
</li>
<li><p>代码不要给其他人造成心智负担<br>包括但不仅限于：</p>
</li>
</ol>
<p>merge后的分支需要删除，无论本地还是远端，都要删除<br>不要用注释代码的方式保留老代码；注释要有意义<br>使用正确的变量名<br>（Python）使用variable annotation</p>
<ol start="9">
<li><p>减少中文的使用<br>包括但不仅限于，中文文档、CSDN、百度搜索等等</p>
</li>
<li><p>PyCharm 的doc string采用google style</p>
</li>
<li>减少语言原生http request的使用，改用成熟的包<br>我们后面会有越来越多的调用其他service的情况，请使用更加成熟更加上层的包（例如go的gorequests、resty或者python的requests），尽量减少原生http包的使用</li>
</ol>
<p>原因包括但不仅限于：</p>
<ul>
<li>原生的http包是为了底层应用的，而我们是上层应用，不需要那么底层，就好像我们的web service不会手动从底层写一样</li>
<li>更加方便，许多的设置更加人性</li>
<li>不需要处理字符转义、文件读写等各种细节问题</li>
</ul>
<ol start="12">
<li>长时间离开工位请关闭屏幕<br>尤其是每天走之前，请记得对自己的电脑锁屏，避免不必要的麻烦</li>
</ol>
<p>不然的话会在群里看到自己要请大家喝奶茶的消息 :)</p>
<ol start="13">
<li>程序是很少骗人的，如果出现了本地和远端或者服务器和docker运行结果不一致的情况，请先保证【环境一致】<h3 id="二-学会提问"><a href="#二-学会提问" class="headerlink" title="二. 学会提问"></a>二. 学会提问</h3>将这一点单独拿出来讲是因为它很重要！！！！</li>
</ol>
<ul>
<li>问别人错误之前，先看错误提示，如果根据错误提示能找到的答案，不要问</li>
<li>google是个好东西，很多error可以搜索得到</li>
<li>优先使用英文文档</li>
</ul>
<h3 id="三-强制使用"><a href="#三-强制使用" class="headerlink" title="三. 强制使用"></a>三. 强制使用</h3><p>termius （windows用户强制，会折腾microsoft terminal的请忽略我）<br>source tree （mac和windows）ShannonWIKI<br>PyCharm的save action插件，在save的时候选择reformat以及optimize<br>GoLand的File Watchers里启用go fmt<br>每个项目都要要设置line seperator为Unix模式，也就是使用\n。windows用户要尤其注意。<br>除非你厉害，否则不要用vim或者emacs，人类发明很多工具是有理由的</p>
<h3 id="四-严格禁止"><a href="#四-严格禁止" class="headerlink" title="四. 严格禁止"></a>四. 严格禁止</h3><p>使用IDE做VCS<br>绝对路径，之前提过了</p>
<h3 id="五-一些代码规范"><a href="#五-一些代码规范" class="headerlink" title="五. 一些代码规范"></a>五. 一些代码规范</h3><ol>
<li>关于文件路径<br>规定一下：</li>
</ol>
<p>除了config文件，项目中绝对不准使用绝对路径！！！！！！！<br>在任何地方，都不允许使用linux的相对路径，也就是”../“这种形式<br>解释一下正确做法：</p>
<p>项目中，数据分为两种：一种是不需要外部传入的数据，这类数据的路径一定是相对于项目根目录的路径的，具体做法是用Python的函数获取项目的路径，然后其他素有路径都是相对于这个录几个的；另一种是外部挂载的数据，一般是是大数据或者敏感数据，这类是将路径写在config中，然后将config忽略来做到的</p>
<p>不允许绝对路径，不允许赤裸裸的相对路径！！！！！！！！！！！！！！！</p>
<ol start="2">
<li>参数过多时</li>
</ol>
<p>python代码，如果参数过多需要换行，建议采用这种形式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function(</span><br><span class="line">    para_1,</span><br><span class="line">    para_2,</span><br><span class="line">    …</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>而不是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function(para_1,</span><br><span class="line">         para_2,</span><br><span class="line">         …)</span><br></pre></td></tr></table></figure></p>
<p>更不能：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function(para_1,</span><br><span class="line">         para_2</span><br><span class="line">         )</span><br></pre></td></tr></table></figure></p>
<ol start="3">
<li><p>不要乱用字典<br>各位，很严肃的提醒，字典（python里的dict，go、C++、java里的map）这种数据结构，适用于存储key-value结构，而且是key不定的情况，如果key是确定的，最好声明一个类来存储，否则代码维护性极差，我们之前已经吃过亏了，不要再吃亏了。因此，以后如果key是确定的情况，严禁使用字典作为传参手段，尤其是python，不要把编程语言的字典当成json来用。</p>
</li>
<li><p>git的开发规范 </p>
</li>
</ol>
<p>从master上，新建分支，然后做修改，commit，push，远端merge后，checkout到master，然后拉取远端，然后进入下一轮开发。严禁在master上做修改，然后checkout到新分支，然后提交！！！！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/python/python基础/20190306_python虚拟环境/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="崔永华的个人网站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/python/python基础/20190306_python虚拟环境/" itemprop="url">
                  python虚拟环境
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-06T15:24:20+08:00">
                2019-03-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>source activate conda_venv<br>conda activate conda_venv</p>
<p>source deactivate</p>
<h4 id="conda虚拟环境"><a href="#conda虚拟环境" class="headerlink" title="conda虚拟环境"></a>conda虚拟环境</h4><p>1、首先在所在系统中安装Anaconda。可以打开命令行输入conda -V检验是否安装以及当前conda的版本。</p>
<p>2、conda常用的命令。</p>
<pre><code>1）conda list 查看安装了哪些包。

2）conda env list 或 conda info -e 查看当前存在哪些虚拟环境

3）conda update conda 检查更新当前conda
</code></pre><p>3、创建python虚拟环境。</p>
<pre><code>使用 conda create -n your_env_name python=X.X（2.7、3.6等)命令创建python版本为X.X、名字为your_env_name的虚拟环境。your_env_name文件可以在Anaconda安装目录envs文件下找到。
</code></pre><p>4、使用激活(或切换不同python版本)的虚拟环境。</p>
<pre><code>打开命令行输入python --version可以检查当前python的版本。

使用如下命令即可 激活你的虚拟环境(即将python的版本改变)。

Linux:  source activate your_env_name(虚拟环境名称)

Windows: activate your_env_name(虚拟环境名称)
</code></pre><p>   这是再使用python –version可以检查当前python版本是否为想要的。</p>
<p>5、对虚拟环境中安装额外的包。</p>
<pre><code>使用命令conda install -n your_env_name [package]即可安装package到your_env_name中
</code></pre><p>6、关闭虚拟环境(即从当前环境退出返回使用PATH环境中的默认python版本)。</p>
<p>   使用如下命令即可。</p>
<p>   Linux: source deactivate</p>
<p>   Windows: deactivate</p>
<p>7、删除虚拟环境。</p>
<p>   使用命令conda remove -n your_env_name(虚拟环境名称) –all， 即可删除。</p>
<p>8、删除环境中的某个包。</p>
<p>   使用命令conda remove –name your_env_name  package_name 即可。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/python/python基础/20190305_图形界面/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="崔永华的个人网站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/python/python基础/20190305_图形界面/" itemprop="url">
                  python图形界面
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-05T15:24:20+08:00">
                2019-03-05
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h5 id="1-用python画出玫瑰图案"><a href="#1-用python画出玫瑰图案" class="headerlink" title="1. 用python画出玫瑰图案"></a>1. 用python画出玫瑰图案</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle <span class="keyword">as</span> t</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个曲线绘制函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DegreeCurve</span><span class="params">(n, r, d=<span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        t.left(d)</span><br><span class="line">        t.circle(r, abs(d))</span><br><span class="line"><span class="comment"># 初始位置设定</span></span><br><span class="line">s = <span class="number">0.2</span> <span class="comment"># size</span></span><br><span class="line">t.setup(<span class="number">450</span>*<span class="number">5</span>*s, <span class="number">750</span>*<span class="number">5</span>*s)</span><br><span class="line">t.pencolor(<span class="string">"black"</span>)</span><br><span class="line">t.fillcolor(<span class="string">"red"</span>)</span><br><span class="line">t.speed(<span class="number">100</span>)</span><br><span class="line">t.penup()</span><br><span class="line">t.goto(<span class="number">0</span>, <span class="number">900</span>*s)</span><br><span class="line">t.pendown()</span><br><span class="line"><span class="comment"># 绘制花朵形状</span></span><br><span class="line">t.begin_fill()</span><br><span class="line">t.circle(<span class="number">200</span>*s,<span class="number">30</span>)</span><br><span class="line">DegreeCurve(<span class="number">60</span>, <span class="number">50</span>*s)</span><br><span class="line">t.circle(<span class="number">200</span>*s,<span class="number">30</span>)</span><br><span class="line">DegreeCurve(<span class="number">4</span>, <span class="number">100</span>*s)</span><br><span class="line">t.circle(<span class="number">200</span>*s,<span class="number">50</span>)</span><br><span class="line">DegreeCurve(<span class="number">50</span>, <span class="number">50</span>*s)</span><br><span class="line">t.circle(<span class="number">350</span>*s,<span class="number">65</span>)</span><br><span class="line">DegreeCurve(<span class="number">40</span>, <span class="number">70</span>*s)</span><br><span class="line">t.circle(<span class="number">150</span>*s,<span class="number">50</span>)</span><br><span class="line">DegreeCurve(<span class="number">20</span>, <span class="number">50</span>*s, <span class="number">-1</span>)</span><br><span class="line">t.circle(<span class="number">400</span>*s,<span class="number">60</span>)</span><br><span class="line">DegreeCurve(<span class="number">18</span>, <span class="number">50</span>*s)</span><br><span class="line">t.fd(<span class="number">250</span>*s)</span><br><span class="line">t.right(<span class="number">150</span>)</span><br><span class="line">t.circle(<span class="number">-500</span>*s,<span class="number">12</span>)</span><br><span class="line">t.left(<span class="number">140</span>)</span><br><span class="line">t.circle(<span class="number">550</span>*s,<span class="number">110</span>)</span><br><span class="line">t.left(<span class="number">27</span>)</span><br><span class="line">t.circle(<span class="number">650</span>*s,<span class="number">100</span>)</span><br><span class="line">t.left(<span class="number">130</span>)</span><br><span class="line">t.circle(<span class="number">-300</span>*s,<span class="number">20</span>)</span><br><span class="line">t.right(<span class="number">123</span>)</span><br><span class="line">t.circle(<span class="number">220</span>*s,<span class="number">57</span>)</span><br><span class="line">t.end_fill()</span><br><span class="line"><span class="comment"># 绘制花枝形状</span></span><br><span class="line">t.left(<span class="number">120</span>)</span><br><span class="line">t.fd(<span class="number">280</span>*s)</span><br><span class="line">t.left(<span class="number">115</span>)</span><br><span class="line">t.circle(<span class="number">300</span>*s,<span class="number">33</span>)</span><br><span class="line">t.left(<span class="number">180</span>)</span><br><span class="line">t.circle(<span class="number">-300</span>*s,<span class="number">33</span>)</span><br><span class="line">DegreeCurve(<span class="number">70</span>, <span class="number">225</span>*s, <span class="number">-1</span>)</span><br><span class="line">t.circle(<span class="number">350</span>*s,<span class="number">104</span>)</span><br><span class="line">t.left(<span class="number">90</span>)</span><br><span class="line">t.circle(<span class="number">200</span>*s,<span class="number">105</span>)</span><br><span class="line">t.circle(<span class="number">-500</span>*s,<span class="number">63</span>)</span><br><span class="line">t.penup()</span><br><span class="line">t.goto(<span class="number">170</span>*s,<span class="number">-30</span>*s)</span><br><span class="line">t.pendown()</span><br><span class="line">t.left(<span class="number">160</span>)</span><br><span class="line">DegreeCurve(<span class="number">20</span>, <span class="number">2500</span>*s)</span><br><span class="line">DegreeCurve(<span class="number">220</span>, <span class="number">250</span>*s, <span class="number">-1</span>)</span><br><span class="line"><span class="comment"># 绘制一个绿色叶子</span></span><br><span class="line">t.fillcolor(<span class="string">'green'</span>)</span><br><span class="line">t.penup()</span><br><span class="line">t.goto(<span class="number">670</span>*s,<span class="number">-180</span>*s)</span><br><span class="line">t.pendown()</span><br><span class="line">t.right(<span class="number">140</span>)</span><br><span class="line">t.begin_fill()</span><br><span class="line">t.circle(<span class="number">300</span>*s,<span class="number">120</span>)</span><br><span class="line">t.left(<span class="number">60</span>)</span><br><span class="line">t.circle(<span class="number">300</span>*s,<span class="number">120</span>)</span><br><span class="line">t.end_fill()</span><br><span class="line">t.penup()</span><br><span class="line">t.goto(<span class="number">180</span>*s,<span class="number">-550</span>*s)</span><br><span class="line">t.pendown()</span><br><span class="line">t.right(<span class="number">85</span>)</span><br><span class="line">t.circle(<span class="number">600</span>*s,<span class="number">40</span>)</span><br><span class="line"><span class="comment"># 绘制另一个绿色叶子</span></span><br><span class="line">t.penup()</span><br><span class="line">t.goto(<span class="number">-150</span>*s,<span class="number">-1000</span>*s)</span><br><span class="line">t.pendown()</span><br><span class="line">t.begin_fill()</span><br><span class="line">t.rt(<span class="number">120</span>)</span><br><span class="line">t.circle(<span class="number">300</span>*s,<span class="number">115</span>)</span><br><span class="line">t.left(<span class="number">75</span>)</span><br><span class="line">t.circle(<span class="number">300</span>*s,<span class="number">100</span>)</span><br><span class="line">t.end_fill()</span><br><span class="line">t.penup()</span><br><span class="line">t.goto(<span class="number">430</span>*s,<span class="number">-1070</span>*s)</span><br><span class="line">t.pendown()</span><br><span class="line">t.right(<span class="number">30</span>)</span><br><span class="line">t.circle(<span class="number">-600</span>*s,<span class="number">35</span>)</span><br><span class="line">t.done()</span><br></pre></td></tr></table></figure>
<h5 id="2-用Python画出奥运五环图"><a href="#2-用Python画出奥运五环图" class="headerlink" title="2. 用Python画出奥运五环图"></a>2. 用Python画出奥运五环图</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle</span><br><span class="line">turtle.width(<span class="number">10</span>)</span><br><span class="line">turtle.color(<span class="string">"blue"</span>)</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">turtle.color(<span class="string">"black"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">120</span>, <span class="number">0</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">turtle.color(<span class="string">"red"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">240</span>, <span class="number">0</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">turtle.color(<span class="string">"yellow"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">60</span>, <span class="number">-50</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">turtle.color(<span class="string">"green"</span>)</span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.goto(<span class="number">180</span>, <span class="number">-50</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.circle(<span class="number">50</span>)</span><br></pre></td></tr></table></figure>
<h5 id="3-绘制多个同心圆"><a href="#3-绘制多个同心圆" class="headerlink" title="3. 绘制多个同心圆"></a>3. 绘制多个同心圆</h5><p><strong>代码如下</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle</span><br><span class="line"></span><br><span class="line">t = turtle.Pen()</span><br><span class="line">my_colors = (<span class="string">"red"</span>, <span class="string">"green"</span>, <span class="string">"yellow"</span>, <span class="string">"black"</span>)</span><br><span class="line">t.width(<span class="number">4</span>)</span><br><span class="line">t.speed(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):  <span class="comment"># 0 1 2 3 4</span></span><br><span class="line">    t.penup()</span><br><span class="line">    t.goto(<span class="number">0</span>, -i*<span class="number">10</span>)  <span class="comment"># 0, -100,-200,-300,-400</span></span><br><span class="line">    t.pendown()</span><br><span class="line">    t.color(my_colors[i%len(my_colors)])</span><br><span class="line">    t.circle(<span class="number">15</span>+i*<span class="number">10</span>)  <span class="comment"># 100,200,300, 400,, 500</span></span><br><span class="line">turtle.done()  <span class="comment"># 程序执行完，窗口仍然在</span></span><br></pre></td></tr></table></figure>
<p>执行结果如下图：<br><img src="https://img-blog.csdnimg.cn/20190717134956991.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2N1aV95b25naHVh,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h5 id="4-用Python-绘制-18-18-棋盘"><a href="#4-用Python-绘制-18-18-棋盘" class="headerlink" title="4. 用Python 绘制 18*18 棋盘"></a>4. 用Python 绘制 18*18 棋盘</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle</span><br><span class="line">width = <span class="number">30</span></span><br><span class="line">num = <span class="number">18</span></span><br><span class="line">x1 = [(<span class="number">-400</span>, <span class="number">400</span>), (<span class="number">-400</span>+width*num, <span class="number">400</span>)]</span><br><span class="line">y1 = [(<span class="number">-400</span>, <span class="number">400</span>), (<span class="number">-400</span>, <span class="number">400</span>-width*num)]</span><br><span class="line">t = turtle.Pen()</span><br><span class="line">t.speed(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">19</span>):</span><br><span class="line">    t.penup()</span><br><span class="line">    t.goto(x1[<span class="number">0</span>][<span class="number">0</span>], x1[<span class="number">0</span>][<span class="number">1</span>]<span class="number">-30</span>*i)</span><br><span class="line">    t.pendown()</span><br><span class="line">    t.goto(x1[<span class="number">1</span>][<span class="number">0</span>], x1[<span class="number">1</span>][<span class="number">1</span>]<span class="number">-30</span>*i)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">19</span>):</span><br><span class="line">    t.penup()</span><br><span class="line">    t.goto(y1[<span class="number">0</span>][<span class="number">0</span>]+<span class="number">30</span>*i,y1[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line">    t.pendown()</span><br><span class="line">    t.goto(y1[<span class="number">1</span>][<span class="number">0</span>]+<span class="number">30</span>*i,y1[<span class="number">1</span>][<span class="number">1</span>])</span><br><span class="line">t.hideturtle()  <span class="comment"># 隐藏画笔</span></span><br><span class="line">turtle.done()  <span class="comment"># 保证运行窗口不被自动关闭</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/python/python基础/20190304_操作excel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="崔永华的个人网站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/python/python基础/20190304_操作excel/" itemprop="url">
                  python操作excel
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-04T15:24:20+08:00">
                2019-03-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>excel格式:<a href="https://www.cnblogs.com/fkissx/p/5617630.html" target="_blank" rel="noopener">https://www.cnblogs.com/fkissx/p/5617630.html</a></p>
<h4 id="1-类库xlwt-xlrd"><a href="#1-类库xlwt-xlrd" class="headerlink" title="1. 类库xlwt/xlrd"></a>1. 类库xlwt/xlrd</h4><ul>
<li>用于生成和读取比较老的excel文件，比如xls格式，最大限制为65535行；</li>
<li>文档地址：<a href="https://xlwt.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener">https://xlwt.readthedocs.io/en/latest/index.html</a></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">columns = [<span class="string">'日期'</span>, <span class="string">'PV'</span>, <span class="string">'UV'</span>, <span class="string">'name'</span>]</span><br><span class="line">datas = [</span><br><span class="line">    [<span class="string">'2019-07-15'</span>, <span class="string">'16000'</span>, <span class="string">'150'</span>, <span class="string">'Andy'</span>],</span><br><span class="line">    [<span class="string">'2020-02-15'</span>, <span class="string">'9000'</span>, <span class="string">'70'</span>, <span class="string">'李'</span>],</span><br><span class="line">    [<span class="string">'2015-07-15'</span>, <span class="string">'6000'</span>, <span class="string">'50'</span>, <span class="string">'张'</span>],</span><br><span class="line">    [<span class="string">'2020-01-15'</span>, <span class="string">'12000'</span>, <span class="string">'80'</span>, <span class="string">'刘'</span>],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> xlwt</span><br><span class="line">workbook = xlwt.Workbook(encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">sheet = workbook.add_sheet(<span class="string">'puvn_sheet'</span>)</span><br><span class="line"><span class="comment"># 写入标题</span></span><br><span class="line"><span class="keyword">for</span> col, columns <span class="keyword">in</span> enumerate(columns):</span><br><span class="line">    sheet.write(<span class="number">0</span>, col, columns)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入每一行</span></span><br><span class="line"><span class="keyword">for</span> row, data <span class="keyword">in</span> enumerate(datas):</span><br><span class="line">    <span class="keyword">for</span> col, columns_data <span class="keyword">in</span> enumerate(data):</span><br><span class="line">        sheet.write(row + <span class="number">1</span>, col, columns_data)</span><br><span class="line"></span><br><span class="line">workbook.save(<span class="string">'puvn_sheet.xls'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="2-类库openpyxl"><a href="#2-类库openpyxl" class="headerlink" title="2. 类库openpyxl"></a>2. 类库openpyxl</h4><ul>
<li>用于生成2010之后新的excel文件，比如xlsx格式；</li>
<li>文档地址：<a href="https://openpyxl.readthedocs.io/en/stable/" target="_blank" rel="noopener">https://openpyxl.readthedocs.io/en/stable/</a></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">columns = [<span class="string">'日期'</span>, <span class="string">'PV'</span>, <span class="string">'UV'</span>, <span class="string">'name'</span>]</span><br><span class="line">datas = [</span><br><span class="line">    [<span class="string">'2019-07-15'</span>, <span class="string">'16000'</span>, <span class="string">'150'</span>, <span class="string">'Andy'</span>],</span><br><span class="line">    [<span class="string">'2020-02-15'</span>, <span class="string">'9000'</span>, <span class="string">'70'</span>, <span class="string">'李'</span>],</span><br><span class="line">    [<span class="string">'2015-07-15'</span>, <span class="string">'6000'</span>, <span class="string">'50'</span>, <span class="string">'张'</span>],</span><br><span class="line">    [<span class="string">'2020-01-15'</span>, <span class="string">'12000'</span>, <span class="string">'80'</span>, <span class="string">'刘'</span>],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook</span><br><span class="line">wk = Workbook()</span><br><span class="line"><span class="comment"># 默认sheet</span></span><br><span class="line">sheet = wk.active</span><br><span class="line">sheet.title = <span class="string">'默认sheet'</span></span><br><span class="line">sheet.append(columns)</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> datas:</span><br><span class="line">    sheet.append(data)</span><br><span class="line"></span><br><span class="line">wk.save(<span class="string">'openpyxl.xlsx'</span>)  <span class="comment"># xls和xlsx均可</span></span><br></pre></td></tr></table></figure>
<h4 id="3-类库pandas"><a href="#3-类库pandas" class="headerlink" title="3. 类库pandas"></a>3. 类库pandas</h4><ul>
<li>pandas是最强大的数据分析库，自带python读取和生成模块；</li>
<li>文档地址：<a href="https://pandas.pydata.org/" target="_blank" rel="noopener">https://pandas.pydata.org/</a></li>
</ul>
<p>使用的是：pandas.DataFrame.to_excel</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/python/python基础/20190303_sqlchemy的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="崔永华的个人网站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/python/python基础/20190303_sqlchemy的使用/" itemprop="url">
                  sqlalchemy的使用
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-03T15:24:20+08:00">
                2019-03-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h4 id="1-连接数据库"><a href="#1-连接数据库" class="headerlink" title="1. 连接数据库"></a>1. 连接数据库</h4><p>使用create_engine()实现连接，需要了解create_engine()各个参数的作用<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 连接数据库</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line">engine = create_engine(</span><br><span class="line">    <span class="string">"mysql+pymysql://root:1990@localhost:3306/crawl_test?charset=utf8"</span>,</span><br><span class="line">    echo=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></p>
<h4 id="2-创建数据表"><a href="#2-创建数据表" class="headerlink" title="2. 创建数据表"></a>2. 创建数据表</h4><p>定义实体映射类数据表结构，通过操作类属性从而操作数据表字段</p>
<p>创建表结构的方式<br>创建一个自增的数字主键！！！：不需要特意的设定，SQLAlchemy will automatically set the first Integer PK column that’s not marked as a FK as autoincrement=True</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建数据表方法一</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, Integer, String, DateTime</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mytable</span><span class="params">(Base)</span>:</span></span><br><span class="line">    <span class="comment"># 表名</span></span><br><span class="line">    __tablename__ = <span class="string">'mytable'</span></span><br><span class="line">    <span class="comment"># 字段，属性</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">50</span>), unique=<span class="literal">True</span>)</span><br><span class="line">    age = Column(Integer)</span><br><span class="line">    birth = Column(DateTime)</span><br><span class="line">    class_name = Column(String(<span class="number">50</span>))</span><br><span class="line"></span><br><span class="line">Base.metadata.create_all(engine)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建数据表方法二</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, MetaData, ForeignKey, Table</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.dialects.mysql <span class="keyword">import</span> (INTEGER, CHAR)</span><br><span class="line">meta = MetaData()</span><br><span class="line">myclass = Table(<span class="string">'myclass'</span>, meta,</span><br><span class="line">                Column(<span class="string">'id'</span>, INTEGER, primary_key=<span class="literal">True</span>),</span><br><span class="line">                Column(<span class="string">'name'</span>, CHAR(<span class="number">50</span>), ForeignKey(mytable.name)),</span><br><span class="line">                Column(<span class="string">'class_name'</span>, CHAR(<span class="number">50</span>))</span><br><span class="line">                )</span><br><span class="line">myclass.create(bind=engine)</span><br></pre></td></tr></table></figure>
<p>删除数据表：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除数据表</span></span><br><span class="line">StudentItem.drop(bind=engine)</span><br><span class="line">Base.metadata.drop_all(engine)</span><br></pre></td></tr></table></figure></p>
<h4 id="3-创建持久化对象"><a href="#3-创建持久化对象" class="headerlink" title="3. 创建持久化对象"></a>3. 创建持久化对象</h4><p>引入sessionmaker模块，绑定已连接数据库的engin对象，生成会话对象session</p>
<h4 id="4-添加数据"><a href="#4-添加数据" class="headerlink" title="4. 添加数据"></a>4. 添加数据</h4><p>对实体类的属性赋值，通过session.add()方法添加数据，通过session.commit()方法提交数据。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">new_data = mytable(name=<span class="string">'Li Lei'</span>,age=<span class="number">10</span>,birth=<span class="string">'2017-10-01'</span>,class_name=<span class="string">'一年级一班'</span>)</span><br><span class="line">session.add(new_data)</span><br><span class="line">session.commit()</span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure></p>
<h4 id="5-更新数据"><a href="#5-更新数据" class="headerlink" title="5. 更新数据"></a>5. 更新数据</h4><p>先查询需要修改的数据对象再更新，更新方法有修改对象属性值 和 使用update()方法更新数据。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">session.query(mytable).filter_by(id=<span class="number">1</span>).update(&#123; mytable.age : <span class="number">12</span>&#125;)</span><br><span class="line">session.commit()</span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure></p>
<h4 id="6-删除数据"><a href="#6-删除数据" class="headerlink" title="6. 删除数据"></a>6. 删除数据</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">session.query(mytable).filter_by(id=<span class="number">1</span>).delete()</span><br><span class="line">session.commit()</span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure>
<h4 id="7-查询数据"><a href="#7-查询数据" class="headerlink" title="7. 查询数据"></a>7. 查询数据</h4><p>filter_by相当于SQL语句里面的where判断;<br>join相当于SQL语句中的inner join ;<br>outerjoin相当于full outer join ;</p>
<p>1、查询myclass全部数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询myclass全部数据，相当于select * from myclass;</span></span><br><span class="line"><span class="comment"># all()是将数据以列表的形式返回</span></span><br><span class="line">get_data = session.query(myclass).all()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> get_data:</span><br><span class="line">    print(<span class="string">'我的名字是：'</span> + i.name)</span><br><span class="line">    print(<span class="string">'我的班级是：'</span> + i.class_name)</span><br><span class="line">session.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询某些字段，相当于select name, class_name from myclass;</span></span><br><span class="line">get_data = session.query(myclass.name, myclass.class_name).all()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> get_data:</span><br><span class="line">    print(<span class="string">'我的名字是：'</span> + i.name)</span><br><span class="line">    print(<span class="string">'我的班级是：'</span> + i.class_name)</span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure></p>
<p>2、设置筛选条件<br>filter和filter_by</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据条件查询某条数据</span></span><br><span class="line"><span class="comment"># 筛选方法一：</span></span><br><span class="line"><span class="comment"># get_data = session.query(myclass).filter(myclass.id==1).all()</span></span><br><span class="line"><span class="comment"># 筛选方法二：</span></span><br><span class="line">get_data = session.query(myclass).filter_by(id=<span class="number">1</span>).all()</span><br><span class="line">print(<span class="string">'数据类型是：'</span> + str(type(get_data)))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> get_data:</span><br><span class="line">    print(<span class="string">'我的名字是：'</span> + i.name)</span><br><span class="line">    print(<span class="string">'我的班级是：'</span> + i.class_name)</span><br></pre></td></tr></table></figure>
<p>把all()换成first()可以查询1条数据：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询id为1的数据</span></span><br><span class="line">single_stu = session.query(StudentItem).filter_by(stu_id=stu_id).first()</span><br></pre></td></tr></table></figure></p>
<p>3、设置多筛选条件：</p>
<p>带and的查询，如：select * from mytable where id&gt;1 and class_name=’三年级二班’，代码如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">get_data = session.query(mytable).filter(mytable.id &gt;= <span class="number">2</span>, </span><br><span class="line">             mytable.class_name == <span class="string">'三年级二班'</span>).first()</span><br><span class="line">print(<span class="string">'数据类型是：'</span> + str(type(get_data)))</span><br><span class="line">print(<span class="string">'我的名字是：'</span> + get_data.name)</span><br><span class="line">print(<span class="string">'我的班级是：'</span> + get_data.class_name)</span><br></pre></td></tr></table></figure></p>
<p>带or的查询，如：select * from mytable where id&gt;1 and class_name=’三年级二班’，代码如下:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> or_</span><br><span class="line">get_data = session.query(mytable).filter(or_(mytable.id &gt;= <span class="number">2</span>,</span><br><span class="line">                                         mytable.class_name == <span class="string">'三年级二班'</span>)).all()</span><br><span class="line">print(<span class="string">'数据类型是：'</span> + str(type(get_data)))</span><br><span class="line">print(<span class="string">'我的名字是：'</span> + get_data.name)</span><br><span class="line">print(<span class="string">'我的班级是：'</span> + get_data.class_name)</span><br></pre></td></tr></table></figure></p>
<p>涉及多表查询的内连接查询和外连接查询：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 内连接</span></span><br><span class="line">get_data = session.query(mytable).join(myclass).filter(mytable.class_name == <span class="string">'三年级二班'</span>).all()</span><br><span class="line">print(<span class="string">'数据类型是：'</span> + str(type(get_data)))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> get_data:</span><br><span class="line">    print(<span class="string">'我的名字是：'</span> + i.name)</span><br><span class="line">    print(<span class="string">'我的班级是：'</span> + i.class_name)</span><br><span class="line"><span class="comment"># 外连接</span></span><br><span class="line">get_data = session.query(mytable).outerjoin(</span><br><span class="line">             myclass).filter(mytable.class_name == <span class="string">'三年级二班'</span>).all()</span><br></pre></td></tr></table></figure></p>
<p>4、涉及复杂的查询语句，特别涉及多表查询和复杂的查询条件时，可直接执行sql语句：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sql = <span class="string">'select * from mytable '</span></span><br><span class="line">session.execute(sql)</span><br><span class="line"><span class="comment"># 如果涉及更新，添加数据，需要session.commit()</span></span><br><span class="line">session.commit()</span><br></pre></td></tr></table></figure></p>
<h4 id="8-综合案例-1"><a href="#8-综合案例-1" class="headerlink" title="8. 综合案例(1)"></a>8. 综合案例(1)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接数据库</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, Integer, String, DateTime</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"></span><br><span class="line">engine = create_engine(<span class="string">"mysql+pymysql://root:12345678@localhost:3306/my_test?charset=utf8"</span>, echo=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentItem</span><span class="params">(Base)</span>:</span></span><br><span class="line">    <span class="string">"""创建数据表方法一"""</span></span><br><span class="line">    <span class="comment"># 表名</span></span><br><span class="line">    __tablename__ = <span class="string">'my_student'</span></span><br><span class="line">    <span class="comment"># 字段，属性</span></span><br><span class="line">    stu_id = Column(Integer, primary_key=<span class="literal">True</span>, autoincrement=<span class="literal">True</span>)</span><br><span class="line">    stu_name = Column(String(<span class="number">50</span>), unique=<span class="literal">True</span>)</span><br><span class="line">    stu_age = Column(Integer)</span><br><span class="line">    stu_birth = Column(DateTime)</span><br><span class="line">    stu_class_name = Column(String(<span class="number">50</span>))</span><br></pre></td></tr></table></figure>
<p>sqlalchemy_test.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line"><span class="keyword">from</span> crawl_test.orm <span class="keyword">import</span> Base, engine, StudentItem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">get_session = sessionmaker(bind=engine)  <span class="comment"># 可设置autocommit=True  对当前session进行设置</span></span><br><span class="line">session = get_session()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_table</span><span class="params">(engine)</span>:</span></span><br><span class="line">    <span class="string">"""创建表"""</span></span><br><span class="line">    Base.metadata.create_all(engine)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_one</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""向表中添加数据"""</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        new_data = StudentItem(stu_name=<span class="string">'王五'</span>, stu_age=<span class="number">30</span>, stu_birth=<span class="string">'2005-06-09'</span>, stu_class_name=<span class="string">'六年级4班'</span>)</span><br><span class="line">        session.add(new_data)</span><br><span class="line">        session.commit()</span><br><span class="line">        print(<span class="string">'向表中添加单条数据成功'</span>)</span><br><span class="line">        session.close()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        session.rollback()</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">f'向数据库添加数据失败 ：<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">query_one</span><span class="params">(stu_id=None, stu_name=None)</span>:</span></span><br><span class="line">    <span class="string">"""根据id或者名字查询,返回字典"""</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> stu_id:</span><br><span class="line">            single_stu = session.query(StudentItem).filter_by(stu_id=stu_id).first()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            single_stu = session.query(StudentItem).filter_by(stu_name=stu_name).first()</span><br><span class="line">        single_stu_dict = single_stu.__dict__</span><br><span class="line">        <span class="keyword">return</span> single_stu_dict</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        session.rollback()</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">f'数据库查询失败 ：<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        session.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">query_all</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""查询所有数据，返回一个列表"""</span></span><br><span class="line">    stu_data_list = []</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        stu_data = session.query(StudentItem).all()</span><br><span class="line">        <span class="comment"># 遍历对象的列表，并转换成字典</span></span><br><span class="line">        <span class="keyword">for</span> stu <span class="keyword">in</span> stu_data:</span><br><span class="line">            stu_dict = stu.__dict__</span><br><span class="line">            stu_data_list.append(stu_dict)</span><br><span class="line">        <span class="keyword">return</span> stu_data_list</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        session.rollback()</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">f'数据库查询失败 ：<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        session.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_stu_data</span><span class="params">(stu_id=None, stu_name=None, stu_data_dict=None)</span>:</span></span><br><span class="line">    <span class="string">"""根据id或者名字来修改数据"""</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> stu_id:</span><br><span class="line">            result = session.query(StudentItem).filter_by(stu_id=stu_id).update(stu_data_dict)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result = session.query(StudentItem).filter_by(stu_name=stu_name).update(stu_data_dict)</span><br><span class="line">        print(<span class="string">'修改成功'</span>, result)</span><br><span class="line">        session.commit()</span><br><span class="line">        session.close()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        session.rollback()</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">f'修改数据失败 ：<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_stu_data</span><span class="params">(stu_id=None, stu_name=None)</span>:</span></span><br><span class="line">    <span class="string">"""删除一个数据"""</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> stu_id:</span><br><span class="line">            ret = session.query(StudentItem).filter(StudentItem.stu_id == stu_id).delete()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ret = session.query(StudentItem).filter(StudentItem.stu_name == stu_name).delete()</span><br><span class="line">        print(<span class="string">'删除成功'</span>, ret)</span><br><span class="line">        session.commit()</span><br><span class="line">        session.close()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        session.rollback()</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">f'删除数据失败 ：<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># create_table(engine)</span></span><br><span class="line">    <span class="comment"># 增加一个数据</span></span><br><span class="line">    <span class="comment"># add_one()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询：根据id或者姓名查询单个数据</span></span><br><span class="line">    stu_data = query_one(stu_id=<span class="number">6</span>)</span><br><span class="line">    print(stu_data[<span class="string">'stu_name'</span>])</span><br><span class="line">    <span class="comment"># 查询：所有数据</span></span><br><span class="line">    <span class="comment"># stu_data_list = query_all()</span></span><br><span class="line">    <span class="comment"># for stu_data in stu_data_list:</span></span><br><span class="line">    <span class="comment">#     print(stu_data)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 更新数据</span></span><br><span class="line">    <span class="comment"># data_dict = &#123;</span></span><br><span class="line">    <span class="comment">#     StudentItem.stu_age: 42,</span></span><br><span class="line">    <span class="comment">#     StudentItem.stu_name: '张君宝'</span></span><br><span class="line">    <span class="comment"># &#125;</span></span><br><span class="line">    <span class="comment"># update_stu_data(stu_name='张无忌', stu_data_dict=data_dict)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 删除数据</span></span><br><span class="line">    <span class="comment"># delete_stu_data(stu_id=3)</span></span><br></pre></td></tr></table></figure></p>
<h4 id="9-综合案例（2）"><a href="#9-综合案例（2）" class="headerlink" title="9. 综合案例（2）"></a>9. 综合案例（2）</h4><p>1、创建一个schema:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Base = declarative_base() <span class="comment">#生成orm基类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AlchemyTest</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'tbSqlAlchemyTest'</span> <span class="comment">#这里不用加上dbo.前缀，默认已经有了</span></span><br><span class="line"></span><br><span class="line">    TestName = Column(String(<span class="number">256</span>), primary_key=<span class="literal">True</span>)</span><br><span class="line">    TestNumber = Column(INTEGER)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#the table object is a member of a larger collection known as MetaData</span></span><br><span class="line">Base.metadata.create_all(engine) <span class="comment">#通过基类与数据库进行交互创建表结构，此时表内还没有数据</span></span><br></pre></td></tr></table></figure></p>
<p>还可以在创建class的末尾加上类似于：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;User(name='%s', fullname='%s', password='%s')&gt;"</span> % (</span><br><span class="line">                                self.name, self.fullname, self.password)</span><br></pre></td></tr></table></figure></p>
<p>这个为可选项，只是增加对于表的描述，便于以后测试</p>
<p>向表内加入数据：<br>先创建一个实例：<code>test1 = AlchemyTest(TestName=&#39;user1&#39;, TestNumber=1995)</code></p>
<p>再创建一个会话：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line"></span><br><span class="line">Session_class = sessionmaker(bind=engine) <span class="comment">#建立与数据库的会话连接，这里建立的是一个class不是一个实例对象</span></span><br><span class="line">session = Session_class() <span class="comment">#这里创建一个会话实例</span></span><br><span class="line">test1 = AlchemyTest(TestName=<span class="string">'user1'</span>, TestNumber=<span class="number">1995</span>)</span><br><span class="line">session.add(test1) <span class="comment">#把要创建的数据对象加入到这个会话中，这个时候是pending状态，添加多个对象使用add_all()</span></span><br><span class="line">session.commit() <span class="comment">#统一提交会话中的操作</span></span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure></p>
<p>在提交这个会话之前就可以使用：<code>our_user = session.query(User).filter_by(name=&#39;ed&#39;).first()</code> 来查看刚刚创建的数据<br>在会话提交之前，还可以这样回滚这个会话，使之前flush的内容失效： <code>session.rollback()</code><br>每个session会话才是真正的与数据库的连接</p>
<p>2、建立表与表之间的关系（一对多，多对一）：</p>
<p>多对一：employee对于department是多对一的关系<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Department</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'department'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">30</span>))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'employee'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">30</span>))</span><br><span class="line">    dep_id = Column(Integer, ForeignKey(<span class="string">'department.id'</span>))</span><br><span class="line">    department = relationship(<span class="string">"Department"</span>)</span><br></pre></td></tr></table></figure></p>
<p>一对多：department对于employee是一对多的关系<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Department</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'department'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">30</span>))</span><br><span class="line">    employees = relationship(<span class="string">"Employee"</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'employee'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">30</span>))</span><br><span class="line">    dep_id = Column(Integer, ForeignKey(<span class="string">'department.id'</span>))</span><br></pre></td></tr></table></figure></p>
<p><strong>新建一个tbSqlAlchemyTestError的table</strong> 一个test可以有多个error<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AlchemyTestError</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'tbSqlAlchemyTestError'</span></span><br><span class="line"></span><br><span class="line">    errorID = Column(INTEGER, primary_key=<span class="literal">True</span>)</span><br><span class="line">    errorname = Column(String(<span class="number">256</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    TestName = Column(String(<span class="number">256</span>), ForeignKey(<span class="string">'tbSqlAlchemyTest.TestName'</span>))<span class="comment">#这里面关联外键使用表的名字而不是类的名字,表与表之间建立联系</span></span><br><span class="line"></span><br><span class="line">    test = relationship(<span class="string">"AlchemyTest"</span>, back_populates=<span class="string">"error"</span>)</span><br><span class="line">    <span class="comment">#告诉ORM,自己这个class与AlchemyTest这个class相关联，并且设定了一个“多对一”的关系</span></span><br><span class="line">    <span class="comment">#*在自己这个类中生成一个test属性，然后在AlchemyTest类中创建一个error属性，与之关联，可以反向查询*</span></span><br><span class="line"></span><br><span class="line">AlchemyTest.error = relationship(<span class="string">"AlchemyTestError"</span>, back_populates=<span class="string">"test"</span>)</span><br><span class="line"><span class="comment">#与上面一个relationship形成双向relationship，意思是在AlchemyTest类中生成一个error属性，然后与AlchemyTestError中的test属性相关联</span></span><br><span class="line"><span class="comment">#所以实际上与上面一个relationship是一样的意思</span></span><br></pre></td></tr></table></figure></p>
<p>给一对多的关系表插入数据：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">test1 = session.query(AlchemyTest).filter(AlchemyTest.TestName == <span class="string">'user1'</span>).first() <span class="comment">#首先提取需要加入error的test，这个已经存在</span></span><br><span class="line">test1.error = [AlchemyTestError(errorID=<span class="string">'553'</span>, errorname=<span class="string">'cuowu'</span>),</span><br><span class="line">               AlchemyTestError(errorID=<span class="string">'667'</span>, errorname=<span class="string">'afsf'</span>)] <span class="comment">#使用relationship()时建立的error属性来给AlchemyTestError插入数据</span></span><br><span class="line">session.add(test1)</span><br><span class="line">session.commit()stmt</span><br></pre></td></tr></table></figure></p>
<p>使用query.join()结合两张表来查询数据表数据：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">result = session.query(AlchemyTest).join(AlchemyTestError).filter(AlchemyTestError.errorname == <span class="string">'cuowu'</span>).first() <span class="comment">#查询AlchemyTest表内的数据，看哪些user有这个error</span></span><br><span class="line"><span class="keyword">if</span> result <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">    print(result.TestName)</span><br></pre></td></tr></table></figure></p>
<p>因为这两张表只有一个外键，所以query.join()知道怎么关联这两张表，但是如果没有或者不止一个外键的时候，使用其他的形式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = session.query(AlchemyTest).join((AlchemyTestError, AlchemyTest.TestName==AlchemyTestError.TestName)).first()</span><br></pre></td></tr></table></figure>
<p>这里有一个join的reminder：<br>join : 如果表中有至少一个匹配，则返回行<br>left join : 即使右表中没有匹配，也从左表返回所有的行<br>right join : 即使左表中没有匹配，也从右表返回所有的行<br>full join : 只要其中一个表中存在匹配，就返回行</p>
<p>outerjoin: <code>query.outerjoin(User.addresses) # LEFT OUTER JOIN</code></p>
<p>使用别名：<br>当一个table需要被call多次的时候，使用别名aliased()可以弄清：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name1 = aliased(AlchemyTest)</span><br><span class="line">name2 = aliased(AlchemyTest)</span><br></pre></td></tr></table></figure></p>
<p>使用subquery()来做子查询：<br>这个例子用于查询每个AlchemyTest的TestName对应了几个error：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">stmt = session.query(AlchemyTestError.TestName, func.count(<span class="string">'*'</span>).label(<span class="string">'errorcount'</span>)).group_by(AlchemyTestError.TestName).subquery() <span class="comment">#一定要使用subquery()才能使这个临时表生效</span></span><br><span class="line"><span class="comment">#相当于生成了一个临时表，stmt它具有表结构，这个表结构的数据我们通过"c"这个属性来获取</span></span><br><span class="line"><span class="keyword">for</span> user, count <span class="keyword">in</span> session.query(AlchemyTest, stmt.c.errorcount).outerjoin(stmt, AlchemyTest.TestName==stmt.c.TestName).order_by(AlchemyTest.TestName):</span><br><span class="line"><span class="comment">#这里相当于SELECT user FROM AlchemyTest, SELECT count FROM stmt.c.errorcount LEFT OUTER JOIN stmt ON (AlchemyTest.TestName==stmt.c.TestName)</span></span><br><span class="line">    print(user.TestName, count)</span><br></pre></td></tr></table></figure></p>
<p>使用exists()：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stmt = exists().where(Address.user_id==User.id)</span><br><span class="line"><span class="keyword">for</span> name, <span class="keyword">in</span> session.query(User.name).filter(stmt):</span><br><span class="line">     print(name)</span><br></pre></td></tr></table></figure></p>
<p>一些描述关系的方法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">query.filter(User.addresses.contains(someaddress))</span><br><span class="line">query.filter(User.addresses.any(Address.email_address == <span class="string">'bar'</span>))</span><br><span class="line">query.filter(Address.user.has(name=<span class="string">'ed'</span>))</span><br><span class="line">session.query(Address).with_parent(someuser, <span class="string">'addresses'</span>)</span><br></pre></td></tr></table></figure></p>
<p>删除数据：<br>删除可以直接使用<code>session.delete()</code><br>但是与之关联的table并没有删除数据，因为SQLAlchemy并没有设定级联删除！！！<br>解决方案：<br>在一对多关系的table里的relationship设定时增加cascade：<br><code>cascade=&quot;all, delete, delete-orphan”</code></p>
<p>建立多对多关系的表结构：<br>例子中有两个tables，分别是博客表和关键字表，一篇博客可以拥有多个关键字，一个关键字也可以对应多篇博客。<br>所以我们要建立一个未映射的关系表：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">post_keywords = Table(<span class="string">'post_keywords'</span>, Base.metadata,</span><br><span class="line"><span class="meta">... </span>    Column(<span class="string">'post_id'</span>, ForeignKey(<span class="string">'posts.id'</span>), primary_key=<span class="literal">True</span>),</span><br><span class="line"><span class="meta">... </span>    Column(<span class="string">'keyword_id'</span>, ForeignKey(<span class="string">'keywords.id'</span>), primary_key=<span class="literal">True</span>)</span><br><span class="line"><span class="meta">... </span>)</span><br></pre></td></tr></table></figure></p>
<p>这个表建立的方式与建立一个拥有映射关系的class不同。接下来创建博客表和关键字表分别与这个中间关系表用relationship()关联起来：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">BlogPost</span><span class="params">(Base)</span>:</span></span><br><span class="line"><span class="meta">... </span>    __tablename__ = <span class="string">'posts'</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    id = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line"><span class="meta">... </span>    user_id = Column(Integer, ForeignKey(<span class="string">'users.id'</span>))</span><br><span class="line"><span class="meta">... </span>    headline = Column(String(<span class="number">255</span>), nullable=<span class="literal">False</span>)</span><br><span class="line"><span class="meta">... </span>    body = Column(Text)</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    <span class="comment"># many to many BlogPost&lt;-&gt;Keyword</span></span><br><span class="line"><span class="meta">... </span>    keywords = relationship(<span class="string">'Keyword'</span>,</span><br><span class="line"><span class="meta">... </span>                            secondary=post_keywords,</span><br><span class="line"><span class="meta">... </span>                            back_populates=<span class="string">'posts'</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, headline, body, author)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.author = author</span><br><span class="line"><span class="meta">... </span>        self.headline = headline</span><br><span class="line"><span class="meta">... </span>        self.body = body</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> <span class="string">"BlogPost(%r, %r, %r)"</span> % (self.headline, self.body, self.author)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Keyword</span><span class="params">(Base)</span>:</span></span><br><span class="line"><span class="meta">... </span>    __tablename__ = <span class="string">'keywords'</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    id = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line"><span class="meta">... </span>    keyword = Column(String(<span class="number">50</span>), nullable=<span class="literal">False</span>, unique=<span class="literal">True</span>)</span><br><span class="line"><span class="meta">... </span>    posts = relationship(<span class="string">'BlogPost'</span>,</span><br><span class="line"><span class="meta">... </span>                         secondary=post_keywords,</span><br><span class="line"><span class="meta">... </span>                         back_populates=<span class="string">'keywords'</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, keyword)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.keyword = keyword</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/python/python基础/20190302_sqlalchemy的一些概念/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="崔永华的个人网站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/python/python基础/20190302_sqlalchemy的一些概念/" itemprop="url">
                  sqlalchemy的一些概念
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-02T15:24:20+08:00">
                2019-03-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>官网：<a href="https://www.sqlalchemy.org/" target="_blank" rel="noopener">https://www.sqlalchemy.org/</a></p>
<p>Python SQLAlchemy Cheatsheet ： <a href="https://www.pythonsheets.com/notes/python-sqlalchemy.html" target="_blank" rel="noopener">https://www.pythonsheets.com/notes/python-sqlalchemy.html</a><br>官方文档：<a href="https://docs.sqlalchemy.org/en/latest/orm/tutorial.html" target="_blank" rel="noopener">https://docs.sqlalchemy.org/en/latest/orm/tutorial.html</a></p>
<p>首先 <code>import sqlalchemy</code><br>可以这样检查版本 <code>sqlalchemy.__version__</code></p>
<h4 id="1-sqlalchemy-简介"><a href="#1-sqlalchemy-简介" class="headerlink" title="1. sqlalchemy 简介"></a>1. sqlalchemy 简介</h4><p>开发人员常用的关系数据库有MySQL,Oracle, SQL Server, SQLite和PostgreSQL，操作数据库的方法大致有以下2种：</p>
<ul>
<li>直接使用数据库接口连接：在python的数据库连接模块中，分别有pymysql,cx_Oracle,pymssql,sqlite3,psycopg2。通常这类数据库的操作步骤是：连接数据库，执行SQL语句，提交事务，关闭数据库连接。每次操作都需要开启/关闭连接，这么频繁，对系统来说是一种浪费。</li>
<li>通过orm框架来操作数据库：ORM(Object/Relation Mapping)对象-关系映射，主要实现对象到关系数据库的映射（或者说就是在python中设定一个类，在mysql中定义一个表，把关系数据库的表结构映射到这个类上），在实际工作中，企业级开发都是使用orm框架来实现数据库持久化操作的。</li>
</ul>
<p>常用的ORM框架模块有：SQLObject,stom,Django的ORM,peewee和SQLAlchemy。</p>
<p><strong>SQLAlchemy</strong> 是 python 语言中一个比较有名的 ORM 框架。用于连接、操作数据库。提供SQL工具包以及对象-关系映射工具，使用MIT许可证发行。</p>
<ul>
<li>首次发行于2006年2月，是python社区广泛使用的orm工具之一，不亚于Django的orm框架。</li>
<li>和传统直接操作SQL相比, 使用SQLAlchemy的对象来操作数据库更为直观.SQLAlchemy 内建数据库连接池，解决了连接操作相关繁琐的处理，提供方便的强大的log功能。</li>
<li>类似java里的Hiernate的数据映射模型。</li>
</ul>
<h4 id="2-sqlalchemy-orm优缺点和适用范围"><a href="#2-sqlalchemy-orm优缺点和适用范围" class="headerlink" title="2. sqlalchemy orm优缺点和适用范围"></a>2. sqlalchemy orm优缺点和适用范围</h4><p>1、优点:  </p>
<ul>
<li>简单：ORM以最基本的形式建模数据。表的字段就是这个类的成员变量  </li>
<li>可读性：ORM使数据库结构文档化。比如MySQL数据库就被ORM转换为了class类，程序员可以只把注意力放在代码逻辑上（当然能够熟练掌握MySQL更好）  </li>
<li>可用性：ORM的避免了不规范、冗余、风格不统一的SQL语句，可以避免很多人为Bug，方便编码风格的统一和后期维护  </li>
<li>可维护性：在数据表结构甚至数据库发生改变时，减少了相应的代码修改;可以很方便地引入数据缓存之类的附加功能  </li>
</ul>
<p>2、缺点:  </p>
<ul>
<li>自动化进行关系数据库的映射需要消耗系统性能。一般来说都可以忽略之，特别是有cache存在的时候  </li>
<li>在处理多表联查、where条件复杂之类的查询时，ORM的语法会变得复杂  </li>
<li>越是功能强大的ORM越是消耗内存，因为一个ORM Object会带有很多成员变量和成员函数。</li>
</ul>
<p>3、适用范围：适用于快速开发和团队合作开发，不适用于有大数据量(千万/亿级别)、大运算量、复杂查询的系统。</p>
<h4 id="3-主流数据库的连接方式"><a href="#3-主流数据库的连接方式" class="headerlink" title="3. 主流数据库的连接方式"></a>3. 主流数据库的连接方式</h4><p>1、首先安装需要的模块：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install SQLAlchemy</span><br><span class="line"><span class="comment"># 如mysql数据库需要长pymysql模块</span></span><br><span class="line">pip install pymysql</span><br></pre></td></tr></table></figure></p>
<p>2、主流数据库的连接方式：</p>
<table>
<thead>
<tr>
<th>数据库</th>
<th>连接字符串</th>
</tr>
</thead>
<tbody>
<tr>
<td>Microsoft SQL Server</td>
<td>mssql+pymssql://username:password@ip:port/dbname</td>
</tr>
<tr>
<td>MySQL</td>
<td>mysql+pymysql://username:password@ip:port/dbname</td>
</tr>
<tr>
<td>Oracle</td>
<td>cx_Oracle://username:password@ip:port/dbname</td>
</tr>
<tr>
<td>PostgreSQL</td>
<td>postgressql://username:password@ip:port/dbname</td>
</tr>
<tr>
<td>SQLite</td>
<td>sqlite://file_path</td>
</tr>
</tbody>
</table>
<h4 id="4-连接实例-获取session"><a href="#4-连接实例-获取session" class="headerlink" title="4. 连接实例(获取session)"></a>4. 连接实例(获取session)</h4><blockquote>
<p>连接数据库实例3个步骤：  </p>
<pre><code>1. 创建engine  
2. sessionmaker绑定engine  
3. 创建session实例  
</code></pre></blockquote>
<p>create_engin的参数及session的创建如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 已连接mysql为例</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">engine = create_engine(</span><br><span class="line">    <span class="comment"># 'postgresql+psycopg2://&#123;&#125;:&#123;&#125;@&#123;&#125;:&#123;&#125;/&#123;&#125;'.format(   连接postgresql</span></span><br><span class="line">    <span class="string">'mysql+pymysql://&#123;&#125;:&#123;&#125;@&#123;&#125;:&#123;&#125;/&#123;&#125;'</span>.format(    <span class="comment"># 连接mysql</span></span><br><span class="line">    POSTGRESQL_USER_NAME, </span><br><span class="line">    POSTGRESQL_PASSWORD, </span><br><span class="line">    POSTGRESQL_HOST, </span><br><span class="line">    POSTGRESQL_PORT, </span><br><span class="line">    POSTGRESQL_DB_NAME</span><br><span class="line">    ),</span><br><span class="line">    echo=Fase,          <span class="comment"># -- 如果为真，引擎将记录所有语句   用于调试</span></span><br><span class="line">    echo_pool=<span class="literal">False</span>,    <span class="comment"># -- 如果为true，则连接池将记录信息输出，例如连接失效以及连接回收到默认日志处理程序，用于调试</span></span><br><span class="line">    encoding=<span class="string">'utf-8'</span>,   <span class="comment"># 默认为 utf-8 . 这是sqlAlchemy用于在sqlAlchemy中发生的字符串编码/解码操作的字符串编码</span></span><br><span class="line">    pool_size=<span class="number">5</span>,   <span class="comment">#-- 设置连接数，默认设置5个连接数，设置为0表示没有限制</span></span><br><span class="line">    max_overflow=<span class="number">10</span>,    <span class="comment"># -- 允许在连接池中“溢出”的连接数，即可以在池大小设置（默认为5）之上或之外打开的连接数，默认连接数为10。</span></span><br><span class="line">    pool_timeout=<span class="number">30</span>,    <span class="comment">#  -- 连接超时时间，默认为30秒，超过时间的连接都会连接失败。即在放弃从池中获取连接之前等待的秒数</span></span><br><span class="line">    isolation_level=<span class="string">"AUTOCOMMIT"</span>  <span class="comment"># 设置引擎范围内的事务隔离级别隔离</span></span><br><span class="line">    pool_recycle=<span class="number">-1</span>  <span class="comment"># 连接重置周期，默认为-1，推荐设置7200，即如果连接数已空闲7200秒，就自动重新获取，以防止连接被关闭。</span></span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Session = sessionmaker(bind=engine)</span><br><span class="line">session = Session()</span><br><span class="line"></span><br><span class="line"><span class="comment">#可以把 sessionmaker 想象成一个手机，engine 当做数据库的号码，拨通这个“号码”我们就创建了一个 Session 类。</span></span><br></pre></td></tr></table></figure></p>
<h4 id="5-设置事务级别-isolation-level"><a href="#5-设置事务级别-isolation-level" class="headerlink" title="5. 设置事务级别  isolation_level"></a>5. 设置事务级别  isolation_level</h4><p>置引擎范围内的事务隔离级别隔离:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create_engine(isolation_level=<span class="string">"READ_COMMITTED"</span>)  <span class="comment"># 事务隔离级别   对engine范围设置</span></span><br></pre></td></tr></table></figure></p>
<p>可选值如下:</p>
<table>
<thead>
<tr>
<th>值</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>SERIALIZABLE</td>
<td>串行读</td>
<td>完全串行化的读，每次读都需要获得表级共享锁，读写相互都会阻塞</td>
</tr>
<tr>
<td>REPEATABLE_READ</td>
<td>可重复读</td>
<td>确保同一事务的多个实例在并发读取数据时，会看到同样的数据行，InnoDB默认级别。在SQL标准中，该隔离级别消除了不可重复读，但是还存在幻读    MySQL默认隔离级别；</td>
</tr>
<tr>
<td>READ_COMMITTED</td>
<td>提交读</td>
<td>只能读取到已经提交的数据。大部分数据库系统的默认隔离级别都是READ-COMMITED，但MySQL不是；</td>
</tr>
<tr>
<td>READ_UNCOMMITTED</td>
<td>未提交读</td>
<td>事务中的修改，即使没有提交，对其他事务也是可见的，因此可能读到脏数据(脏读，dirty read)；</td>
</tr>
<tr>
<td>AUTOCOMMIT</td>
<td>自动提交</td>
<td>在命令行执行sql语句，每执行一次操作实质上就是一次事务</td>
</tr>
</tbody>
</table>
<h4 id="6-sessionmaker-参数"><a href="#6-sessionmaker-参数" class="headerlink" title="6. sessionmaker 参数"></a>6. sessionmaker 参数</h4><p>1、autocommit</p>
<blockquote>
<p>autocommit参数表示是否自动提交事务,默认关闭,即默认sqlalchemy为每个请求（包含select操作）开启事务,但不会自动提交这个事务，需要手动提交事务。 </p>
</blockquote>
<blockquote>
<p>如果autocommit=True，sqlalchemy会为每个请求（包含select操作）开启事务,并且自动提交这个事务。当你需要保证多条命令是原则性操作，则需使用<code>session.begin()</code>开启事务</p>
</blockquote>
<h5 id="isolation-level-”AUTOCOMMIT”-与-sessionmaker-autocommit-True-区别"><a href="#isolation-level-”AUTOCOMMIT”-与-sessionmaker-autocommit-True-区别" class="headerlink" title="isolation_level=”AUTOCOMMIT”  与 sessionmaker(autocommit=True)区别"></a>isolation_level=”AUTOCOMMIT”  与 sessionmaker(autocommit=True)区别</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlalchemy简单工作流程：</span><br><span class="line">代码（session.query） --&gt;  sqlalchemy  --&gt;  psycopg2  --&gt;  postgresql</span><br><span class="line"></span><br><span class="line">默认值时（autocommit不开启）：sqlalchemy在执行命令钱会通过psycopg2向数据库发送`begin`命令到数据库（之后所以命令都在事务中执行，不可在次执行session.begin命令）</span><br></pre></td></tr></table></figure>
<blockquote>
<p>相同点：最终效果相同（都会在执行select语句后自动提交）</p>
</blockquote>
<blockquote>
<p>不同点： sessionmaker(autocommit=True) 效果：会在执行命令完毕后断开连接，并将此连接roolback回滚放回连接池。（官方不建议使用）<br>isolation_level=”AUTOCOMMIT”效果：在执行命令之前不会向数据库发送begin命令。</p>
</blockquote>
<p>因此两者都可以达到自动提交的效果，但实现方法完全不同。</p>
<p>2、autoflush</p>
<p>autoflush 为 True 时（默认是 True），session 进行查询之前会自动把当前累计的修改发送到数据库（注意：autoflush 并不是说在 session.add 之后会自动 flush），举个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 创建了一个对象，这时，这个对象几乎没有任何意义，session 不知道它的存在</span><br><span class="line">&gt;&gt;&gt; user = User(name=&apos;cosven&apos;)</span><br><span class="line"></span><br><span class="line"># session.add 这个对象之后，它被 session 放到它的对象池里面去了，但这时不会发送任何 SQL 语句给数据库，数据库目前仍然不知道它的存在</span><br><span class="line">&gt;&gt;&gt;  session.add(user)</span><br><span class="line"> </span><br><span class="line"># session1.Query 执行之前，由于 autoflush 是 True，session 会先执行 session.flush()(session.flush 的意义：session将变积累的 SQL 语句发送给数据库。)，然后再发送查询语句</span><br><span class="line"># 所以，这个查询是能查到 user </span><br><span class="line">&gt;&gt;&gt; session1.query(User).filter_by(name=&apos;cosven&apos;).first()</span><br><span class="line">&lt;__main__.User object at 0x1108f04e0&gt;</span><br></pre></td></tr></table></figure></p>
<p>如果 session 的 autoflush 为 False 的话，session 进行查询之前不会把当前累计的修改发送到数据库，而直接发送查询语句，所以下面这个查询是查不到对象的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; session.add(User(name=&apos;haha&apos;))</span><br><span class="line">&gt;&gt;&gt; session.query(User).filter_by(name=&apos;haha&apos;).first()  # None</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>autoflush 的意义：session 在进行<strong>查询之前</strong>，<strong>自动</strong>的进行一次 flush 操作。</p>
</blockquote>
<p>3、expire_on_commit</p>
<p>如果为True，在commit之后所以实例将完全过期，以便在完成事务之后，获取属性/对象都将从最近的数据库状态加载。</p>
<h5 id="scoped-session-与-sessionmaker区别"><a href="#scoped-session-与-sessionmaker区别" class="headerlink" title="scoped_session 与 sessionmaker区别"></a>scoped_session 与 sessionmaker区别</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from sqlalchemy import create_engine</span><br><span class="line">from sqlalchemy.orm import sessionmaker, scoped_session</span><br><span class="line"></span><br><span class="line">engine = create_engine()</span><br><span class="line"></span><br><span class="line">Session = scoped_session(</span><br><span class="line">            sessionmaker(</span><br><span class="line">                autoflush = True,</span><br><span class="line">                bind = engine))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>sessionmaker，我们得到一个类，一个能产生session的工厂。(每次调用都会得倒不同的session)  </p>
</blockquote>
<blockquote>
<p>scoped_session类似单例模式，当我们调用使用的时候，会先在Registry里找找之前是否已经创建session了。要是有，就把这个session返回。要是没有，就创建新的session，注册到Registry中以便下次返回给调用者。这样就实现了这样一个目的：在同一个线程中，call scoped_session 的时候，返回的是同一个对象</p>
</blockquote>
<h4 id="7-创建orm类"><a href="#7-创建orm类" class="headerlink" title="7. 创建orm类"></a>7. 创建orm类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding =utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入需要的字段类型</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy.dialects.mysql <span class="keyword">import</span> LONGTEXT</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, VARCHAR, TEXT, DATE, DATETIME</span><br><span class="line"></span><br><span class="line"><span class="comment"># Model基类,创建了一个BaseModel类,这个类的子类可以自动与一个表关联</span></span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParseHtmlItem</span><span class="params">(Base)</span>:</span></span><br><span class="line">    <span class="comment"># 指定表名</span></span><br><span class="line">    __tablename__ = <span class="string">'huachuang_parse_html'</span></span><br><span class="line">    <span class="comment"># 对于表的描述</span></span><br><span class="line">    desc = <span class="string">'华创项目解析详情页信息数据存储'</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 表结构</span></span><br><span class="line">    ANCHOR_TITLE = Column(VARCHAR(<span class="number">200</span>), doc=&#123;<span class="string">'zh'</span>: <span class="string">'列表页获取详情页标题(外部标题)'</span>&#125;)</span><br><span class="line">    TAG_TITLE = Column(VARCHAR(<span class="number">200</span>), doc=&#123;<span class="string">'zh'</span>: <span class="string">'标签标题'</span>&#125;)</span><br><span class="line">    TITLE = Column(VARCHAR(<span class="number">200</span>), doc=&#123;<span class="string">'zh'</span>: <span class="string">'详情页标题'</span>&#125;)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">creat_table</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        创建数据表</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        cls.__table__.create(bind=engine_postgresql, checkfirst=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<h4 id="8-常用的SQLAlchemy字段类型"><a href="#8-常用的SQLAlchemy字段类型" class="headerlink" title="8. 常用的SQLAlchemy字段类型"></a>8. 常用的SQLAlchemy字段类型</h4><table>
<thead>
<tr>
<th>类型名</th>
<th>python中类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Integer</td>
<td>int</td>
<td>普通整数，一般是32位</td>
</tr>
<tr>
<td>SmallInteger</td>
<td>int</td>
<td>取值范围小的整数，一般是16位</td>
</tr>
<tr>
<td>BigInteger</td>
<td>int或long</td>
<td>不限制精度的整数</td>
</tr>
<tr>
<td>Float</td>
<td>float</td>
<td>浮点数</td>
</tr>
<tr>
<td>Numeric</td>
<td>decimal.Decimal</td>
<td>普通整数，一般是32位</td>
</tr>
<tr>
<td>Varchar</td>
<td>str</td>
<td>变长字符串</td>
</tr>
<tr>
<td>Text</td>
<td>str</td>
<td>变长字符串，对较长或不限长度的字符串做了优化</td>
</tr>
<tr>
<td>Unicode</td>
<td>unicode</td>
<td>变长Unicode字符串</td>
</tr>
<tr>
<td>UnicodeText</td>
<td>unicode</td>
<td>变长Unicode字符串，对较长或不限长度的字符串做了优化</td>
</tr>
<tr>
<td>Boolean</td>
<td>bool</td>
<td>布尔值</td>
</tr>
<tr>
<td>Date</td>
<td>datetime.date</td>
<td>时间</td>
</tr>
<tr>
<td>Time</td>
<td>datetime.datetime</td>
<td>日期和时间</td>
</tr>
<tr>
<td>LargeBinary</td>
<td>str</td>
<td>二进制文件</td>
</tr>
</tbody>
</table>
<p>** 常用的SQLAlchemy列选项</p>
<table>
<thead>
<tr>
<th>选项名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>primary_key</td>
<td>如果为True，代表表的主键</td>
</tr>
<tr>
<td>unique</td>
<td>如果为True，代表这列不允许出现重复的值</td>
</tr>
<tr>
<td>index</td>
<td>如果为True，为这列创建索引，提高查询效率</td>
</tr>
<tr>
<td>nullable</td>
<td>如果为True，允许有空值，如果为False，不允许有空值</td>
</tr>
<tr>
<td>default</td>
<td>为这列定义默认值</td>
</tr>
</tbody>
</table>
<p><strong>注意：</strong><br> orm结构中可以只写<strong>部分字段</strong>，未写出的列会将其忽略</p>
<h4 id="9-查询、过滤关键字"><a href="#9-查询、过滤关键字" class="headerlink" title="9. 查询、过滤关键字"></a>9. 查询、过滤关键字</h4><p>1、使用query查询表的内容：返回的结果是一个tuple<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">session = Session_class()</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> session.query(AlchemyTest).all():</span><br><span class="line">    print(row.TestName, row.TestNumber)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以使用label()对单独的一列进行命名,这样就对name这一列命名为name_label</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> session.query(User.name.label(<span class="string">'name_label'</span>)).all()</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以用python的方法限定哪几行：</span></span><br><span class="line"><span class="keyword">for</span> u <span class="keyword">in</span> session.query(User).order_by(User.id)[<span class="number">1</span>:<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></p>
<p>filter_by()可以直接使用关键字进行限制条件，但是filter()能处理更复杂的限制条件。<br>如果有两个限制条件是AND关系，可以直接使用两次filter()处理：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.query(User).filter(User.name==<span class="string">'ed'</span>).filter(User.fullname==<span class="string">'Ed Jones'</span>)</span><br></pre></td></tr></table></figure></p>
<p>2、下面列表也展示了其他方法：（filter operator :）</p>
<table>
<thead>
<tr>
<th>作用</th>
<th>符号</th>
</tr>
</thead>
<tbody>
<tr>
<td>相等</td>
<td>==</td>
</tr>
<tr>
<td>不相等</td>
<td>!=</td>
</tr>
<tr>
<td>通配符搜索</td>
<td>like(’%关键字%’)</td>
</tr>
<tr>
<td>通配符搜索(不敏感)</td>
<td>ilike()</td>
</tr>
<tr>
<td>存在于</td>
<td>.in_([‘ed’, ‘wendy’, ‘jack’])</td>
</tr>
<tr>
<td>不存在于</td>
<td>~User.name.in_([‘ed’, ‘wendy’, ‘jack’])</td>
</tr>
<tr>
<td>为空</td>
<td>== None</td>
</tr>
<tr>
<td>and</td>
<td>.filter(User.name == ‘ed’, User.fullname == ‘Ed Jones’)</td>
</tr>
<tr>
<td>or</td>
<td>or_(User.name == ‘ed’, User.name == ‘wendy’)</td>
</tr>
<tr>
<td>MATCH</td>
<td>.match(‘wendy’)</td>
</tr>
</tbody>
</table>
<p>3、检索返回的列表，以及列表的标量 ：</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>all()</td>
<td>返回所有</td>
</tr>
<tr>
<td>first()</td>
<td>返回第一行</td>
</tr>
<tr>
<td>one()</td>
<td>检查是不是只有一行结果</td>
</tr>
<tr>
<td>one_or_none()</td>
<td>检查是不是一行或者没有结果</td>
</tr>
<tr>
<td>scalar()</td>
<td>invokes the one() method, and upon success returns the first column of the row</td>
</tr>
</tbody>
</table>
<p>4、直接使用textual SQL语句 :<br>使用text()可以在query中使用literal strings：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.query(User).filter(text(<span class="string">"id&lt;224"</span>)).order_by(text(<span class="string">"id"</span>)).all()</span><br></pre></td></tr></table></figure></p>
<p>如果要直接使用完整的整条sql，可以使用text()传给from_statement()：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.query(User).from_statement(text(<span class="string">"SELECT * FROM users where name=:name"</span>)).params(name=<span class="string">'ed'</span>).all()</span><br></pre></td></tr></table></figure></p>
<p>5、计数：<br>可以直接使用 .count()计算有多少行：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.query(User).filter(User.name.like(<span class="string">'%ed'</span>)).count()</span><br></pre></td></tr></table></figure></p>
<p>当需要将指定的东西进行计数，就使用func.count()：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.query(func.count(User.id)).scalar()</span><br></pre></td></tr></table></figure></p>
<p>filter 与 filter_by 区别</p>
<ul>
<li>字段写法：filter筛选的字段是带类名（表名）的，而filter_by只需要筛选字段就可以；</li>
<li>判断条件：filter比filter_by多了一个等号；</li>
<li>作用范围：filter可用于单表或者多表查询，而filter_by只能用于单表查询。</li>
</ul>
<blockquote>
<p>filter 可以像 sql 的 where 语句一样使用 &gt; &lt; 等条件。引用列名时，需要通过 类名.属性名 的方式。<br>filter_by 使用 python 的正常参数传递方法，指定列名时，不需要额外指定类名。</p>
</blockquote>
<h4 id="9-数据库操作（CRUD）"><a href="#9-数据库操作（CRUD）" class="headerlink" title="9. 数据库操作（CRUD）"></a>9. 数据库操作（CRUD）</h4><p>1、查询</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询ParseHtmlItem.__tablename__ 表中全部数据</span></span><br><span class="line">session.query(ParseHtmlItem).all() </span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询id为1的值</span></span><br><span class="line">session.query(ParseHtmlItem).filter_by(ID=<span class="number">1</span>).first()  <span class="comment"># 得到单个对象</span></span><br><span class="line">session.query(ParseHtmlItem).filter_by(ID=<span class="number">1</span>).all()    <span class="comment"># 得到列表</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询id 小于5的数据</span></span><br><span class="line">session.query(ParseHtmlItem).filter(ParseHtmlItem.ID&lt;<span class="number">5</span>).all()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询巨大数据量来实现分页的情况，推荐使用通过id区间来读取数据库（提高读取速度）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取值</span></span><br><span class="line">data = session.query(ParseHtmlItem).filter_by(ID=<span class="number">1</span>).first()</span><br><span class="line">data.ID <span class="comment"># 取id的值</span></span><br></pre></td></tr></table></figure>
<p>2、增加</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">item = ParseHtmlItem(</span><br><span class="line">                CONTENT_URL_HASH=content_url_hash,</span><br><span class="line">                ...</span><br><span class="line">            )</span><br><span class="line">session.add(item)</span><br><span class="line">session.commit()  <span class="comment"># autocommit=True时，可以不写此命令（但推荐写）</span></span><br></pre></td></tr></table></figure>
<p>3、修改</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询要修改的数据</span></span><br><span class="line">item = session.query(User).first()</span><br><span class="line">item.CONTENT_URL_HASH = <span class="string">""</span></span><br><span class="line">session.add(usr)</span><br><span class="line">session.commit()</span><br></pre></td></tr></table></figure>
<p>4、删除</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询要删除的数据</span></span><br><span class="line">item = session.query(User).first()</span><br><span class="line">session.delete(item)</span><br><span class="line">session.commit()</span><br></pre></td></tr></table></figure>
<h4 id="10-flush与commit区别"><a href="#10-flush与commit区别" class="headerlink" title="10. flush与commit区别"></a>10. flush与commit区别</h4><p>在SQLAlchemy中每个事务对应一条或多条SQL语句，这些SQL语句需要经历如下步骤：  </p>
<ol>
<li>将sql语句发送到sql服务器。</li>
<li>在当前事务中执行sql，但不会将修改写入磁盘。</li>
<li><p>将修改写入磁盘</p>
<p>&emsp;&emsp;flush  操作会执行1，2步骤。<br>&emsp;&emsp; commit操作执行1，2，3步骤。<br>&emsp;&emsp;因此，flush之后你可以在当前Session中看到效果，而commit之后你才能从其它Session中看到效果。</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush 使用场景为：现在已经执行一些操作，但不想结束此事务。</span><br></pre></td></tr></table></figure>
<h4 id="11-数据库操作错误拦截"><a href="#11-数据库操作错误拦截" class="headerlink" title="11. 数据库操作错误拦截"></a>11. 数据库操作错误拦截</h4><p>数据库操作可能因为数据类型/长度，网络原因等问题导致写入数据出错,因此要做好错误拦截避免程序关闭</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># try 中存放sql操作代码</span></span><br><span class="line">    item = ParseHtmlItem(</span><br><span class="line">                CONTENT_URL_HASH=content_url_hash,</span><br><span class="line">                ...</span><br><span class="line">            )</span><br><span class="line">    session.add(item)</span><br><span class="line">    session.commit() </span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="comment"># 事务回滚，撤销此次事务修改</span></span><br><span class="line">    session.rollback()</span><br><span class="line">    logging.error(<span class="string">f"sql insert error: <span class="subst">&#123;e&#125;</span>"</span>)</span><br></pre></td></tr></table></figure>
<p><strong><em>注意：</em></strong><br>使用select语句推荐<strong>使用错误拦截</strong>，并使用session.rollback()回滚事务（select查询时可能数据库因为一些原因导致此次查询错误，在下次查询时可能持续报错无法正常查询）</p>
<h4 id="12-session-关闭-close"><a href="#12-session-关闭-close" class="headerlink" title="12. session 关闭  close"></a>12. session 关闭  close</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure>
<p>session创建和管理对数据库的连接，当调用close的时候，注意，sqlalchemy不会关闭与mysql的连接，而是把连接返回到连接池。</p>
<p><strong>推荐</strong><br>当前session commit之后就执行close操作（原因：1.每次使用session时都会从连接池中取出，因此可以将session关闭主动放回连接池 2. 可以确保 transaction 有非常清晰的开始和结束，保持 transaction 简短，也就意味着让 transaction 能在一系列操作之后终止，而不是一直开放着。（保留session的生命周期（通常是transaction）独立））</p>
<p><strong>注意</strong>：<br>未commit的transactions会被回滚</p>
<h4 id="13-整体代码"><a href="#13-整体代码" class="headerlink" title="13. 整体代码"></a>13. 整体代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span>  Column, Integer, String</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">engine = create_engine(</span><br><span class="line">    <span class="comment"># postgresql+psycopg2://&#123;&#125;:&#123;&#125;@&#123;&#125;:&#123;&#125;/&#123;&#125;'.format(   连接postgresql</span></span><br><span class="line">    <span class="string">'mysql+pymysql://&#123;&#125;:&#123;&#125;@&#123;&#125;:&#123;&#125;/&#123;&#125;'</span>.format(    <span class="comment"># 连接mysql</span></span><br><span class="line">    POSTGRESQL_USER_NAME, </span><br><span class="line">    POSTGRESQL_PASSWORD, </span><br><span class="line">    POSTGRESQL_HOST, </span><br><span class="line">    POSTGRESQL_PORT, </span><br><span class="line">    POSTGRESQL_DB_NAME</span><br><span class="line">    ),</span><br><span class="line">    echo=Fase,          <span class="comment"># -- 如果为真，引擎将记录所有语句   用于调试</span></span><br><span class="line">    echo_pool=<span class="literal">False</span>,    <span class="comment"># -- 如果为true，则连接池将记录信息输出，例如连接失效以及连接回收到默认日志处理程序     用于调试</span></span><br><span class="line">    encoding=<span class="string">'utf-8'</span>,   <span class="comment"># 默认为 utf-8 . 这是sqlAlchemy用于在sqlAlchemy中发生的字符串编码/解码操作的字符串编码</span></span><br><span class="line">    pool_size=<span class="number">5</span>,   <span class="comment">#-- 在连接池中保持打开的连接数   设置为0表示没有限制</span></span><br><span class="line">    max_overflow=<span class="number">10</span>,    <span class="comment"># -- 允许在连接池中“溢出”的连接数，即可以在池大小设置（默认为5）之上或之外打开的连接数</span></span><br><span class="line">    pool_timeout=<span class="number">30</span>,    <span class="comment">#  -- 在放弃从池中获取连接之前等待的秒数</span></span><br><span class="line">    isolation_level=<span class="string">"AUTOCOMMIT"</span>  <span class="comment"># 设置引擎范围内的事务隔离级别隔离</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Session = sessionmaker(bind=engine)</span><br><span class="line">session = Session()</span><br><span class="line"></span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'users'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">50</span>))</span><br><span class="line">    fullname = Column(String(<span class="number">50</span>))</span><br><span class="line">    password = Column(String(<span class="number">12</span>))</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">creat_table</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        创建数据表</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        cls.__table__.create(bind=engine_postgresql, checkfirst=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_all</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        返回所有数据</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span>  session_postgresql.query(cls).all()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            session_postgresql.rollback()</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">f'数据库查询失败 ：<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            session_postgresql.close()</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_item</span><span class="params">(self, id)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    查询指定数据</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> session.query(self).filter_by(id == id).first()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            session_postgresql.rollback()</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">f'数据库查询失败 ：<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            session_postgresql.close()</span><br></pre></td></tr></table></figure>
<h4 id="14-案例-FAQ：session-autocommit-使用中错误"><a href="#14-案例-FAQ：session-autocommit-使用中错误" class="headerlink" title="14. 案例 FAQ：session   autocommit 使用中错误"></a>14. 案例 FAQ：session   autocommit 使用中错误</h4><h5 id="错误描述"><a href="#错误描述" class="headerlink" title="错误描述"></a>错误描述</h5><blockquote>
<p>&emsp;&emsp;sqlalchemy 连接 数据库，select操作未commit提交（autocommit=False）这导致 pg 中产生大量的 “idle in transaction” 的长连接。导致需要 ACCESS EXCLUSIVE 锁的语句（如add column）阻塞，并阻塞所有后续需要 ACCESS SHARE 锁的读请求，导致程序异常。</p>
</blockquote>
<h5 id="错误例子-（还原）"><a href="#错误例子-（还原）" class="headerlink" title="错误例子 （还原）"></a>错误例子 （还原）</h5><p>session1 开启事务，并且查询test表：（autocommit=False时所有命令都会开启事务包括select语句）</p>
<p>mysql&gt; begin;<br>Query OK, 0 rows affected (0.00 sec)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 在此处开启事务模拟autocommit=False</span></span><br><span class="line">mysql&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test1;</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">| id | page | page1 |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">|  1 | NULL |  NULL |</span><br><span class="line">+<span class="comment">----+------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>session2 , 修改表结构，增加字段，这时候会卡住</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table test1 add page2 int;</span><br></pre></td></tr></table></figure>
<p>session3 再开一个终端，session3模拟其他用户的请求 , 请求也会被卡住</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from test1 where id=1;</span><br></pre></td></tr></table></figure>
<p>查看processlist;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show processlist;</span><br><span class="line">+<span class="comment">----+------+--------------------+------+---------+-------+---------------------------------+---------------------------------+</span></span><br><span class="line">| Id | User | Host               | db   | Command | Time  | State                           | Info                            |</span><br><span class="line">+<span class="comment">----+------+--------------------+------+---------+-------+---------------------------------+---------------------------------+</span></span><br><span class="line">|  7 | root | 192.168.33.1:53303 | test | Sleep   | 43035 |                                 | NULL                            |</span><br><span class="line">|  8 | root | localhost          | test | Query   |     0 | starting                        | <span class="keyword">show</span> <span class="keyword">processlist</span>                |</span><br><span class="line">|  <span class="number">9</span> | root | localhost          | <span class="keyword">test</span> | <span class="keyword">Query</span>   |   <span class="number">969</span> | Waiting <span class="keyword">for</span> <span class="keyword">table</span> metadata <span class="keyword">lock</span> | <span class="keyword">alter</span> <span class="keyword">table</span> test1 <span class="keyword">add</span> page2 <span class="built_in">int</span> |</span><br><span class="line">| <span class="number">10</span> | root | localhost          | <span class="keyword">test</span> | <span class="keyword">Query</span>   |   <span class="number">134</span> | Waiting <span class="keyword">for</span> <span class="keyword">table</span> metadata <span class="keyword">lock</span> | <span class="keyword">select</span> * <span class="keyword">from</span> test1 <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>  |</span><br><span class="line">+<span class="comment">----+------+--------------------+------+---------+-------+---------------------------------+---------------------------------+</span></span><br></pre></td></tr></table></figure>
<p>id=9的线程，也就是alter表那个线程，在等待锁，此时已经锁住了test表，其他的线程也不能获取锁读取test表。</p>
<h5 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h5><ol>
<li>isolation_level=”AUTOCOMMIT”</li>
<li>执行每条命令后都执行commit</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/python/python基础/20190301_访问数据库/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="崔永华（Andy）">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="崔永华的个人网站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/python/python基础/20190301_访问数据库/" itemprop="url">
                  python访问数据库
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-01T15:24:20+08:00">
                2019-03-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/python基础/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h5 id="1-python连接mysql并实现增删改查"><a href="#1-python连接mysql并实现增删改查" class="headerlink" title="1. python连接mysql并实现增删改查"></a>1. python连接mysql并实现增删改查</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Databse</span><span class="params">(object)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.conn = pymysql.connect(host=<span class="string">"数据库地址"</span>,</span><br><span class="line">                                    user=<span class="string">"用户名"</span>,</span><br><span class="line">                                    password=<span class="string">"密码"</span>,</span><br><span class="line">                                    port=<span class="number">3306</span>,  <span class="comment"># 端口  </span></span><br><span class="line">                                    database=<span class="string">"数据库名"</span>,</span><br><span class="line">                                    charset=<span class="string">'utf8'</span>)</span><br><span class="line">        self.cursor = self.conn.cursor()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getData</span><span class="params">(self)</span>:</span></span><br><span class="line">        data = []</span><br><span class="line">        self.cursor.execute(<span class="string">r"select url from worm_tb"</span>)</span><br><span class="line">        <span class="keyword">if</span> self.cursor.rowcount != <span class="number">0</span>:</span><br><span class="line">            result = self.cursor.fetchall()</span><br><span class="line">            <span class="keyword">for</span> d <span class="keyword">in</span> result:</span><br><span class="line">                data.append(d[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, url)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.cursor.execute(<span class="string">r"insert into worm_tb (url) values ('%s')"</span> % url)</span><br><span class="line">            self.conn.commit()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">            self.conn.rollback()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">die</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.cursor.close()</span><br><span class="line">        self.conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    db = Databse()</span><br><span class="line">    db.insert(<span class="string">'www.baidu.com'</span>)</span><br><span class="line">    print(db.getData())</span><br><span class="line">    db.die()</span><br></pre></td></tr></table></figure>
<p>案例：把控制台输入的数据,写入MySQL数据库<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    no = int(input(<span class="string">'编号: '</span>))</span><br><span class="line">    name = input(<span class="string">'名字: '</span>)</span><br><span class="line">    loc = input(<span class="string">'所在地: '</span>)</span><br><span class="line">    <span class="comment"># 1. 创建数据库连接对象</span></span><br><span class="line">    con = pymysql.connect(host=<span class="string">'localhost'</span>, port=<span class="number">3306</span>,</span><br><span class="line">                          database=<span class="string">'test'</span>, charset=<span class="string">'utf8'</span>,</span><br><span class="line">                          user=<span class="string">'root'</span>, password=<span class="string">'123456'</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 2. 通过连接对象获取游标</span></span><br><span class="line">        <span class="keyword">with</span> con.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">            <span class="comment"># 3. 通过游标执行SQL并获得执行结果</span></span><br><span class="line">            result = cursor.execute(</span><br><span class="line">                <span class="string">'insert into tb_dept values (%s, %s, %s)'</span>,</span><br><span class="line">                (no, name, loc)</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">if</span> result == <span class="number">1</span>:</span><br><span class="line">            print(<span class="string">'添加成功!'</span>)</span><br><span class="line">        <span class="comment"># 4. 操作成功提交事务</span></span><br><span class="line">        con.commit()</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="comment"># 5. 关闭连接释放资源</span></span><br><span class="line">        con.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p>
<h5 id="2-用python查询数据库中的数据并保存至文本"><a href="#2-用python查询数据库中的数据并保存至文本" class="headerlink" title="2. 用python查询数据库中的数据并保存至文本"></a>2. 用python查询数据库中的数据并保存至文本</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pymysql <span class="keyword">as</span> MySQLdb  <span class="comment">#这里是python3  如果你是python2.x的话，import MySQLdb</span></span><br><span class="line"></span><br><span class="line">host = xxxx</span><br><span class="line">user = xxxx</span><br><span class="line">passwd = xxxx</span><br><span class="line">port = xxxx</span><br><span class="line">db = xxxx</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SelectMySQL</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">select_data</span><span class="params">(self,sql)</span>:</span></span><br><span class="line">        result = []</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            conn = MySQLdb.connect(host=host,</span><br><span class="line">                               port=port,</span><br><span class="line">                               user=user,</span><br><span class="line">                               passwd=passwd,</span><br><span class="line">                               db=db,</span><br><span class="line">                               charset=<span class="string">'utf8'</span>, )</span><br><span class="line">            cur = conn.cursor()</span><br><span class="line">            cur.execute(sql)</span><br><span class="line">            alldata = cur.fetchall()</span><br><span class="line">            <span class="comment"># print(alldata)</span></span><br><span class="line">            <span class="keyword">for</span> rec <span class="keyword">in</span> alldata:</span><br><span class="line">                result.append(rec[<span class="number">0</span>]) <span class="comment">#注意，我这里只是把查询出来的第一列数据保存到结果中了,如果是多列的话，稍微修改下就ok了</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(<span class="string">'Error msg: '</span> + e)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            cur.close()</span><br><span class="line">            conn.close()</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_result</span><span class="params">(self, sql, filename)</span>:</span></span><br><span class="line">        print(sql)</span><br><span class="line">        results = self.select_data(sql)</span><br><span class="line">        print(<span class="string">'The amount of datas: %d'</span> % (len(results)))</span><br><span class="line">        <span class="keyword">with</span> open(filename, <span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">                f.write(str(result) + <span class="string">'\n'</span>)</span><br><span class="line">        print(<span class="string">'Data write is over!'</span>)</span><br><span class="line">        <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    sql = <span class="string">"select name from user"</span></span><br><span class="line">    select = SelectMySQL()</span><br><span class="line">    result1 = select.get_result(sql,<span class="string">'namemsg.txt'</span>)</span><br><span class="line">    print(result1)</span><br></pre></td></tr></table></figure>
<h5 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mysql</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.content = pymysql.Connect(</span><br><span class="line">            host=<span class="string">'localhost'</span>,  <span class="comment"># mysql的主机ip</span></span><br><span class="line">            port=<span class="number">3306</span>,  <span class="comment"># 端口</span></span><br><span class="line">            user=<span class="string">'root'</span>,  <span class="comment"># 用户名</span></span><br><span class="line">            passwd=<span class="string">'123456'</span>,  <span class="comment"># 数据库密码</span></span><br><span class="line">            db=<span class="string">'test'</span>,  <span class="comment"># 数据库名</span></span><br><span class="line">            charset=<span class="string">'utf8'</span>,  <span class="comment"># 字符集</span></span><br><span class="line">        )</span><br><span class="line">        self.cursor = self.content.cursor()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">query</span><span class="params">(self)</span>:</span></span><br><span class="line">        sql = <span class="string">"select * from chinamoney_ann_v1;"</span></span><br><span class="line">        self.cursor.execute(sql)</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> self.cursor.fetchall():</span><br><span class="line">            print(row)</span><br><span class="line">        print(<span class="string">f"一共查找到：<span class="subst">&#123;self.cursor.rowcount&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">end</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.cursor.close()</span><br><span class="line">        self.content.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    mysql = Mysql()</span><br><span class="line">    mysql.query()</span><br><span class="line">    mysql.end()</span><br></pre></td></tr></table></figure>
<h4 id="案例：一整套"><a href="#案例：一整套" class="headerlink" title="案例：一整套"></a>案例：一整套</h4><p>第一步：打开数据库连接</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host=<span class="string">"数据库地址"</span>, </span><br><span class="line">                     user=<span class="string">"用户名"</span>, </span><br><span class="line">                     password=<span class="string">"密码"</span>, </span><br><span class="line">                     port=<span class="number">3306</span>,<span class="comment"># 端口  </span></span><br><span class="line">                     database=<span class="string">"数据库名"</span>, </span><br><span class="line">                     charset=<span class="string">'utf8'</span>)</span><br></pre></td></tr></table></figure>
<p>第二步：创建游标</p>
<p>cursor = db.cursor()</p>
<p>第三步：操作数据库</p>
<p>1、创建表<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果数据表已经存在使用execute()方法删除表。</span></span><br><span class="line">cursor.execute(<span class="string">"DROP TABLE IF EXISTS EMPLOYEE"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建数据表SQL语句</span></span><br><span class="line">sql = <span class="string">"""CREATE TABLE EMPLOYEE (</span></span><br><span class="line"><span class="string">         FIRST_NAME  CHAR(20) NOT NULL,</span></span><br><span class="line"><span class="string">         LAST_NAME  CHAR(20),</span></span><br><span class="line"><span class="string">         AGE INT,  </span></span><br><span class="line"><span class="string">         SEX CHAR(1),</span></span><br><span class="line"><span class="string">         INCOME FLOAT )"""</span></span><br><span class="line"></span><br><span class="line">cursor.execute(sql)</span><br></pre></td></tr></table></figure></p>
<p>2、查询数据#<br>Python查询Mysql使用 fetchone() 方法获取单条数据, 使用fetchall() 方法获取多条数据。<br>fetchone(): 该收全部的返回结果行.<br>rowcount: 这是方法获取下一个查询结果集。结果集是一个对象<br>fetchall():接一个只读属性，并返回执行execute()方法后影响的行数。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQL 查询语句</span></span><br><span class="line">sql = <span class="string">"SELECT * FROM EMPLOYEE WHERE INCOME &gt; &#123;&#125;"</span>.format(<span class="number">1000</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 执行SQL语句</span></span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    <span class="comment"># 获取所有记录列表</span></span><br><span class="line">    results = cursor.fetchall()</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> results:</span><br><span class="line">        fname = row[<span class="number">0</span>]</span><br><span class="line">        lname = row[<span class="number">1</span>]</span><br><span class="line">        age = row[<span class="number">2</span>]</span><br><span class="line">        sex = row[<span class="number">3</span>]</span><br><span class="line">        income = row[<span class="number">4</span>]</span><br><span class="line">        <span class="comment"># 打印结果</span></span><br><span class="line">        print(<span class="string">"fname=&#123;&#125;,lname=&#123;&#125;,age=&#123;&#125;,sex=&#123;&#125;,income=&#123;&#125;"</span>.format(fname, lname, age, sex, income))</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">"Error: unable to fecth data"</span>)</span><br></pre></td></tr></table></figure></p>
<p>3、添加数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQL 插入语句</span></span><br><span class="line">sql = <span class="string">"""INSERT INTO EMPLOYEE(FIRST_NAME,</span></span><br><span class="line"><span class="string">         LAST_NAME, AGE, SEX, INCOME)</span></span><br><span class="line"><span class="string">         VALUES ('Mac', 'Mohan', 20, 'M', 2000)"""</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    <span class="comment"># 提交到数据库执行</span></span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="comment"># 发生错误时回滚</span></span><br><span class="line">    db.rollback()</span><br></pre></td></tr></table></figure></p>
<p>4、修改数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQL 更新语句</span></span><br><span class="line">sql = <span class="string">"UPDATE EMPLOYEE SET AGE = AGE + 1 WHERE SEX = '&#123;&#125;'"</span>.format(<span class="string">'M'</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    <span class="comment"># 提交到数据库执行</span></span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="comment"># 发生错误时回滚</span></span><br><span class="line">    db.rollback()</span><br></pre></td></tr></table></figure></p>
<p>5、删除数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQL 刪除语句</span></span><br><span class="line">sql = <span class="string">"DELETE FROM EMPLOYEE WHERE AGE &gt; &#123;&#125;"</span>.format(<span class="number">20</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    <span class="comment"># 提交到数据库执行</span></span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="comment"># 发生错误时回滚</span></span><br><span class="line">    db.rollback()</span><br></pre></td></tr></table></figure></p>
<p>第四步：关闭游标，数据库连接<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cursor.close()</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure></p>
<h4 id="通过控制台向数据库插入数据"><a href="#通过控制台向数据库插入数据" class="headerlink" title="通过控制台向数据库插入数据"></a>通过控制台向数据库插入数据</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">@Time    : 2020/5/11 14:24</span></span><br><span class="line"><span class="string">@Software: PyCharm</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">host = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">3306</span></span><br><span class="line">user = <span class="string">'root'</span></span><br><span class="line">password = <span class="string">'123456'</span></span><br><span class="line">print(<span class="string">'Starting the create database operation, please enter the information required for the database.'</span>)</span><br><span class="line"><span class="comment"># print('------------------------------------')</span></span><br><span class="line"><span class="comment"># host = input('please input database host:')</span></span><br><span class="line"><span class="comment"># port = input('please input database port:')</span></span><br><span class="line"><span class="comment"># user = input('please input database user:')</span></span><br><span class="line"><span class="comment"># password = input('please input database password:')</span></span><br><span class="line"><span class="comment"># print('------------------------------------')</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = pymysql.connect(host=host, port=int(port), user=user, password=password)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'create database...'</span>)</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    cur.execute(<span class="string">'create database if not exists book'</span>)</span><br><span class="line">    print(<span class="string">'database created done.'</span>)</span><br><span class="line">    print(<span class="string">'------------------------------------'</span>)</span><br><span class="line">    conn.select_db(<span class="string">'book'</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'create user table...'</span>)</span><br><span class="line">    cur.execute(<span class="string">"CREATE TABLE IF NOT EXISTS user ("</span></span><br><span class="line">                <span class="string">"id varchar(50) PRIMARY KEY,"</span></span><br><span class="line">                <span class="string">"username varchar(255),"</span></span><br><span class="line">                <span class="string">"password varchar(255),"</span></span><br><span class="line">                <span class="string">"role int(11),"</span></span><br><span class="line">                <span class="string">"create_time datetime,"</span></span><br><span class="line">                <span class="string">"delete_flag int(11),"</span></span><br><span class="line">                <span class="string">"current_login_time datetime)"</span>)</span><br><span class="line">    print(<span class="string">'user table created done.'</span>)</span><br><span class="line">    print(<span class="string">'------------------------------------'</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'create book table...'</span>)</span><br><span class="line">    cur.execute(<span class="string">"CREATE TABLE IF NOT EXISTS book("</span></span><br><span class="line">                <span class="string">"id varchar(50) PRIMARY KEY,"</span></span><br><span class="line">                <span class="string">"book_name varchar(255),"</span></span><br><span class="line">                <span class="string">"author varchar(255),"</span></span><br><span class="line">                <span class="string">"publish_company varchar(255),"</span></span><br><span class="line">                <span class="string">"store_number int(11),"</span></span><br><span class="line">                <span class="string">"borrow_number int(11),"</span></span><br><span class="line">                <span class="string">"create_time datetime,"</span></span><br><span class="line">                <span class="string">"publish_date datetime)"</span>)</span><br><span class="line">    print(<span class="string">'book table created done.'</span>)</span><br><span class="line">    print(<span class="string">'------------------------------------'</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'create borrow_info table...'</span>)</span><br><span class="line">    cur.execute(<span class="string">"CREATE TABLE IF NOT EXISTS borrow_info ("</span></span><br><span class="line">                <span class="string">"id varchar(50) PRIMARY KEY,"</span></span><br><span class="line">                <span class="string">"book_id varchar(50),"</span></span><br><span class="line">                <span class="string">"book_name varchar(255),"</span></span><br><span class="line">                <span class="string">"borrow_user varchar(255),"</span></span><br><span class="line">                <span class="string">"borrow_num int(11),"</span></span><br><span class="line">                <span class="string">"borrow_days int(11),"</span></span><br><span class="line">                <span class="string">"borrow_time datetime,"</span></span><br><span class="line">                <span class="string">"return_time datetime,"</span></span><br><span class="line">                <span class="string">"return_flag int(11))"</span>)</span><br><span class="line">    print(<span class="string">'borrow_info table created done.'</span>)</span><br><span class="line">    print(<span class="string">'------------------------------------'</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'create ask_return table...'</span>)</span><br><span class="line">    cur.execute(<span class="string">"create table if not exists ask_return ("</span></span><br><span class="line">                <span class="string">"id int(11) PRIMARY KEY AUTO_INCREMENT NOT NULL,"</span></span><br><span class="line">                <span class="string">"user_name varchar(50) NOT NULL,"</span></span><br><span class="line">                <span class="string">"borrow_id varchar(50) NOT NULL,"</span></span><br><span class="line">                <span class="string">"is_read int(11) NOT NULL,"</span></span><br><span class="line">                <span class="string">"time datetime)"</span>)</span><br><span class="line">    print(<span class="string">'ask_return table created done.'</span>)</span><br><span class="line">    print(<span class="string">'-'</span>*<span class="number">30</span>)</span><br><span class="line">    print(<span class="string">'operate done.'</span>)</span><br><span class="line">    print(<span class="string">'create database successful.'</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">'the require information of database is correct, please check it and retry.'</span>)</span><br><span class="line">    print(e.args)</span><br><span class="line">    <span class="keyword">import</span> traceback</span><br><span class="line">    traceback.print_exc()</span><br><span class="line">    print(<span class="string">'create database failed.'</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Is insert some sample data into the database?'</span>)</span><br><span class="line">print(<span class="string">'1. insert'</span>)</span><br><span class="line">print(<span class="string">'2. exit'</span>)</span><br><span class="line">insert_tag = input(<span class="string">'please select the option:'</span>)</span><br><span class="line"><span class="keyword">if</span> insert_tag == <span class="string">'1'</span>:</span><br><span class="line">    print(<span class="string">'------------------------------------'</span>)</span><br><span class="line">    print(<span class="string">'starting the insert data operation...'</span>)</span><br><span class="line">    admin_data = [<span class="string">'12644064935811ea9063d8c497639e37'</span>, <span class="string">'admin'</span>, <span class="string">'21232f297a57a5a743894a0e4a801fc3'</span>, <span class="number">0</span>,</span><br><span class="line">                  <span class="string">'2020-05-11 15:23:12'</span>, <span class="number">0</span>, <span class="string">'2020-05-11 15:24:23'</span>]</span><br><span class="line">    user_data = [<span class="string">'99477a9e935811ea8171d8c497639e37'</span>, <span class="string">'zhangsan'</span>, <span class="string">'e10adc3949ba59abbe56e057f20f883e'</span>, <span class="number">1</span>,</span><br><span class="line">                 <span class="string">'2020-05-11 15:23:12'</span>, <span class="number">0</span>, <span class="string">'2020-05-11 15:24:23'</span>]</span><br><span class="line">    sql = <span class="string">'insert into user (id, username, password, role, create_time, delete_flag, current_login_time) values(%s,%s,'</span>\</span><br><span class="line">          <span class="string">'%s,%s,%s,%s,%s)'</span></span><br><span class="line">    cur.execute(sql, admin_data)</span><br><span class="line">    cur.execute(sql, user_data)</span><br><span class="line">    conn.commit()</span><br><span class="line">    cur.close()</span><br><span class="line">    conn.close()</span><br><span class="line">    print(<span class="string">'insert operation done.'</span>)</span><br><span class="line">    print(<span class="string">'------------------------------------'</span>)</span><br><span class="line">    print(<span class="string">'Now you can use admin account login with username="admin" password="admin" or use the normal account login'</span></span><br><span class="line">          <span class="string">'with username="zhangsan" password="123456".'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'system exit.'</span>)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/uploads/avatar.png" alt="崔永华（Andy）">
          <p class="site-author-name" itemprop="name">崔永华（Andy）</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">83</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">34</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">37</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/cuiyonghua6" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://blog.csdn.net/cui_yonghua" target="_blank" title="CSDN">
                  
                    <i class="fa fa-fw fa-bandcamp"></i>
                  
                  CSDN
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/cuiyonghua" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://weibo.com/cuiyonghua" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">崔永华（Andy）</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
    <span class="site-pv">
      本站总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  

  

  

  

</body>
</html>
